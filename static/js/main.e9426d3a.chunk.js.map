{"version":3,"sources":["Navbar.js","Player.js","DFT.js","colorMapping.js","getDftMatrices.js","ResolutionSelector.js","PcvChipsBox.js","pages/Home.js","pages/Theory.js","Wavescape.js","WavescapeModule.js","Circle.js","prototypesData.js","CoefficientsModule.js","pages/Analysis.js","App.js","parser.js","index.js"],"names":["AppBar","styled","MuiAppBar","shouldForwardProp","prop","theme","open","transition","transitions","create","easing","sharp","duration","leavingScreen","width","marginLeft","easeOut","enteringScreen","Navbar","setOpen","Box","sx","flexGrow","position","Toolbar","IconButton","color","onClick","edge","mr","display","Typography","variant","component","ButtonGroup","Button","Link","to","disableElevation","part","intervalID","currentSongDuration","TinyText","fontSize","opacity","fontWeight","letterSpacing","formatDuration","value","minute","Math","floor","secondLeft","setPlayerMidiData","midiData","resolution","wavescapeRes","setCurrentSubdiv","Tone","cancel","stop","console","log","partNotes","tracks","forEach","track","notes","note","push","subdiv","time","wavescapeSubdiv","sampler","triggerAttackRelease","name","velocity","start","loop","loopEnd","urls","A0","C1","A1","C2","A2","C3","A3","C4","A4","C5","A5","C6","A6","C7","A7","C8","release","baseUrl","toDestination","Player","useState","playbackSliderProgress","setPlaybackSliderProgress","useEffect","flexDirection","alignItems","Stack","direction","padding","stopInterval","size","children","pause","state","resume","setInterval","progress","Slider","onChange","event","newValue","seconds","justifyContent","mt","clearInterval","volume","dft","pcv","normalize","round","polar","N","length","coeffs","k","temp","n","math","slice","norm","map","coeff","re","im","toPolar","sumAndNormalize","sum","i","j","contToDiscRGB","d3","domain","range","pixelColor","x","y","distance","r","g","b","angle","atan2","PI","a","getRgbaFromComplex","complex","polarComplex","phi","mod","ris","gradient","Pcv","this","C","Cs","D","Ds","E","F","Fs","G","Gs","A","As","B","targetPitch","getDftCoeffDynamic","resolutionMode","currentSongBPM","noteResolutionValue","useSeconds","isNaN","tracksSubdivision","filter","instrument","percussion","getSubdivision","pcvSubdivision","pitch","addNoteDuration","dftCoeffsSubdivision","getPcvAsArray","dftCoeffsMatrix","traces","firstRow","tracesData","subdivision","wndLen","cursor","isValidNote","noteAndDuration","getComplementaryColours","colours","rho","sqrt","pow","rgba","hexa","Object","keys","key","hexadecimal","toString","colorToHex","join","rgbaToHexa","ResolutionSelector","setResolutionMode","isInputSecondsInvalid","setIsInputSecondsInvalid","resolutionTextRef","useRef","FormControl","FormLabel","RadioGroup","row","defaultValue","newResolutionMode","parseFloat","current","target","FormControlLabel","control","Radio","label","TextField","minHeight","error","helperText","id","inputRef","ListItem","margin","spacing","PcvChipsBox","userPcvs","setUserPcvs","Paper","flexWrap","listStyle","p","overflow","data","Chip","isDisabled","icon","style","onDelete","chipToDelete","chips","chip","Home","Theory","verticalScale","sin","Wavescape","ticks","wavescapeMatrix","currentWavescapeSubdiv","canvasRef","wsCoordinates","setWsCoordinates","height","baseSubdivision","canvas","ctx","getContext","margins","innerSize","clearRect","innerWidth","innerHeight","marginTop","unit","mat","computeTicks","beginPath","moveTo","lineTo","fillStyle","fill","drawWavescape","transform","ref","coord","x1","x2","y1","y2","stroke","strokeWidth","cx","cy","WavescapeModule","wavescapesData","Circle","protoDataCoeff","traceDataCoeff","userPcvsCoeff","currentSubdiv","performanceCoeff","circleRadius","marksRadiusRatio","radius","devicePixelRatio","image","createImageData","scale","index","putImageData","getImageData","circleMark","pcvData","radiusScaleWidth","mark","innerRadius","outerRadius","startAngle","endAngle","fillOpacity","d","zIndex","scaleRatio","labelName","subSup","isSub","includes","dxOffset","dyOffset","sign","textAnchor","dx","dy","baselineShift","protoCircleMark","highlight","opacityArray","reverse","highlightSubdiv","prototypesData","CoefficientsModule","coeffTracesData","showPrototypes","midiDevNotesDftCoeffs","selectedProtoPitchClasses","setSelectedProtoPitchClasses","subdivUserPcvs","setSubdivUserPcvs","tempSubdivUserPcvs","Application","currentSongMidiData","fileName","setShowPrototypes","setMidiDevNotesDftCoeffs","currentNotes","handleInput","input","command","toNote","triggerAttack","triggerRelease","currentNote","playedNotes","dftCoeffs","computeDftCoeffs","updateDevices","port","manufacturer","type","navigator","requestMIDIAccess","then","midiAccess","onstatechange","inputs","onmidimessage","Accordion","defaultExpanded","AccordionSummary","expandIcon","AccordionDetails","top","bottom","FormGroup","Switch","checked","Main","DrawerHeader","mixins","toolbar","App","useTheme","file","setFile","setWavescapesData","setCoeffTracesData","wavescapeResolution","setWavescapeResolution","circleResolution","setCircleResolution","pcvTextRef","isInputPcvInvalid","setIsInputPcvInvalid","handleSubmitPitchClass","parsedInput","userPcvObjects","pcvs","isGroup","isSet","stringGroup","Error","numeralInput","count","num","lastNum","bin","parse","message","pcvObj","document","getElementById","files","fileReader","FileReader","readAsArrayBuffer","onload","loadedFile","binMidiFile","Midi","tempos","header","tempo","bpm","midiBpm","max","nonPercussiveTracks","getMidiFileDataObject","result","staticResolution","matrixHeight","rowsWidth","wndLenUnits","windowed","rgbaMatrices","matrix","getRgbaMatrix","midiFile","getDftCoeffStatic","exPcvObjects","basename","process","CssBaseline","Drawer","flexShrink","boxSizing","anchor","noWrap","htmlFor","e","Divider","noValidate","autoComplete","fullWidth","exact","path","render","Analysis","customTheme","createTheme","palette","primary","main","secondary","ReactDOM","StrictMode","ThemeProvider"],"mappings":"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","file":"static/js/main.e9426d3a.chunk.js","sourcesContent":["import React from 'react';\r\nimport MuiAppBar from '@mui/material/AppBar';\r\nimport Box from '@mui/material/Box';\r\nimport Toolbar from '@mui/material/Toolbar';\r\nimport Typography from '@mui/material/Typography';\r\nimport Button from '@mui/material/Button';\r\nimport ButtonGroup from '@mui/material/ButtonGroup';\r\nimport { Link } from 'react-router-dom';\r\nimport { styled, useTheme } from '@mui/material/styles';\r\n\r\nimport ChevronRightIcon from '@mui/icons-material/ChevronRight';\r\nimport IconButton from '@mui/material/IconButton';\r\n\r\nconst drawerWidth = 400;\r\n\r\nconst AppBar = styled(MuiAppBar, {\r\n  shouldForwardProp: (prop) => prop !== 'open',\r\n})(({ theme, open }) => ({\r\n  transition: theme.transitions.create(['margin', 'width'], {\r\n    easing: theme.transitions.easing.sharp,\r\n    duration: theme.transitions.duration.leavingScreen,\r\n  }),\r\n  ...(open && {\r\n    width: `calc(100% - ${drawerWidth}px)`,\r\n    marginLeft: `${drawerWidth}px`,\r\n    transition: theme.transitions.create(['margin', 'width'], {\r\n      easing: theme.transitions.easing.easeOut,\r\n      duration: theme.transitions.duration.enteringScreen,\r\n    }),\r\n  }),\r\n}));\r\n\r\nexport default function Navbar({ open, setOpen }) {\r\n  const handleDrawerOpen = () => {\r\n    setOpen(true);\r\n  };\r\n  return (\r\n    <Box sx={{ flexGrow: 1 }}>\r\n      <AppBar position='static' open={open}>\r\n        <Toolbar>\r\n          <IconButton\r\n            color='inherit'\r\n            aria-label='open drawer'\r\n            onClick={handleDrawerOpen}\r\n            edge='start'\r\n            sx={{ mr: 2, ...(open && { display: 'none' }) }}\r\n          >\r\n            <ChevronRightIcon />\r\n          </IconButton>\r\n          <Typography variant='h3' component='div' sx={{ flexGrow: 1 }}>\r\n            Mi_DFT\r\n          </Typography>\r\n          <ButtonGroup aria-label='outlined button group'>\r\n            <Button\r\n              component={Link}\r\n              to='/'\r\n              variant='contained'\r\n              disableElevation={true}\r\n            >\r\n              Home\r\n            </Button>\r\n            <Button\r\n              component={Link}\r\n              to='/theory'\r\n              variant='contained'\r\n              disableElevation={true}\r\n            >\r\n              Theory\r\n            </Button>\r\n            <Button\r\n              component={Link}\r\n              to='/analysis'\r\n              variant='contained'\r\n              disableElevation={true}\r\n            >\r\n              Analysis\r\n            </Button>\r\n          </ButtonGroup>\r\n        </Toolbar>\r\n      </AppBar>\r\n    </Box>\r\n  );\r\n}\r\n","import * as Tone from 'tone';\r\nimport { useEffect, useState } from 'react';\r\n\r\nimport Box from '@mui/material/Box';\r\nimport Stack from '@mui/material/Stack';\r\nimport PlayArrowRoundedIcon from '@mui/icons-material/PlayArrowRounded';\r\nimport PauseRoundedIcon from '@mui/icons-material/PauseRounded';\r\nimport StopRoundedIcon from '@mui/icons-material/StopRounded';\r\nimport IconButton from '@mui/material/IconButton';\r\nimport Slider from '@mui/material/Slider';\r\nimport { styled } from '@mui/material/styles';\r\nimport Typography from '@mui/material/Typography';\r\n\r\nlet part;\r\nlet currentSongDuration = 0; // seconds\r\nlet intervalID;\r\n\r\nconst TinyText = styled(Typography)({\r\n  fontSize: '0.75rem',\r\n  opacity: 0.38,\r\n  fontWeight: 500,\r\n  letterSpacing: 0.2,\r\n});\r\n\r\nfunction formatDuration(value) {\r\n  const minute = Math.floor(value / 60);\r\n  const secondLeft = Math.floor(value - minute * 60);\r\n  return `${minute}:${secondLeft < 9 ? `0${secondLeft}` : secondLeft}`;\r\n}\r\n\r\nexport function setPlayerMidiData(\r\n  midiData,\r\n  resolution,\r\n  wavescapeRes,\r\n  setCurrentSubdiv\r\n) {\r\n  //Remove the scheduled previous song\r\n  Tone.Transport.cancel(0);\r\n  setCurrentSubdiv(0);\r\n  Tone.Transport.stop();\r\n\r\n  currentSongDuration = midiData.duration;\r\n  console.log(currentSongDuration);\r\n\r\n  let partNotes = [];\r\n  midiData.tracks.forEach((track) =>\r\n    track.notes.forEach((note) => {\r\n      partNotes.push(note);\r\n    })\r\n  );\r\n\r\n  partNotes.forEach((note) => {\r\n    note.subdiv = Math.floor(note.time / resolution);\r\n    note.wavescapeSubdiv = Math.floor(note.time / wavescapeRes);\r\n  });\r\n\r\n  part = new Tone.Part(\r\n    (time, note) => {\r\n      sampler.triggerAttackRelease(\r\n        note.name,\r\n        note.duration,\r\n        time,\r\n        note.velocity\r\n      );\r\n      setCurrentSubdiv(note.subdiv);\r\n    },\r\n    [...partNotes]\r\n  ).start(0);\r\n\r\n  part.loop = true;\r\n  part.loopEnd = currentSongDuration;\r\n}\r\n\r\nconst sampler = new Tone.Sampler({\r\n  urls: {\r\n    A0: 'A0.mp3',\r\n    C1: 'C1.mp3',\r\n    'D#1': 'Ds1.mp3',\r\n    'F#1': 'Fs1.mp3',\r\n    A1: 'A1.mp3',\r\n    C2: 'C2.mp3',\r\n    'D#2': 'Ds2.mp3',\r\n    'F#2': 'Fs2.mp3',\r\n    A2: 'A2.mp3',\r\n    C3: 'C3.mp3',\r\n    'D#3': 'Ds3.mp3',\r\n    'F#3': 'Fs3.mp3',\r\n    A3: 'A3.mp3',\r\n    C4: 'C4.mp3',\r\n    'D#4': 'Ds4.mp3',\r\n    'F#4': 'Fs4.mp3',\r\n    A4: 'A4.mp3',\r\n    C5: 'C5.mp3',\r\n    'D#5': 'Ds5.mp3',\r\n    'F#5': 'Fs5.mp3',\r\n    A5: 'A5.mp3',\r\n    C6: 'C6.mp3',\r\n    'D#6': 'Ds6.mp3',\r\n    'F#6': 'Fs6.mp3',\r\n    A6: 'A6.mp3',\r\n    C7: 'C7.mp3',\r\n    'D#7': 'Ds7.mp3',\r\n    'F#7': 'Fs7.mp3',\r\n    A7: 'A7.mp3',\r\n    C8: 'C8.mp3',\r\n  },\r\n  release: 1,\r\n  baseUrl: 'https://tonejs.github.io/audio/salamander/',\r\n}).toDestination();\r\nsampler.volume.value = -20;\r\n\r\nexport default function Player() {\r\n  const [playbackSliderProgress, setPlaybackSliderProgress] = useState(0);\r\n\r\n  useEffect(() => {\r\n    console.log(currentSongDuration);\r\n  }, [currentSongDuration]);\r\n\r\n  return (\r\n    <Box\r\n      sx={{\r\n        display: 'flex',\r\n        flexDirection: 'column',\r\n        alignItems: 'center',\r\n        width: '60%',\r\n      }}\r\n    >\r\n      <Stack direction='row'>\r\n        <IconButton\r\n          sx={{ padding: '0' }}\r\n          onClick={() => {\r\n            console.log('stop');\r\n            Tone.Transport.stop();\r\n            stopInterval();\r\n          }}\r\n          size='large'\r\n          children={<StopRoundedIcon fontSize='large' />}\r\n        />\r\n        <IconButton\r\n          sx={{ padding: '0' }}\r\n          onClick={() => {\r\n            console.log('pause');\r\n            Tone.Transport.pause();\r\n            stopInterval();\r\n          }}\r\n          size='large'\r\n          children={<PauseRoundedIcon fontSize='large' />}\r\n        />\r\n        <IconButton\r\n          sx={{ padding: '0' }}\r\n          onClick={() => {\r\n            console.log('play');\r\n            if (Tone.context.state !== 'running') {\r\n              console.log('state running');\r\n              Tone.context.resume();\r\n            }\r\n            Tone.Transport.start();\r\n            if (!intervalID && part)\r\n              intervalID = setInterval(\r\n                () => setPlaybackSliderProgress(part.progress),\r\n                1000\r\n              );\r\n          }}\r\n          size='large'\r\n          children={<PlayArrowRoundedIcon fontSize='large' />}\r\n        />\r\n      </Stack>\r\n      <Slider\r\n        aria-label='Playback'\r\n        size='small'\r\n        value={playbackSliderProgress ? playbackSliderProgress * 100 : 0}\r\n        onChange={(event, newValue) => {\r\n          setPlaybackSliderProgress(newValue / 100);\r\n          Tone.Transport.seconds = (newValue / 100) * currentSongDuration;\r\n        }}\r\n        sx={{ width: '90%' }}\r\n      />\r\n      <Box\r\n        sx={{\r\n          display: 'flex',\r\n          width: '90%',\r\n          alignItems: 'center',\r\n          justifyContent: 'space-between',\r\n          mt: -1,\r\n        }}\r\n      >\r\n        <TinyText>\r\n          -\r\n          {formatDuration(\r\n            currentSongDuration - playbackSliderProgress * currentSongDuration\r\n          )}\r\n        </TinyText>\r\n        <TinyText>{formatDuration(currentSongDuration)}</TinyText>\r\n      </Box>\r\n    </Box>\r\n  );\r\n}\r\n\r\nfunction stopInterval() {\r\n  clearInterval(intervalID);\r\n  // release our intervalID from the variable\r\n  intervalID = null;\r\n}\r\n","import * as math from 'mathjs';\r\n\r\n// Compute the DFT on the input pcv\r\nexport default function dft(\r\n  pcv,\r\n  normalize = true,\r\n  round = false,\r\n  polar = false\r\n) {\r\n  let N = pcv.length;\r\n\r\n  let coeffs = [];\r\n\r\n  for (let k = 0; k < N / 2 + 1; k++) {\r\n    let temp = 0;\r\n    for (let n = 0; n < N; n++) {\r\n      temp = math.add(\r\n        math.multiply(\r\n          pcv[n],\r\n          math.exp(math.multiply(math.i, (-2 * math.pi * k * n) / N))\r\n        ),\r\n        temp\r\n      );\r\n    }\r\n    coeffs.push(temp);\r\n  }\r\n\r\n  coeffs = coeffs.slice();\r\n\r\n  if (normalize) {\r\n    const norm = coeffs[0];\r\n    //'!=' gives a warning but '!==' doesn't compute correctly the if statement\r\n    if (norm != 0) coeffs = coeffs.map((coeff) => math.divide(coeff, norm));\r\n  }\r\n\r\n  if (round) {\r\n    coeffs.forEach((coeff) => {\r\n      coeff.re = Math.round(coeff.re * 10000) / 10000;\r\n      coeff.im = Math.round(coeff.im * 10000) / 10000;\r\n    });\r\n  }\r\n\r\n  if (polar) {\r\n    coeffs = coeffs.map((coeff) => coeff.toPolar());\r\n  }\r\n\r\n  return coeffs;\r\n}\r\n\r\nexport function sumAndNormalize(coeffs) {\r\n  let sum = coeffs[0];\r\n  for (let i = 1; i < coeffs.length; i++) {\r\n    //incremental sum for each coeff\r\n    let temp = [];\r\n    //coeff per coeff sum\r\n    for (let j = 0; j < coeffs[i].length; j++) {\r\n      temp.push(math.add(sum[j], coeffs[i][j]));\r\n    }\r\n    sum = temp.slice();\r\n  }\r\n\r\n  const norm = sum[0];\r\n  sum = sum.map((coeff) => math.divide(coeff, norm));\r\n\r\n  return sum;\r\n}\r\n","import * as d3 from 'd3';\r\nimport * as math from 'mathjs';\r\n\r\n//Convert rgb values from [0,1] to [0,255]\r\nconst contToDiscRGB = d3\r\n  .scaleQuantize()\r\n  .domain([0, 1])\r\n  .range(d3.range(0, 255, 1));\r\n\r\n//Generate the color space using the color mapping suggested in the paper\r\nexport const gradient = (angle) => {\r\n  let r, g, b;\r\n\r\n  if (angle >= 0 && angle < math.pi / 3) {\r\n    r = 1;\r\n    g = (3 * angle) / math.pi;\r\n    b = 0;\r\n  } else if (angle >= math.pi / 3 && angle < (math.pi * 2) / 3) {\r\n    r = 2 - (3 * angle) / math.pi;\r\n    g = 1;\r\n    b = 0;\r\n  } else if (angle >= (math.pi * 2) / 3 && angle < math.pi) {\r\n    r = 0;\r\n    g = 1;\r\n    b = (3 * angle) / math.pi - 2;\r\n  } else if (angle >= math.pi && angle < (math.pi * 4) / 3) {\r\n    r = 0;\r\n    g = 4 - (3 * angle) / math.pi;\r\n    b = 1;\r\n  } else if (angle >= (math.pi * 4) / 3 && angle < (math.pi * 5) / 3) {\r\n    r = (3 * angle) / math.pi - 4;\r\n    g = 0;\r\n    b = 1;\r\n  } else if (angle >= (math.pi * 5) / 3 && angle < 2 * math.pi) {\r\n    r = 1;\r\n    g = 0;\r\n    b = 6 - (3 * angle) / math.pi;\r\n  }\r\n\r\n  r = contToDiscRGB(r);\r\n  g = contToDiscRGB(g);\r\n  b = contToDiscRGB(b);\r\n\r\n  return `rgb(${r}, ${g}, ${b})`;\r\n};\r\n\r\n//Generate the color space using the color mapping suggested in the paper\r\nexport const pixelColor = (x, y, distance) => {\r\n  let r, g, b, a;\r\n  //atan2 out in [-pi, pi]\r\n  let angle = Math.atan2(y, x);\r\n  angle = -angle;\r\n  //we need it in [0, 2pi]\r\n  if (angle < 0) angle += 2 * Math.PI;\r\n\r\n  if (angle >= 0 && angle < math.pi / 3) {\r\n    r = 1;\r\n    g = (3 * angle) / math.pi;\r\n    b = 0;\r\n  } else if (angle >= math.pi / 3 && angle < (math.pi * 2) / 3) {\r\n    r = 2 - (3 * angle) / math.pi;\r\n    g = 1;\r\n    b = 0;\r\n  } else if (angle >= (math.pi * 2) / 3 && angle < math.pi) {\r\n    r = 0;\r\n    g = 1;\r\n    b = (3 * angle) / math.pi - 2;\r\n  } else if (angle >= math.pi && angle < (math.pi * 4) / 3) {\r\n    r = 0;\r\n    g = 4 - (3 * angle) / math.pi;\r\n    b = 1;\r\n  } else if (angle >= (math.pi * 4) / 3 && angle < (math.pi * 5) / 3) {\r\n    r = (3 * angle) / math.pi - 4;\r\n    g = 0;\r\n    b = 1;\r\n  } else if (angle >= (math.pi * 5) / 3 && angle < 2 * math.pi) {\r\n    r = 1;\r\n    g = 0;\r\n    b = 6 - (3 * angle) / math.pi;\r\n  }\r\n\r\n  r = contToDiscRGB(r);\r\n  g = contToDiscRGB(g);\r\n  b = contToDiscRGB(b);\r\n  a = contToDiscRGB(distance);\r\n\r\n  return { r, g, b, a };\r\n};\r\n\r\nexport function getRgbaFromComplex(complex) {\r\n  let polarComplex = complex.toPolar();\r\n  let angle = polarComplex.phi; // phi from [-pi, pi], but color mapping defined in [0,2pi]\r\n  let mod = polarComplex.r;\r\n\r\n  //negative angle mapped to their positive representation\r\n  if (angle < 0) angle += 2 * math.pi;\r\n\r\n  let ris = gradient(angle).slice(3, -1);\r\n\r\n  return `rgba${ris}, ${mod})`;\r\n}\r\n","import { Midi } from '@tonejs/midi';\r\nimport dft, { sumAndNormalize } from './DFT';\r\nimport { getRgbaFromComplex, pixelColor } from './colorMapping';\r\n\r\nclass Pcv {\r\n  constructor() {\r\n    this.C = 0;\r\n    this.Cs = 0;\r\n    this.D = 0;\r\n    this.Ds = 0;\r\n    this.E = 0;\r\n    this.F = 0;\r\n    this.Fs = 0;\r\n    this.G = 0;\r\n    this.Gs = 0;\r\n    this.A = 0;\r\n    this.As = 0;\r\n    this.B = 0;\r\n  }\r\n\r\n  addNoteDuration(targetPitch, duration) {\r\n    switch (targetPitch) {\r\n      case 'C':\r\n        this.C += duration;\r\n        break;\r\n      case 'C#':\r\n        this.Cs += duration;\r\n        break;\r\n      case 'D':\r\n        this.D += duration;\r\n        break;\r\n      case 'D#':\r\n        this.Ds += duration;\r\n        break;\r\n      case 'E':\r\n        this.E += duration;\r\n        break;\r\n      case 'F':\r\n        this.F += duration;\r\n        break;\r\n      case 'F#':\r\n        this.Fs += duration;\r\n        break;\r\n      case 'G':\r\n        this.G += duration;\r\n        break;\r\n      case 'G#':\r\n        this.Gs += duration;\r\n        break;\r\n      case 'A':\r\n        this.A += duration;\r\n        break;\r\n      case 'A#':\r\n        this.As += duration;\r\n        break;\r\n      case 'B':\r\n        this.B += duration;\r\n        break;\r\n      default:\r\n        break;\r\n    }\r\n  }\r\n\r\n  getPcvAsArray() {\r\n    let temp = [\r\n      this.C,\r\n      this.Cs,\r\n      this.D,\r\n      this.Ds,\r\n      this.E,\r\n      this.F,\r\n      this.Fs,\r\n      this.G,\r\n      this.Gs,\r\n      this.A,\r\n      this.As,\r\n      this.B,\r\n    ];\r\n\r\n    return temp;\r\n  }\r\n\r\n  add(pcv) {\r\n    this.C = pcv.C;\r\n    this.Cs = pcv.Cs;\r\n    this.D = pcv.D;\r\n    this.Ds = pcv.Ds;\r\n    this.E = pcv.E;\r\n    this.F = pcv.F;\r\n    this.Fs = pcv.Fs;\r\n    this.G = pcv.G;\r\n    this.Gs = pcv.Gs;\r\n    this.A = pcv.A;\r\n    this.As = pcv.As;\r\n    this.B = pcv.B;\r\n  }\r\n}\r\n\r\nexport function getMidiFileDataObject(binMidiFile) {\r\n  let midiData = new Midi(binMidiFile);\r\n\r\n  let tempos = midiData.header.tempos.map((tempo) => Math.round(tempo.bpm));\r\n  let midiBpm = Math.max(...tempos); //For quarter-note conversion\r\n\r\n  //Check and delete percussive tracks!\r\n  let nonPercussiveTracks = midiData.tracks.filter(\r\n    (track) => track.instrument.percussion === false\r\n  );\r\n\r\n  midiData.tracks = nonPercussiveTracks;\r\n\r\n  return { midiData, midiBpm };\r\n}\r\n\r\nexport function getDftCoeffStatic(midiFile, resolution) {\r\n  let tracksSubdivision = [];\r\n\r\n  midiFile.tracks.forEach((track) =>\r\n    tracksSubdivision.push(\r\n      getSubdivision(track.notes, resolution, midiFile.duration)\r\n    )\r\n  );\r\n  //console.log(tracksSubdivision);\r\n\r\n  //pcv arrary init\r\n  let pcvSubdivision = [];\r\n\r\n  for (let i = 0; i < tracksSubdivision[0].length; i++) {\r\n    pcvSubdivision.push(new Pcv());\r\n  }\r\n\r\n  //populating the array for each subdiv with the durations\r\n  //for each track: i, for each subdiv: j, for each note of the subdiv: k\r\n  for (let i = 0; i < tracksSubdivision.length; i++) {\r\n    for (let j = 0; j < tracksSubdivision[i].length; j++) {\r\n      for (let k = 0; k < tracksSubdivision[i][j].length; k++) {\r\n        let { pitch, duration } = tracksSubdivision[i][j][k];\r\n        pcvSubdivision[j].addNoteDuration(pitch, duration);\r\n      }\r\n    }\r\n  }\r\n\r\n  //Computing the dft coeffs for of each subdiv\r\n  let dftCoeffsSubdivision = pcvSubdivision.map((pcv) =>\r\n    dft(pcv.getPcvAsArray())\r\n  );\r\n\r\n  //Computing the dft coeffs matrix\r\n  let dftCoeffsMatrix = [];\r\n\r\n  //adding the first row\r\n  dftCoeffsMatrix.push(dftCoeffsSubdivision);\r\n\r\n  return dftCoeffsMatrix;\r\n}\r\n\r\nexport function getDftCoeffDynamic(midiData, resolutionMode, currentSongBPM) {\r\n  let { noteResolutionValue, seconds, useSeconds } = resolutionMode;\r\n\r\n  let resolution;\r\n  if (useSeconds) {\r\n    isNaN(seconds) ? (resolution = 1) : (resolution = seconds);\r\n  } else {\r\n    //Use bpm\r\n    resolution = noteResolutionValue * (60 / currentSongBPM);\r\n  }\r\n\r\n  //console.log(currentSongBPM);\r\n  //console.log(resolution);\r\n\r\n  let duration = midiData.duration;\r\n  let tracksSubdivision = [];\r\n\r\n  //TODO: check and delete percussive tracks!\r\n  let nonPercussiveTracks = midiData.tracks.filter(\r\n    (track) => track.instrument.percussion === false\r\n  );\r\n\r\n  nonPercussiveTracks.forEach((track) => {\r\n    tracksSubdivision.push(getSubdivision(track.notes, resolution, duration));\r\n  });\r\n\r\n  //pcv arrary init\r\n  let pcvSubdivision = [];\r\n\r\n  for (let i = 0; i < tracksSubdivision[0].length; i++) {\r\n    pcvSubdivision.push(new Pcv());\r\n  }\r\n\r\n  //populating the array for each subdiv with the durations\r\n  //for each track: i, for each subdiv: j, for each note of the subdiv: k\r\n  for (let i = 0; i < tracksSubdivision.length; i++) {\r\n    for (let j = 0; j < tracksSubdivision[i].length; j++) {\r\n      for (let k = 0; k < tracksSubdivision[i][j].length; k++) {\r\n        let { pitch, duration } = tracksSubdivision[i][j][k];\r\n        pcvSubdivision[j].addNoteDuration(pitch, duration);\r\n      }\r\n    }\r\n  }\r\n\r\n  //Computing the dft coeffs for of each subdiv\r\n  let dftCoeffsSubdivision = pcvSubdivision.map((pcv) =>\r\n    dft(pcv.getPcvAsArray())\r\n  );\r\n\r\n  //Computing the dft coeffs matrix\r\n  let dftCoeffsMatrix = [];\r\n\r\n  //adding the first row\r\n  dftCoeffsMatrix.push(dftCoeffsSubdivision);\r\n\r\n  //Subdividing the first row of the dft coeff matrix to get the trace for each coeff\r\n  let traces = [];\r\n  let firstRow = dftCoeffsMatrix[0];\r\n  for (let i = 1; i < 7; i++) {\r\n    let temp = [];\r\n    for (let j = 0; j < firstRow.length; j++) {\r\n      temp.push({ x: firstRow[j][i].re, y: firstRow[j][i].im });\r\n    }\r\n    traces.push(temp);\r\n  }\r\n\r\n  return { tracesData: traces, resolution: resolution };\r\n}\r\n\r\n//Resolution is in seconds\r\nexport function getDftCoeffFromMidiLinear(\r\n  midiFile,\r\n  multiRes = 1,\r\n  seconds = 1,\r\n  useSeconds\r\n) {\r\n  //For now, we don't take into account tempo changes\r\n  let midiData = new Midi(midiFile);\r\n  console.log(midiData);\r\n\r\n  let resolution;\r\n  if (useSeconds) {\r\n    isNaN(seconds) ? (resolution = 1) : (resolution = seconds);\r\n  } else {\r\n    //Use bpm\r\n    let tempos = midiData.header.tempos.map((tempo) => Math.round(tempo.bpm));\r\n    let bpm = Math.max(...tempos); //For quarter-note conversion\r\n    resolution = multiRes * (60 / bpm);\r\n  }\r\n\r\n  console.log(resolution);\r\n\r\n  let duration = midiData.duration;\r\n  let tracksSubdivision = [];\r\n\r\n  //TODO: check and delete percussive tracks!\r\n  let nonPercussiveTracks = midiData.tracks.filter(\r\n    (track) => track.instrument.percussion === false\r\n  );\r\n\r\n  nonPercussiveTracks.forEach((track) => {\r\n    tracksSubdivision.push(getSubdivision(track.notes, resolution, duration));\r\n  });\r\n\r\n  //pcv arrary init\r\n  let pcvSubdivision = [];\r\n\r\n  for (let i = 0; i < tracksSubdivision[0].length; i++) {\r\n    pcvSubdivision.push(new Pcv());\r\n  }\r\n\r\n  //populating the array for each subdiv with the durations\r\n  //for each track: i, for each subdiv: j, for each note of the subdiv: k\r\n  for (let i = 0; i < tracksSubdivision.length; i++) {\r\n    for (let j = 0; j < tracksSubdivision[i].length; j++) {\r\n      for (let k = 0; k < tracksSubdivision[i][j].length; k++) {\r\n        let { pitch, duration } = tracksSubdivision[i][j][k];\r\n        pcvSubdivision[j].addNoteDuration(pitch, duration);\r\n      }\r\n    }\r\n  }\r\n\r\n  //Computing the dft coeffs for of each subdiv\r\n  let dftCoeffsSubdivision = pcvSubdivision.map((pcv) =>\r\n    dft(pcv.getPcvAsArray())\r\n  );\r\n\r\n  //Computing the dft coeffs matrix\r\n  let dftCoeffsMatrix = [];\r\n\r\n  //adding the first row\r\n  dftCoeffsMatrix.push(dftCoeffsSubdivision);\r\n\r\n  return { dftCoeffsLinear: dftCoeffsMatrix, resolution: resolution };\r\n}\r\n\r\n//Resolution is in seconds\r\nexport function getDftCoeffFromMidi(midiFile, resolution) {\r\n  //For now, we don't take into account tempo changes\r\n  let midiData = new Midi(midiFile);\r\n  console.log(midiData);\r\n  //const bpm = midiData.header.tempos[0].bpm; //For quarter-note conversion\r\n  let duration = midiData.duration;\r\n  let tracksSubdivision = [];\r\n\r\n  //TODO: check and delete percussive tracks!\r\n  let nonPercussiveTracks = midiData.tracks.filter(\r\n    (track) => track.instrument.percussion === false\r\n  );\r\n\r\n  /* midiData.tracks.forEach((track) => {\r\n    let tempMat = [];\r\n\r\n    for (let wndLen = resolution; wndLen < duration; wndLen += resolution) {\r\n      tempMat.push(getRow(track.notes, wndLen, resolution, duration));\r\n    }\r\n    //Since wndLen < duration, the for cycle do not include the top vertex of the triangle\r\n    tempMat.push(getRow(track.notes, duration, duration, duration)); //manually added\r\n\r\n    trackMatrices.push(tempMat);\r\n  }); */\r\n\r\n  nonPercussiveTracks.forEach((track) => {\r\n    tracksSubdivision.push(getSubdivision(track.notes, resolution, duration));\r\n  });\r\n\r\n  //pcv arrary init\r\n  let pcvSubdivision = [];\r\n\r\n  for (let i = 0; i < tracksSubdivision[0].length; i++) {\r\n    pcvSubdivision.push(new Pcv());\r\n  }\r\n\r\n  //populating the array for each subdiv with the durations\r\n  //for each track: i, for each subdiv: j, for each note of the subdiv: k\r\n  for (let i = 0; i < tracksSubdivision.length; i++) {\r\n    for (let j = 0; j < tracksSubdivision[i].length; j++) {\r\n      for (let k = 0; k < tracksSubdivision[i][j].length; k++) {\r\n        let { pitch, duration } = tracksSubdivision[i][j][k];\r\n        pcvSubdivision[j].addNoteDuration(pitch, duration);\r\n      }\r\n    }\r\n  }\r\n\r\n  //Computing the dft coeffs for of each subdiv\r\n  let dftCoeffsSubdivision = pcvSubdivision.map((pcv) =>\r\n    dft(pcv.getPcvAsArray())\r\n  );\r\n\r\n  //Computing the dft coeffs matrix\r\n  let dftCoeffsMatrix = [];\r\n\r\n  //adding the first row\r\n  dftCoeffsMatrix.push(dftCoeffsSubdivision);\r\n\r\n  return dftCoeffsMatrix;\r\n\r\n  /* OLD   //Computing each row of the matrix as the normalized sum of the previous row (dft as linear op)\r\n  let matrixHeight = dftCoeffsSubdivision.length;\r\n  let rowsWidth = dftCoeffsSubdivision.length;\r\n  for (let i = 1; i < matrixHeight; i++) {\r\n    //starting from second row, first already populated\r\n    let temp = [];\r\n    for (let cursor = 1; cursor < rowsWidth; cursor++) {\r\n      //starting from the second element and backward summing\r\n      temp.push(\r\n        //TODO change, sum subdiv only on first row\r\n        sumAndNormalize(\r\n          dftCoeffsMatrix[i - 1][cursor - 1],\r\n          dftCoeffsMatrix[i - 1][cursor]\r\n        )\r\n      );\r\n    }\r\n    rowsWidth--;\r\n    dftCoeffsMatrix.push(temp);\r\n  } */\r\n}\r\n\r\nexport function getRgbaMatrix(dftCoeffsMatrix) {\r\n  //Computing each row of the matrix as the normalized sum of the previous row (dft as linear op)\r\n  let matrixHeight = dftCoeffsMatrix[0].length;\r\n  let rowsWidth = dftCoeffsMatrix[0].length;\r\n  let wndLenUnits = 2;\r\n  for (let i = 1; i < matrixHeight; i++) {\r\n    //starting from second row, first already populated\r\n    let temp = [];\r\n    for (let cursor = 0; cursor + wndLenUnits <= rowsWidth; cursor++) {\r\n      let windowed = dftCoeffsMatrix[0].slice(cursor, cursor + wndLenUnits);\r\n      temp.push(sumAndNormalize(windowed));\r\n    }\r\n    wndLenUnits++;\r\n    dftCoeffsMatrix.push(temp);\r\n  }\r\n\r\n  /* //Computing the pcvs for each subdivision\r\n  let pcvMatrix = [];\r\n\r\n  for (let i = 0; i < trackMatrices[0].length; i++) {\r\n    let temp = [];\r\n    for (let k = 0; k < trackMatrices[0][i].length; k++) {\r\n      temp.push(new Pcv());\r\n    }\r\n    pcvMatrix.push(temp);\r\n  } */\r\n\r\n  /* trackMatrices.forEach((track) => {\r\n    for (let i = 0; i < track.length; i++) {\r\n      for (let j = 0; j < track[i].length; j++) {\r\n        for (let k = 0; k < track[i][j].length; k++) {\r\n          let { pitch, duration } = track[i][j][k];\r\n          pcvMatrix[i][j].addNoteDuration(pitch, duration);\r\n        }\r\n      }\r\n    }\r\n  }); */\r\n\r\n  /* //Computing the dft coeff matrix\r\n  let dftCoeffMatrix = [];\r\n\r\n  for (let i = 0; i < pcvMatrix.length; i++) {\r\n    let temp = [];\r\n    for (let j = 0; j < pcvMatrix[i].length; j++) {\r\n      temp.push(dft(pcvMatrix[i][j].getPcvAsArray()));\r\n    }\r\n    dftCoeffMatrix.push(temp);\r\n  } */\r\n\r\n  let rgbaMatrices = [];\r\n\r\n  for (let i = 0; i < 6; i++) {\r\n    let matrix = [];\r\n    for (let j = 0; j < dftCoeffsMatrix.length; j++) {\r\n      let subdiv = [];\r\n      for (let k = 0; k < dftCoeffsMatrix[j].length; k++) {\r\n        subdiv.push('');\r\n      }\r\n      matrix.push(subdiv);\r\n    }\r\n    rgbaMatrices.push(matrix);\r\n  }\r\n\r\n  //Creating a single matrix for each coefficient with rgba values for each diamond\r\n  for (let i = 0; i < dftCoeffsMatrix.length; i++) {\r\n    for (let j = 0; j < dftCoeffsMatrix[i].length; j++) {\r\n      for (let k = 1; k < dftCoeffsMatrix[i][j].length; k++) {\r\n        rgbaMatrices[k - 1][i][j] = getRgbaFromComplex(\r\n          dftCoeffsMatrix[i][j][k]\r\n        );\r\n      }\r\n    }\r\n  }\r\n\r\n  return rgbaMatrices;\r\n}\r\n\r\nfunction getSubdivision(notes, resolution, duration) {\r\n  let subdivision = [];\r\n  let wndLen = resolution;\r\n\r\n  for (let cursor = 0; cursor < duration; cursor += resolution) {\r\n    let temp = [];\r\n    notes.forEach((note) => {\r\n      let { time, duration } = note;\r\n\r\n      //Check if note contribute to the current window\r\n      if (isValidNote(time, duration, cursor, wndLen)) {\r\n        let noteAndDuration = { pitch: note.pitch };\r\n        //Computation of note contribution in the current window\r\n        if (time < cursor) {\r\n          if (time + duration < cursor + wndLen)\r\n            noteAndDuration.duration = time + duration - cursor;\r\n          else noteAndDuration.duration = wndLen;\r\n        } else {\r\n          if (time + duration <= cursor + wndLen)\r\n            noteAndDuration.duration = duration;\r\n          else noteAndDuration.duration = cursor + wndLen - time;\r\n        }\r\n\r\n        temp.push(noteAndDuration);\r\n      }\r\n    });\r\n\r\n    subdivision.push(temp);\r\n  }\r\n\r\n  return subdivision;\r\n}\r\n\r\nfunction isValidNote(time, duration, cursor, wndLen) {\r\n  if (\r\n    (time > cursor && time < cursor + wndLen) ||\r\n    (time + duration > cursor && time + duration < cursor + wndLen) ||\r\n    (time <= cursor && time + duration >= cursor + wndLen)\r\n  ) {\r\n    return true;\r\n  }\r\n  return false;\r\n}\r\n\r\nexport function getComplementaryColours(coeffs) {\r\n  let colours = [];\r\n\r\n  //Opposite of re and im to get the complementary colour\r\n  coeffs.forEach((coeff) => {\r\n    let rho = Math.sqrt(Math.pow(coeff.re, 2) + Math.pow(coeff.im, 2));\r\n    let rgba = pixelColor(coeff.re, -coeff.im, rho);\r\n\r\n    //RGB complementary\r\n    rgba.r = 255 - rgba.r;\r\n    rgba.g = 255 - rgba.g;\r\n    rgba.b = 255 - rgba.b;\r\n\r\n    colours.push(rgbaToHexa(rgba));\r\n  });\r\n\r\n  return colours;\r\n}\r\n\r\nfunction rgbaToHexa(rgba) {\r\n  let hexa = Object.keys(rgba).map((key) => colorToHex(rgba[key]));\r\n  return `#${hexa.join('')}`;\r\n}\r\n\r\nfunction colorToHex(color) {\r\n  let hexadecimal = color.toString(16);\r\n  return hexadecimal.length == 1 ? '0' + hexadecimal : hexadecimal;\r\n}\r\n","import { useRef, useState } from 'react';\r\n\r\nimport Radio from '@mui/material/Radio';\r\nimport RadioGroup from '@mui/material/RadioGroup';\r\nimport FormControl from '@mui/material/FormControl';\r\nimport FormLabel from '@mui/material/FormLabel';\r\nimport FormControlLabel from '@mui/material/FormControlLabel';\r\nimport TextField from '@mui/material/TextField';\r\nimport Box from '@mui/material/Box';\r\nimport Typography from '@mui/material/Typography';\r\n\r\nfunction ResolutionSelector({ resolutionMode, setResolutionMode }) {\r\n  //State: input error\r\n  const [isInputSecondsInvalid, setIsInputSecondsInvalid] = useState(false);\r\n  const resolutionTextRef = useRef(null);\r\n\r\n  function onChangeResolutionSelection(event) {\r\n    let newResolutionMode = { ...resolutionMode };\r\n    newResolutionMode.seconds = parseFloat(resolutionTextRef.current.value);\r\n\r\n    switch (event.target.value) {\r\n      case 'sixteenth':\r\n        newResolutionMode.noteResolutionValue = 0.25;\r\n        newResolutionMode.useSeconds = false;\r\n        break;\r\n      case 'eighth':\r\n        newResolutionMode.noteResolutionValue = 0.5;\r\n        newResolutionMode.useSeconds = false;\r\n        break;\r\n      case 'quarter':\r\n        newResolutionMode.noteResolutionValue = 1;\r\n        newResolutionMode.useSeconds = false;\r\n        break;\r\n      case 'half':\r\n        newResolutionMode.noteResolutionValue = 2;\r\n        newResolutionMode.useSeconds = false;\r\n        break;\r\n      case 'whole':\r\n        newResolutionMode.noteResolutionValue = 4;\r\n        newResolutionMode.useSeconds = false;\r\n        break;\r\n      case 'seconds':\r\n        newResolutionMode.useSeconds = true;\r\n        break;\r\n      default:\r\n        break;\r\n    }\r\n\r\n    setResolutionMode(newResolutionMode);\r\n  }\r\n\r\n  return (\r\n    <Box>\r\n      <FormControl component='fieldset'>\r\n        <FormLabel component='legend'>Resolution</FormLabel>\r\n        <RadioGroup\r\n          row\r\n          defaultValue='quarter'\r\n          onChange={onChangeResolutionSelection}\r\n          aria-label='resolution'\r\n          name='row-radio-buttons-group'\r\n        >\r\n          <FormControlLabel\r\n            sx={{ fontSize: '20px' }}\r\n            value='sixteenth'\r\n            control={<Radio size='small' />}\r\n            label={<Typography sx={{ fontSize: '2rem' }}>&#119137;</Typography>}\r\n          />\r\n          <FormControlLabel\r\n            value='eighth'\r\n            control={<Radio size='small' />}\r\n            label={<Typography sx={{ fontSize: '2rem' }}>&#119136;</Typography>}\r\n          />\r\n          <FormControlLabel\r\n            value='quarter'\r\n            control={<Radio size='small' />}\r\n            label={<Typography sx={{ fontSize: '2rem' }}>&#9833;</Typography>}\r\n          />\r\n          <FormControlLabel\r\n            value='half'\r\n            control={<Radio size='small' />}\r\n            label={<Typography sx={{ fontSize: '2rem' }}>&#119134;</Typography>}\r\n          />\r\n          <FormControlLabel\r\n            value='whole'\r\n            control={<Radio size='small' />}\r\n            label={<Typography sx={{ fontSize: '2rem' }}>&#119133;</Typography>}\r\n          />\r\n          <FormControlLabel\r\n            value='seconds'\r\n            control={<Radio size='small' />}\r\n            label={\r\n              <TextField\r\n                sx={{ minHeight: '5rem' }}\r\n                error={isInputSecondsInvalid}\r\n                helperText={isInputSecondsInvalid && 'Invalid input'}\r\n                label='in seconds'\r\n                id='standard-size-small'\r\n                defaultValue='1.5'\r\n                size='small'\r\n                variant='standard'\r\n                onChange={() => {\r\n                  let newResolutionMode = { ...resolutionMode };\r\n                  newResolutionMode.seconds = parseFloat(\r\n                    resolutionTextRef.current.value\r\n                  );\r\n                  if (isNaN(newResolutionMode.seconds))\r\n                    setIsInputSecondsInvalid(true);\r\n                  else {\r\n                    setResolutionMode(newResolutionMode);\r\n                    setIsInputSecondsInvalid(false);\r\n                  }\r\n                }}\r\n                inputRef={resolutionTextRef}\r\n              />\r\n            }\r\n          />\r\n        </RadioGroup>\r\n      </FormControl>\r\n    </Box>\r\n  );\r\n}\r\n\r\nexport default ResolutionSelector;\r\n","import { styled } from '@mui/material/styles';\r\nimport Chip from '@mui/material/Chip';\r\nimport Paper from '@mui/material/Paper';\r\nimport CircleIcon from '@mui/icons-material/Circle';\r\n\r\nconst ListItem = styled('li')(({ theme }) => ({\r\n  margin: theme.spacing(0.5),\r\n}));\r\n\r\nexport default function PcvChipsBox({ userPcvs, setUserPcvs }) {\r\n  const handleDelete = (chipToDelete) => () => {\r\n    setUserPcvs((chips) =>\r\n      chips.filter((chip) => chip.label !== chipToDelete.label)\r\n    );\r\n  };\r\n\r\n  return (\r\n    <Paper\r\n      sx={{\r\n        display: 'flex',\r\n        justifyContent: 'center',\r\n        flexWrap: 'wrap',\r\n        listStyle: 'none',\r\n        p: '5px',\r\n        overflow: 'auto',\r\n        minHeight: '50%',\r\n        width: '100%',\r\n      }}\r\n      component='ul'\r\n    >\r\n      {userPcvs.map((data, i) => {\r\n        return (\r\n          <ListItem key={`${i}`}>\r\n            <Chip\r\n              variant={data.isDisabled ? 'outlined' : 'filled'}\r\n              icon={<CircleIcon style={{ color: data.colours[1] }} />}\r\n              label={data.label}\r\n              onDelete={handleDelete(data)}\r\n              onClick={() => {\r\n                data.isDisabled = !data.isDisabled;\r\n                setUserPcvs([...userPcvs]);\r\n              }}\r\n            />\r\n          </ListItem>\r\n        );\r\n      })}\r\n    </Paper>\r\n  );\r\n}\r\n","export default function Home() {\r\n  return (\r\n    <div>\r\n      <h1>Home - Theory and analysis</h1>\r\n      <p>\r\n        Lorem ipsum dolor sit amet consectetur adipisicing elit. Beatae,\r\n        architecto temporibus laboriosam, atque veniam quod provident minus eos\r\n        aspernatur ipsa ad nihil veritatis ea, eaque amet! Itaque cupiditate\r\n        laudantium neque voluptas necessitatibus quidem perspiciatis molestias\r\n        dolores possimus. Veritatis perferendis, quidem molestiae ipsa\r\n        reprehenderit aperiam harum iste obcaecati doloribus, recusandae\r\n        adipisci et saepe non qui illum ratione nemo amet voluptates dolore\r\n        exercitationem provident. Ea sed incidunt cum eum excepturi vitae\r\n        consequuntur eius quam earum? Repudiandae explicabo incidunt molestiae\r\n        animi. Quibusdam veniam rerum minima error, quos voluptas incidunt. Est\r\n        ex nesciunt ea id, dolor harum nemo quo quibusdam molestias dicta quae\r\n        modi inventore. Sit dicta iure voluptatum modi. Recusandae harum\r\n        blanditiis in dolore quasi officiis minus quos veritatis eveniet\r\n        corporis eaque odio esse deserunt dolorum quod qui tempore, asperiores\r\n        repellat numquam dolorem nobis! Provident soluta officiis temporibus\r\n        optio, sapiente aspernatur accusantium ipsam velit necessitatibus natus\r\n        placeat obcaecati consectetur quia. Reiciendis ipsum tempora non, dicta\r\n        quod nesciunt. Magni, harum laudantium inventore omnis fugiat quia\r\n        explicabo temporibus itaque officiis minus autem cumque! Necessitatibus\r\n        dolorum aliquid omnis, sed ullam voluptatem reiciendis voluptate. Ad\r\n        minima voluptatem praesentium totam eum consequuntur reiciendis quae\r\n        soluta ipsam cupiditate? Officia labore modi illum libero error ad fugit\r\n        sit nostrum, totam esse magnam doloremque repellendus. Similique, iure\r\n        sed voluptatem quia molestiae aut incidunt facilis sequi! Veniam\r\n        cupiditate optio magnam officiis cumque beatae laudantium, quas natus at\r\n        aliquid nostrum, voluptatem aliquam quia doloremque, fugit fuga facere\r\n        esse. Nostrum numquam nam, praesentium iusto accusamus quasi delectus\r\n        rem vero laborum, optio blanditiis commodi id quidem beatae in.\r\n        Laudantium fugit aspernatur impedit quam maiores officiis! Odit, est\r\n        quae obcaecati repudiandae modi aliquid corporis natus dolores harum\r\n        porro perferendis magni nam. Aperiam provident accusamus soluta optio\r\n        eaque incidunt, quos modi nulla eligendi quo unde ipsa. Maxime\r\n        distinctio minus beatae consequuntur assumenda ab vitae pariatur.\r\n        Commodi maiores eius esse totam accusantium molestiae accusamus quas\r\n        fugiat placeat quaerat voluptate corrupti architecto sapiente reiciendis\r\n        obcaecati molestias, at tempore quisquam! Quam ratione aliquid quo illo\r\n        delectus eaque quae reiciendis dicta corporis obcaecati, nesciunt\r\n        veritatis molestiae impedit ut mollitia nam quisquam in aut quia nemo.\r\n        Ducimus nulla assumenda numquam debitis recusandae dicta quam amet\r\n        dolores, reprehenderit reiciendis ipsum sapiente sit alias obcaecati\r\n        praesentium consequatur ipsa natus iste distinctio officia vel fugiat\r\n        dolore delectus. Molestiae vero omnis blanditiis perspiciatis quibusdam,\r\n        ipsam quo fugiat sunt pariatur minima aperiam ratione, unde distinctio\r\n        porro incidunt praesentium repellendus aliquam autem dolores natus. Ab\r\n        corporis earum veniam corrupti neque aperiam! Perferendis, eligendi,\r\n        praesentium totam quia excepturi exercitationem dolores debitis cumque\r\n        optio consectetur et suscipit cupiditate fuga nam commodi minima\r\n        molestiae odit consequatur id enim aut quisquam eum. Modi dolores fuga\r\n        neque praesentium repellendus, aspernatur ea quod? Corporis quaerat,\r\n        nobis culpa quod nesciunt eum distinctio itaque cumque molestias\r\n        impedit, deleniti delectus. Eum repellat architecto velit delectus eius\r\n        praesentium, temporibus a nobis ad unde quaerat minus illum eos culpa\r\n        earum possimus? Doloribus nostrum, impedit aut, officia amet at fuga\r\n        velit minima tempora, harum molestiae non nisi quia maxime? Odio quo\r\n        reiciendis nostrum repudiandae, alias delectus aut ullam quisquam. Eius?\r\n      </p>\r\n    </div>\r\n  );\r\n}\r\n","export default function Theory() {\r\n  return (\r\n    <div>\r\n      <h1>Theory page</h1>\r\n      <p>\r\n        Lorem ipsum dolor sit amet consectetur adipisicing elit. Beatae,\r\n        architecto temporibus laboriosam, atque veniam quod provident minus eos\r\n        aspernatur ipsa ad nihil veritatis ea, eaque amet! Itaque cupiditate\r\n        laudantium neque voluptas necessitatibus quidem perspiciatis molestias\r\n        dolores possimus. Veritatis perferendis, quidem molestiae ipsa\r\n        reprehenderit aperiam harum iste obcaecati doloribus, recusandae\r\n        adipisci et saepe non qui illum ratione nemo amet voluptates dolore\r\n        exercitationem provident. Ea sed incidunt cum eum excepturi vitae\r\n        consequuntur eius quam earum? Repudiandae explicabo incidunt molestiae\r\n        animi. Quibusdam veniam rerum minima error, quos voluptas incidunt. Est\r\n        ex nesciunt ea id, dolor harum nemo quo quibusdam molestias dicta quae\r\n        modi inventore. Sit dicta iure voluptatum modi. Recusandae harum\r\n        blanditiis in dolore quasi officiis minus quos veritatis eveniet\r\n        corporis eaque odio esse deserunt dolorum quod qui tempore, asperiores\r\n        repellat numquam dolorem nobis! Provident soluta officiis temporibus\r\n        optio, sapiente aspernatur accusantium ipsam velit necessitatibus natus\r\n        placeat obcaecati consectetur quia. Reiciendis ipsum tempora non, dicta\r\n        quod nesciunt. Magni, harum laudantium inventore omnis fugiat quia\r\n        explicabo temporibus itaque officiis minus autem cumque! Necessitatibus\r\n        dolorum aliquid omnis, sed ullam voluptatem reiciendis voluptate. Ad\r\n        minima voluptatem praesentium totam eum consequuntur reiciendis quae\r\n        soluta ipsam cupiditate? Officia labore modi illum libero error ad fugit\r\n        sit nostrum, totam esse magnam doloremque repellendus. Similique, iure\r\n        sed voluptatem quia molestiae aut incidunt facilis sequi! Veniam\r\n        cupiditate optio magnam officiis cumque beatae laudantium, quas natus at\r\n        aliquid nostrum, voluptatem aliquam quia doloremque, fugit fuga facere\r\n        esse. Nostrum numquam nam, praesentium iusto accusamus quasi delectus\r\n        rem vero laborum, optio blanditiis commodi id quidem beatae in.\r\n        Laudantium fugit aspernatur impedit quam maiores officiis! Odit, est\r\n        quae obcaecati repudiandae modi aliquid corporis natus dolores harum\r\n        porro perferendis magni nam. Aperiam provident accusamus soluta optio\r\n        eaque incidunt, quos modi nulla eligendi quo unde ipsa. Maxime\r\n        distinctio minus beatae consequuntur assumenda ab vitae pariatur.\r\n        Commodi maiores eius esse totam accusantium molestiae accusamus quas\r\n        fugiat placeat quaerat voluptate corrupti architecto sapiente reiciendis\r\n        obcaecati molestias, at tempore quisquam! Quam ratione aliquid quo illo\r\n        delectus eaque quae reiciendis dicta corporis obcaecati, nesciunt\r\n        veritatis molestiae impedit ut mollitia nam quisquam in aut quia nemo.\r\n        Ducimus nulla assumenda numquam debitis recusandae dicta quam amet\r\n        dolores, reprehenderit reiciendis ipsum sapiente sit alias obcaecati\r\n        praesentium consequatur ipsa natus iste distinctio officia vel fugiat\r\n        dolore delectus. Molestiae vero omnis blanditiis perspiciatis quibusdam,\r\n        ipsam quo fugiat sunt pariatur minima aperiam ratione, unde distinctio\r\n        porro incidunt praesentium repellendus aliquam autem dolores natus. Ab\r\n        corporis earum veniam corrupti neque aperiam! Perferendis, eligendi,\r\n        praesentium totam quia excepturi exercitationem dolores debitis cumque\r\n        optio consectetur et suscipit cupiditate fuga nam commodi minima\r\n        molestiae odit consequatur id enim aut quisquam eum. Modi dolores fuga\r\n        neque praesentium repellendus, aspernatur ea quod? Corporis quaerat,\r\n        nobis culpa quod nesciunt eum distinctio itaque cumque molestias\r\n        impedit, deleniti delectus. Eum repellat architecto velit delectus eius\r\n        praesentium, temporibus a nobis ad unde quaerat minus illum eos culpa\r\n        earum possimus? Doloribus nostrum, impedit aut, officia amet at fuga\r\n        velit minima tempora, harum molestiae non nisi quia maxime? Odio quo\r\n        reiciendis nostrum repudiandae, alias delectus aut ullam quisquam. Eius?\r\n      </p>\r\n    </div>\r\n  );\r\n}\r\n","import { useRef, useEffect, useState } from 'react';\r\n\r\nconst verticalScale = Math.sin(Math.PI / 3);\r\n\r\nexport const Wavescape = ({ wavescapeMatrix, currentWavescapeSubdiv }) => {\r\n  const canvasRef = useRef(null);\r\n  const [wsCoordinates, setWsCoordinates] = useState([]);\r\n  let width = 440;\r\n  let height = 440;\r\n  const margin = 40;\r\n  let ticks;\r\n\r\n  useEffect(() => {\r\n    const canvas = canvasRef.current;\r\n    const ctx = canvas.getContext('2d');\r\n\r\n    // increase the actual size of our canvas\r\n    //canvas.width = width * devicePixelRatio;\r\n    //canvas.height = height * devicePixelRatio;\r\n\r\n    // ensure all drawing operations are scaled\r\n    //ctx.scale(devicePixelRatio, devicePixelRatio);\r\n\r\n    // scale everything down using CSS\r\n    //canvas.style.width = width + 'px';\r\n    //canvas.style.height = height + 'px';\r\n\r\n    let margins = [margin, margin];\r\n    let innerSize = [canvas.width - margins[0], canvas.height - margins[1]];\r\n    let baseSubdivision;\r\n\r\n    if (wavescapeMatrix) {\r\n      baseSubdivision = wavescapeMatrix[0].length;\r\n      ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);\r\n      //ctx.setTransform(1, 0, 0, -1, 0, ctx.canvas.height);\r\n      ticks = computeTicks(\r\n        innerSize[0],\r\n        innerSize[1],\r\n        baseSubdivision,\r\n        margins[0],\r\n        margins[1]\r\n      );\r\n\r\n      setWsCoordinates(ticks);\r\n\r\n      //Vertical scaling to make the triangle equilateral\r\n      //ctx.scale(1, verticalScale);\r\n      drawWavescape(ticks, ctx, wavescapeMatrix);\r\n    }\r\n  }, [wavescapeMatrix, width, height]);\r\n\r\n  useEffect(() => {}, [wavescapeMatrix]);\r\n\r\n  return (\r\n    <svg\r\n      width={width + margin}\r\n      height={height + margin}\r\n      transform={`scale(${1}, ${-verticalScale})`}\r\n    >\r\n      <foreignObject x={0} y={0} width={width} height={height}>\r\n        <canvas width={width} height={height} ref={canvasRef}></canvas>\r\n      </foreignObject>\r\n      <g\r\n      /*  transform={`scale(${1 / devicePixelRatio}, ${\r\n          1 / devicePixelRatio\r\n        }) translate(${0},${height * devicePixelRatio})`} */\r\n      >\r\n        {/* //Line ticks */}\r\n        {wsCoordinates.length > 0\r\n          ? wsCoordinates[0].map((coord, i) => (\r\n              <line\r\n                key={`tick${i}`}\r\n                x1={coord.x}\r\n                x2={coord.x}\r\n                y1={coord.y - 3}\r\n                y2={coord.y + 3}\r\n                stroke='grey'\r\n                strokeWidth='1px'\r\n              />\r\n            ))\r\n          : null}\r\n        {/* Contour line */}\r\n        {wsCoordinates.length > 0 ? (\r\n          <>\r\n            <line\r\n              x1={wsCoordinates[0][0].x}\r\n              x2={wsCoordinates[0][wsCoordinates[0].length - 1].x}\r\n              y1={wsCoordinates[0][0].y}\r\n              y2={wsCoordinates[0][wsCoordinates[0].length - 1].y}\r\n              stroke='grey'\r\n              strokeWidth='2px'\r\n            />\r\n            <line\r\n              x1={wsCoordinates[0][wsCoordinates[0].length - 1].x}\r\n              x2={wsCoordinates[wsCoordinates.length - 1][0].x}\r\n              y1={wsCoordinates[0][wsCoordinates[0].length - 1].y}\r\n              y2={wsCoordinates[wsCoordinates.length - 1][0].y}\r\n              stroke='grey'\r\n              strokeWidth='1px'\r\n            />\r\n            <line\r\n              x1={wsCoordinates[0][0].x}\r\n              x2={wsCoordinates[wsCoordinates.length - 1][0].x}\r\n              y1={wsCoordinates[0][0].y}\r\n              y2={wsCoordinates[wsCoordinates.length - 1][0].y}\r\n              stroke='grey'\r\n              strokeWidth='1px'\r\n            />\r\n            <circle\r\n              cx={\r\n                (wsCoordinates[0][currentWavescapeSubdiv].x +\r\n                  wsCoordinates[0][currentWavescapeSubdiv + 1].x) /\r\n                2\r\n              }\r\n              cy={\r\n                (wsCoordinates[0][currentWavescapeSubdiv].y +\r\n                  wsCoordinates[0][currentWavescapeSubdiv + 1].y) /\r\n                2\r\n              }\r\n              r={4}\r\n              fill='white'\r\n            />\r\n            <circle\r\n              cx={\r\n                (wsCoordinates[0][currentWavescapeSubdiv].x +\r\n                  wsCoordinates[0][currentWavescapeSubdiv + 1].x) /\r\n                2\r\n              }\r\n              cy={\r\n                (wsCoordinates[0][currentWavescapeSubdiv].y +\r\n                  wsCoordinates[0][currentWavescapeSubdiv + 1].y) /\r\n                2\r\n              }\r\n              r={4}\r\n              stroke='black'\r\n              strokeWidth={2}\r\n              fill='transparent'\r\n            />\r\n          </>\r\n        ) : null}\r\n      </g>\r\n    </svg>\r\n  );\r\n};\r\n\r\nfunction computeTicks(\r\n  innerWidth,\r\n  innerHeight,\r\n  baseSubdivision,\r\n  marginLeft,\r\n  marginTop\r\n) {\r\n  //Actually, it is a square matrix\r\n  let unit = innerWidth / baseSubdivision;\r\n  let mat = [];\r\n\r\n  for (let i = 0; i < baseSubdivision + 1; i++) {\r\n    let temp = [];\r\n    for (let j = 0; j < baseSubdivision + 1; j++) {\r\n      if (i <= j)\r\n        temp.push({\r\n          x: (j - i) * unit + (i * unit) / 2 + marginLeft,\r\n          y: i * unit + marginTop,\r\n        });\r\n    }\r\n    mat.push(temp);\r\n  }\r\n\r\n  return mat;\r\n}\r\n\r\nfunction drawWavescape(ticks, ctx, wavescapeMatrix) {\r\n  for (let i = 0; i < ticks.length - 1; i++) {\r\n    for (let j = 0; j < ticks[i].length - 1; j++) {\r\n      if (i === 0) {\r\n        //first row composed by triangles\r\n        ctx.beginPath();\r\n        ctx.moveTo(ticks[i][j].x, ticks[i][j].y);\r\n        ctx.lineTo(ticks[i][j + 1].x, ticks[i][j + 1].y);\r\n        ctx.lineTo(ticks[i + 1][j].x, ticks[i + 1][j].y);\r\n        ctx.fillStyle = wavescapeMatrix[i][j];\r\n        ctx.fill();\r\n      } else {\r\n        //other rows composed by diamonds\r\n        ctx.beginPath();\r\n        ctx.moveTo(ticks[i][j].x, ticks[i][j].y);\r\n        ctx.lineTo(ticks[i - 1][j + 1].x, ticks[i - 1][j + 1].y);\r\n        ctx.lineTo(ticks[i][j + 1].x, ticks[i][j + 1].y);\r\n        ctx.lineTo(ticks[i + 1][j].x, ticks[i + 1][j].y);\r\n        ctx.fillStyle = wavescapeMatrix[i][j];\r\n        ctx.fill();\r\n      }\r\n    }\r\n  }\r\n}\r\n","import { Wavescape } from './Wavescape';\r\n\r\nimport Box from '@mui/material/Box';\r\nimport { Typography } from '@mui/material';\r\n\r\nfunction WavescapeModule({ wavescapesData, currentWavescapeSubdiv }) {\r\n  return (\r\n    <Box>\r\n      {wavescapesData.length > 0 ? (\r\n        wavescapesData.map((data, i) => (\r\n          <Wavescape\r\n            key={`w.${i}`}\r\n            wavescapeMatrix={data}\r\n            currentWavescapeSubdiv={currentWavescapeSubdiv}\r\n          />\r\n        ))\r\n      ) : (\r\n        <Typography>Upload a midi file first</Typography>\r\n      )}\r\n    </Box>\r\n  );\r\n}\r\n\r\nexport default WavescapeModule;\r\n","import * as d3 from 'd3';\r\nimport { useRef, useEffect } from 'react';\r\nimport { pixelColor } from './colorMapping';\r\n\r\n//Minus before every y coordinate due to the fact that svg has positive y\r\n//downward, meanwhile cartesian plane has positive y upward\r\n\r\nfunction Circle({\r\n  protoDataCoeff,\r\n  traceDataCoeff,\r\n  userPcvsCoeff,\r\n  currentSubdiv,\r\n  performanceCoeff,\r\n}) {\r\n  const canvasRef = useRef(null);\r\n  const width = 440;\r\n  const height = width;\r\n\r\n  const margin = 40;\r\n  const innerWidth = width - margin;\r\n  const circleRadius = width / 2 - margin;\r\n\r\n  let marksRadiusRatio = 0.01;\r\n\r\n  useEffect(() => {\r\n    const canvas = canvasRef.current;\r\n    const ctx = canvas.getContext('2d');\r\n    let radius = Math.floor(circleRadius * devicePixelRatio);\r\n    let image = ctx.createImageData(2 * radius, 2 * radius);\r\n    let data = image.data;\r\n\r\n    // increase the actual size of our canvas\r\n    canvas.width = width * devicePixelRatio;\r\n    canvas.height = height * devicePixelRatio;\r\n\r\n    // ensure all drawing operations are scaled\r\n    ctx.scale(devicePixelRatio, devicePixelRatio);\r\n\r\n    // scale everything down using CSS\r\n    canvas.style.width = width + 'px';\r\n    canvas.style.height = height + 'px';\r\n\r\n    for (let x = -radius; x < radius; x++) {\r\n      for (let y = -radius; y < radius; y++) {\r\n        let distance = Math.sqrt(x * x + y * y);\r\n\r\n        if (distance > radius) {\r\n          // skip all (x,y) coordinates that are outside of the circle\r\n          continue;\r\n        }\r\n        // Figure out the starting index of this pixel in the image data array.\r\n        let rowLength = 2 * radius;\r\n        let adjustedX = x + radius; // convert x from [-50, 50] to [0, 100] (the coordinates of the image data array)\r\n        let adjustedY = y + radius; // convert y from [-50, 50] to [0, 100] (the coordinates of the image data array)\r\n        let pixelWidth = 4; // each pixel requires 4 slots in the data array\r\n        let index = (adjustedX + adjustedY * rowLength) * pixelWidth;\r\n        let rgba = pixelColor(x, y, distance / radius);\r\n        data[index] = rgba.r;\r\n        data[index + 1] = rgba.g;\r\n        data[index + 2] = rgba.b;\r\n        data[index + 3] = rgba.a;\r\n      }\r\n    }\r\n    ctx.putImageData(image, 0, 0);\r\n  }, [width, height, circleRadius]);\r\n\r\n  useEffect(() => {\r\n    //Workaround for chrome bug on canvas overlay in foreignObj SVG\r\n    canvasRef.current.getContext('2d').getImageData(0, 0, 1, 1);\r\n  }, []);\r\n\r\n  const circleMark = (pcvData, radiusScaleWidth, color, id, opacity = 1) => {\r\n    const mark = d3\r\n      .arc()\r\n      .innerRadius(0)\r\n      .outerRadius((radiusScaleWidth * width) / 2)\r\n      .startAngle(0)\r\n      .endAngle(2 * Math.PI);\r\n\r\n    return (\r\n      <path\r\n        transform={`translate(${pcvData.x * circleRadius},${\r\n          -pcvData.y * circleRadius\r\n        })`}\r\n        fill={color}\r\n        fillOpacity={opacity}\r\n        key={id}\r\n        d={mark()}\r\n      ></path>\r\n    );\r\n  };\r\n\r\n  const protoCircleMark = (pcvData, id) => {\r\n    let scaleRatio = 0.02;\r\n    const mark = d3\r\n      .arc()\r\n      .innerRadius((scaleRatio * width) / 2)\r\n      .outerRadius(((scaleRatio + 0.01) * width) / 2)\r\n      .startAngle(0)\r\n      .endAngle(2 * Math.PI);\r\n\r\n    //Check for sub/superscript\r\n    let labelName = '';\r\n    let subSup = '';\r\n    let isSub = false;\r\n    if (pcvData.label.includes('_') || pcvData.label.includes('^')) {\r\n      for (let i = 0; i < pcvData.label.length; i++) {\r\n        if (pcvData.label[i] === '_') {\r\n          labelName = pcvData.label.slice(0, i);\r\n          subSup = pcvData.label.slice(i + 1, pcvData.label.length);\r\n          isSub = true;\r\n        }\r\n        if (pcvData.label[i] === '^') {\r\n          labelName = pcvData.label.slice(0, i);\r\n          subSup = pcvData.label.slice(i + 1, pcvData.label.length);\r\n        }\r\n      }\r\n    } else {\r\n      labelName = pcvData.label;\r\n    }\r\n\r\n    //Computation of label offset\r\n    let dxOffset = 0,\r\n      dyOffset = 5;\r\n\r\n    if (Math.sign(pcvData.x) === 1) dxOffset = 20;\r\n    else if (Math.sign(pcvData.x) === -1) dxOffset = -20;\r\n\r\n    if (Math.sign(-pcvData.y) === 1) dyOffset = 25;\r\n    else if (Math.sign(-pcvData.y) === -1) dyOffset = -8;\r\n\r\n    if (pcvData.x === 0 && pcvData.y === 0) {\r\n      dxOffset = 15;\r\n      dyOffset = 5;\r\n    }\r\n\r\n    return (\r\n      <g\r\n        transform={`translate(${pcvData.x * circleRadius},${\r\n          -pcvData.y * circleRadius\r\n        })`}\r\n        key={`p.${id}`}\r\n      >\r\n        <path fill={'grey'} key={id} d={mark()}></path>\r\n        <text textAnchor='middle' dx={dxOffset} dy={dyOffset} fontSize='20px'>\r\n          {labelName}\r\n          {isSub ? (\r\n            <tspan fontSize={15} baselineShift='sub'>\r\n              {subSup}\r\n            </tspan>\r\n          ) : (\r\n            <tspan fontSize={15} baselineShift='super'>\r\n              {subSup}\r\n            </tspan>\r\n          )}\r\n        </text>\r\n      </g>\r\n    );\r\n  };\r\n\r\n  const drawBorder = () => {\r\n    return (\r\n      <path\r\n        fill={'azure'}\r\n        d={d3\r\n          .arc()\r\n          .innerRadius(circleRadius - 1)\r\n          .outerRadius(circleRadius + 1)\r\n          .startAngle(0)\r\n          .endAngle(2 * Math.PI)()}\r\n      ></path>\r\n    );\r\n  };\r\n\r\n  const highlightSubdiv = (radiusScaleWidth) => {\r\n    const mark = d3\r\n      .arc()\r\n      .innerRadius(0)\r\n      .outerRadius((radiusScaleWidth * width) / 2)\r\n      .startAngle(0)\r\n      .endAngle(2 * Math.PI);\r\n\r\n    const highlight = d3\r\n      .arc()\r\n      .innerRadius((radiusScaleWidth * width) / 2)\r\n      .outerRadius(((radiusScaleWidth + 0.005) * width) / 2)\r\n      .startAngle(0)\r\n      .endAngle(2 * Math.PI);\r\n\r\n    let highlightedTrace = [];\r\n    let length = 10;\r\n    let opacityArray = [];\r\n\r\n    opacityArray.push(1);\r\n    for (let i = 1; i < length; i++) {\r\n      opacityArray.push(opacityArray[i - 1] * 0.8);\r\n    }\r\n\r\n    if (currentSubdiv < length)\r\n      highlightedTrace = traceDataCoeff.slice(0, currentSubdiv + 1);\r\n    else\r\n      highlightedTrace = traceDataCoeff.slice(\r\n        currentSubdiv - length,\r\n        currentSubdiv\r\n      );\r\n\r\n    highlightedTrace = highlightedTrace.reverse();\r\n\r\n    return highlightedTrace.map((coeff, i) => {\r\n      return (\r\n        <g key={`g.${i}`}>\r\n          <path\r\n            transform={`translate(${coeff.x * circleRadius},${\r\n              -coeff.y * circleRadius\r\n            })`}\r\n            fill={'white'}\r\n            key={i}\r\n            fillOpacity={opacityArray[i]}\r\n            d={mark()}\r\n          ></path>\r\n          <path\r\n            transform={`translate(${coeff.x * circleRadius},${\r\n              -coeff.y * circleRadius\r\n            })`}\r\n            fill={'black'}\r\n            fillOpacity={opacityArray[i]}\r\n            key={`t.${i}`}\r\n            d={highlight()}\r\n          ></path>\r\n        </g>\r\n      );\r\n    });\r\n  };\r\n\r\n  return (\r\n    <>\r\n      <svg width={width} height={height}>\r\n        <foreignObject x={margin} y={margin} width={width} height={height}>\r\n          <canvas\r\n            style={{ zIndex: '-1' }}\r\n            width={width}\r\n            height={height}\r\n            ref={canvasRef}\r\n          />\r\n        </foreignObject>\r\n        <g transform={`translate(${width / 2},${width / 2})`}>\r\n          {drawBorder()}\r\n          {protoDataCoeff\r\n            ? protoDataCoeff.map((pcv, i) => protoCircleMark(pcv, i))\r\n            : null}\r\n          {/* {traceDataCoeff\r\n            ? traceDataCoeff.map((pcv, i) =>\r\n                circleMark(pcv, marksRadiusRatio, 'black', i, 0.1)\r\n              )\r\n            : null} */}\r\n          {traceDataCoeff ? highlightSubdiv(marksRadiusRatio) : null}\r\n          {userPcvsCoeff\r\n            ? userPcvsCoeff.map((pcv, i) => {\r\n                if (!pcv.isDisabled)\r\n                  return circleMark(\r\n                    pcv,\r\n                    marksRadiusRatio + 0.015,\r\n                    pcv.color,\r\n                    i\r\n                  );\r\n              })\r\n            : null}\r\n          {circleMark(performanceCoeff, marksRadiusRatio * 2, 'teal')}\r\n        </g>\r\n      </svg>\r\n    </>\r\n  );\r\n}\r\n\r\nexport default Circle;\r\n","export const prototypesData = [\r\n  [\r\n    { label: '', x: 0, y: 0 },\r\n    { label: 'C', x: 1, y: 0 },\r\n    { label: 'C', x: 0.866, y: -0.5 },\r\n    { label: 'D', x: 0.5, y: -0.866 },\r\n    { label: 'E', x: 0, y: -1 },\r\n    { label: 'E', x: -0.5, y: -0.866 },\r\n    { label: 'F', x: -0.866, y: -0.5 },\r\n    { label: 'F', x: -1, y: 0 },\r\n    { label: 'G', x: -0.866, y: 0.5 },\r\n    { label: 'A', x: -0.5, y: 0.866 },\r\n    { label: 'A', x: 0, y: 1 },\r\n    { label: 'B', x: 0.5, y: 0.866 },\r\n    { label: 'B', x: 0.866, y: 0.5 },\r\n  ],\r\n  [\r\n    { label: '', x: 0, y: 0 },\r\n    { label: 'T_0', x: 1, y: 0 },\r\n    { label: 'T_1', x: 0.5, y: -0.866 },\r\n    { label: 'T_2', x: -0.5, y: -0.866 },\r\n    { label: 'T_3', x: -1, y: 0 },\r\n    { label: 'T_4', x: -0.5, y: 0.866 },\r\n    { label: 'T_5', x: 0.5, y: 0.866 },\r\n  ],\r\n  [\r\n    { label: '', x: 0, y: 0 },\r\n    { label: 'C+', x: 1, y: 0 },\r\n    { label: 'C+', x: 0, y: -1 },\r\n    { label: 'D+', x: -1, y: 0 },\r\n    { label: 'D+', x: 0, y: 1 },\r\n    { label: 'H_0,3', x: 0.5, y: 0.5 },\r\n    { label: 'H_0,1', x: 0.5, y: -0.5 },\r\n    { label: 'H_1,2', x: -0.5, y: -0.5 },\r\n    { label: 'H_2,3', x: -0.5, y: 0.5 },\r\n  ],\r\n  [\r\n    { label: '', x: 0, y: 0 },\r\n    { label: 'C^o7', x: 1, y: 0 },\r\n    { label: 'C^o7', x: -0.5, y: -0.866 },\r\n    { label: 'D^o7', x: -0.5, y: 0.866 },\r\n    { label: 'O_0,2', x: 0.25, y: 0.433 },\r\n    { label: 'O_0,1', x: 0.25, y: -0.433 },\r\n    { label: 'O_1,2', x: -0.5, y: 0 },\r\n  ],\r\n  [\r\n    { label: '', x: 0, y: 0 },\r\n    { label: 'C', x: 1, y: 0 },\r\n    { label: 'F', x: 0.866, y: -0.5 },\r\n    { label: 'B', x: 0.5, y: -0.866 },\r\n    { label: 'E', x: 0, y: -1 },\r\n    { label: 'A', x: -0.5, y: -0.866 },\r\n    { label: 'C', x: -0.866, y: -0.5 },\r\n    { label: 'F', x: -1, y: 0 },\r\n    { label: 'B', x: -0.866, y: 0.5 },\r\n    { label: 'E', x: -0.5, y: 0.866 },\r\n    { label: 'A', x: 0, y: 1 },\r\n    { label: 'D', x: 0.5, y: 0.866 },\r\n    { label: 'G', x: 0.866, y: 0.5 },\r\n    { label: '', x: 0.267, y: 0.462 },\r\n    { label: '5', x: 0, y: -0.533 },\r\n    { label: '2', x: -0.267, y: 0.462 },\r\n    { label: '3', x: 0.462, y: -0.267 },\r\n    { label: '4', x: -0.533, y: 0 },\r\n    { label: '', x: 0.462, y: 0.267 },\r\n    { label: '6', x: -0.267, y: -0.462 },\r\n    { label: '', x: 0, y: 0.533 },\r\n    { label: '4', x: 0.267, y: -0.462 },\r\n    { label: '3', x: -0.462, y: 0.267 },\r\n    { label: '2', x: 0.533, y: 0 },\r\n    { label: '5', x: -0.462, y: -0.267 },\r\n  ],\r\n  [\r\n    { label: '', x: 0, y: 0 },\r\n    { label: 'WT_1', x: 1, y: 0 },\r\n    { label: 'WT_2', x: -1, y: 0 },\r\n  ],\r\n];\r\n","import Circle from './Circle';\r\nimport { useEffect, useState } from 'react';\r\nimport { prototypesData } from './prototypesData';\r\n\r\nfunction CoefficientsModule({\r\n  coeffTracesData,\r\n  showPrototypes,\r\n  userPcvs,\r\n  currentSubdiv,\r\n  midiDevNotesDftCoeffs,\r\n}) {\r\n  const [selectedProtoPitchClasses, setSelectedProtoPitchClasses] =\r\n    useState(prototypesData);\r\n\r\n  const [subdivUserPcvs, setSubdivUserPcvs] = useState([]);\r\n\r\n  useEffect(() => {\r\n    if (showPrototypes) {\r\n      setSelectedProtoPitchClasses(prototypesData);\r\n    } else setSelectedProtoPitchClasses([]);\r\n  }, [showPrototypes]);\r\n\r\n  useEffect(() => {\r\n    //Subdividing the coeffs for each circle\r\n    let tempSubdivUserPcvs = [];\r\n    for (let i = 1; i < 7; i++) {\r\n      let temp = [];\r\n      for (let j = 0; j < userPcvs.length; j++) {\r\n        temp.push({\r\n          x: userPcvs[j].coeffs[i].re,\r\n          y: userPcvs[j].coeffs[i].im,\r\n          color: userPcvs[j].colours[i],\r\n          isDisabled: userPcvs[j].isDisabled,\r\n        });\r\n      }\r\n      tempSubdivUserPcvs.push(temp);\r\n    }\r\n\r\n    setSubdivUserPcvs(tempSubdivUserPcvs);\r\n  }, [userPcvs]);\r\n\r\n  return (\r\n    <>\r\n      <Circle\r\n        protoDataCoeff={selectedProtoPitchClasses[0]}\r\n        traceDataCoeff={coeffTracesData[0]}\r\n        userPcvsCoeff={subdivUserPcvs[0]}\r\n        currentSubdiv={currentSubdiv}\r\n        performanceCoeff={midiDevNotesDftCoeffs[1]}\r\n      />\r\n      <Circle\r\n        protoDataCoeff={selectedProtoPitchClasses[1]}\r\n        traceDataCoeff={coeffTracesData[1]}\r\n        userPcvsCoeff={subdivUserPcvs[1]}\r\n        currentSubdiv={currentSubdiv}\r\n        performanceCoeff={midiDevNotesDftCoeffs[2]}\r\n      />\r\n      <Circle\r\n        protoDataCoeff={selectedProtoPitchClasses[2]}\r\n        traceDataCoeff={coeffTracesData[2]}\r\n        userPcvsCoeff={subdivUserPcvs[2]}\r\n        currentSubdiv={currentSubdiv}\r\n        performanceCoeff={midiDevNotesDftCoeffs[3]}\r\n      />\r\n      <Circle\r\n        protoDataCoeff={selectedProtoPitchClasses[3]}\r\n        traceDataCoeff={coeffTracesData[3]}\r\n        userPcvsCoeff={subdivUserPcvs[3]}\r\n        currentSubdiv={currentSubdiv}\r\n        performanceCoeff={midiDevNotesDftCoeffs[4]}\r\n      />\r\n      <Circle\r\n        protoDataCoeff={selectedProtoPitchClasses[4]}\r\n        traceDataCoeff={coeffTracesData[4]}\r\n        userPcvsCoeff={subdivUserPcvs[4]}\r\n        currentSubdiv={currentSubdiv}\r\n        performanceCoeff={midiDevNotesDftCoeffs[5]}\r\n      />\r\n      <Circle\r\n        protoDataCoeff={selectedProtoPitchClasses[5]}\r\n        traceDataCoeff={coeffTracesData[5]}\r\n        userPcvsCoeff={subdivUserPcvs[5]}\r\n        currentSubdiv={currentSubdiv}\r\n        performanceCoeff={midiDevNotesDftCoeffs[6]}\r\n      />\r\n    </>\r\n  );\r\n}\r\n\r\nexport default CoefficientsModule;\r\n","import { useState, useEffect } from 'react';\r\nimport * as Tone from 'tone';\r\nimport WavescapeModule from '../WavescapeModule';\r\nimport CoefficientsModule from '../CoefficientsModule';\r\n\r\nimport Player from '../Player';\r\n\r\nimport dft from '../DFT';\r\n\r\nimport Box from '@mui/material/Box';\r\nimport FormGroup from '@mui/material/FormGroup';\r\nimport FormControlLabel from '@mui/material/FormControlLabel';\r\nimport Switch from '@mui/material/Switch';\r\n\r\n//Drawer mui components\r\nimport { styled } from '@mui/material/styles';\r\nimport Typography from '@mui/material/Typography';\r\n\r\n//Accordion mui components\r\nimport Accordion from '@mui/material/Accordion';\r\nimport AccordionSummary from '@mui/material/AccordionSummary';\r\nimport AccordionDetails from '@mui/material/AccordionDetails';\r\nimport ExpandMoreIcon from '@mui/icons-material/ExpandMore';\r\n\r\n//Bottom appbar\r\nimport MuiAppBar from '@mui/material/AppBar';\r\nimport Toolbar from '@mui/material/Toolbar';\r\n\r\nconst drawerWidth = 400;\r\n\r\nconst AppBar = styled(MuiAppBar, {\r\n  shouldForwardProp: (prop) => prop !== 'open',\r\n})(({ theme, open }) => ({\r\n  transition: theme.transitions.create(['margin', 'width'], {\r\n    easing: theme.transitions.easing.sharp,\r\n    duration: theme.transitions.duration.leavingScreen,\r\n  }),\r\n  ...(open && {\r\n    width: `calc(100% - ${drawerWidth}px)`,\r\n    marginLeft: `${drawerWidth}px`,\r\n    transition: theme.transitions.create(['margin', 'width'], {\r\n      easing: theme.transitions.easing.easeOut,\r\n      duration: theme.transitions.duration.enteringScreen,\r\n    }),\r\n  }),\r\n}));\r\n\r\nfunction Application({\r\n  open,\r\n  setOpen,\r\n  wavescapesData,\r\n  coeffTracesData,\r\n  currentSubdiv,\r\n  currentWavescapeSubdiv,\r\n  userPcvs,\r\n}) {\r\n  //State: represents the selected row on the wavescape (by default the first row) for each coeff\r\n  const [showPrototypes, setShowPrototypes] = useState(true);\r\n\r\n  //MIDI inputs\r\n  const [midiDevNotesDftCoeffs, setMidiDevNotesDftCoeffs] = useState(\r\n    dft([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]).map((coeff) => {\r\n      return { x: coeff.re, y: coeff.im };\r\n    })\r\n  );\r\n\r\n  //Open drawer when page loads\r\n  useEffect(() => {\r\n    setOpen(true);\r\n  }, []);\r\n\r\n  //MIDI devices init\r\n  useEffect(() => {\r\n    //INIT\r\n    let currentNotes = [];\r\n    const sampler = new Tone.Sampler({\r\n      urls: {\r\n        A0: 'A0.mp3',\r\n        C1: 'C1.mp3',\r\n        'D#1': 'Ds1.mp3',\r\n        'F#1': 'Fs1.mp3',\r\n        A1: 'A1.mp3',\r\n        C2: 'C2.mp3',\r\n        'D#2': 'Ds2.mp3',\r\n        'F#2': 'Fs2.mp3',\r\n        A2: 'A2.mp3',\r\n        C3: 'C3.mp3',\r\n        'D#3': 'Ds3.mp3',\r\n        'F#3': 'Fs3.mp3',\r\n        A3: 'A3.mp3',\r\n        C4: 'C4.mp3',\r\n        'D#4': 'Ds4.mp3',\r\n        'F#4': 'Fs4.mp3',\r\n        A4: 'A4.mp3',\r\n        C5: 'C5.mp3',\r\n        'D#5': 'Ds5.mp3',\r\n        'F#5': 'Fs5.mp3',\r\n        A5: 'A5.mp3',\r\n        C6: 'C6.mp3',\r\n        'D#6': 'Ds6.mp3',\r\n        'F#6': 'Fs6.mp3',\r\n        A6: 'A6.mp3',\r\n        C7: 'C7.mp3',\r\n        'D#7': 'Ds7.mp3',\r\n        'F#7': 'Fs7.mp3',\r\n        A7: 'A7.mp3',\r\n        C8: 'C8.mp3',\r\n      },\r\n      release: 1,\r\n      baseUrl: 'https://tonejs.github.io/audio/salamander/',\r\n    }).toDestination();\r\n    sampler.volume.value = -30;\r\n\r\n    if (navigator.requestMIDIAccess) {\r\n      navigator.requestMIDIAccess().then(success, failure);\r\n    }\r\n\r\n    function computeDftCoeffs(playedNotes) {\r\n      let pcv = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];\r\n\r\n      playedNotes.forEach((note) => {\r\n        let pitch;\r\n        if (note.includes('#')) {\r\n          pitch = note.slice(0, 2);\r\n        } else pitch = pitch = note.slice(0, 1);\r\n\r\n        switch (pitch) {\r\n          case 'C':\r\n            pcv[0] += 1;\r\n            break;\r\n          case 'C#':\r\n            pcv[1] += 1;\r\n            break;\r\n          case 'D':\r\n            pcv[2] += 1;\r\n            break;\r\n          case 'D#':\r\n            pcv[3] += 1;\r\n            break;\r\n          case 'E':\r\n            pcv[4] += 1;\r\n            break;\r\n          case 'F':\r\n            pcv[5] += 1;\r\n            break;\r\n          case 'F#':\r\n            pcv[6] += 1;\r\n            break;\r\n          case 'G':\r\n            pcv[7] += 1;\r\n            break;\r\n          case 'G#':\r\n            pcv[8] += 1;\r\n            break;\r\n          case 'A':\r\n            pcv[9] += 1;\r\n            break;\r\n          case 'A#':\r\n            pcv[10] += 1;\r\n            break;\r\n          case 'B':\r\n            pcv[11] += 1;\r\n            break;\r\n          default:\r\n            break;\r\n        }\r\n      });\r\n\r\n      let dftCoeffs = dft(pcv);\r\n      dftCoeffs = dftCoeffs.map((coeff) => {\r\n        return { x: coeff.re, y: coeff.im };\r\n      });\r\n      //console.log(dftCoeffs);\r\n      setMidiDevNotesDftCoeffs(dftCoeffs);\r\n    }\r\n\r\n    function handleInput(input) {\r\n      const command = input.data[0];\r\n      const note = Tone.Frequency(input.data[1], 'midi').toNote();\r\n      const velocity = Math.round(input.data[2] * 0.05);\r\n      //const velocity = input.data[2];\r\n\r\n      switch (command) {\r\n        case 144: //noteOn\r\n          if (velocity > 0) {\r\n            //Note is on\r\n            sampler.triggerAttack(note, Tone.immediate(), velocity);\r\n            currentNotes.push(note);\r\n          } else {\r\n            //Note is off\r\n            sampler.triggerRelease(note, Tone.immediate());\r\n            currentNotes.filter((currentNote) => currentNote !== note);\r\n          }\r\n          break;\r\n        case 128: //noteOff\r\n          sampler.triggerRelease(note, Tone.immediate());\r\n          currentNotes = currentNotes.filter(\r\n            (currentNote) => currentNote !== note\r\n          );\r\n          break;\r\n        default:\r\n          break;\r\n      }\r\n\r\n      computeDftCoeffs(currentNotes);\r\n    }\r\n\r\n    function success(midiAccess) {\r\n      midiAccess.onstatechange = updateDevices;\r\n\r\n      const inputs = midiAccess.inputs;\r\n\r\n      inputs.forEach((input) => {\r\n        input.onmidimessage = handleInput;\r\n      });\r\n    }\r\n\r\n    function failure() {\r\n      console.log('Could not connect MIDI');\r\n    }\r\n\r\n    function updateDevices(event) {\r\n      console.log(\r\n        `Name: ${event.port.name}, Brand: ${event.port.manufacturer}, State: ${event.port.state}, Type: ${event.port.type}`\r\n      );\r\n    }\r\n  }, []);\r\n\r\n  function toggleShowPrototypes() {\r\n    setShowPrototypes(!showPrototypes);\r\n  }\r\n\r\n  return (\r\n    <Box>\r\n      <Accordion defaultExpanded={true}>\r\n        <AccordionSummary\r\n          expandIcon={<ExpandMoreIcon />}\r\n          aria-controls='panel1a-content'\r\n          id='panel1a-header'\r\n        >\r\n          <Typography variant='h6'>Wavescape</Typography>\r\n        </AccordionSummary>\r\n        <AccordionDetails>\r\n          <WavescapeModule\r\n            wavescapesData={wavescapesData}\r\n            currentWavescapeSubdiv={currentWavescapeSubdiv}\r\n          />\r\n        </AccordionDetails>\r\n      </Accordion>\r\n      <Accordion defaultExpanded={true}>\r\n        <AccordionSummary\r\n          expandIcon={<ExpandMoreIcon />}\r\n          aria-controls='panel2a-content'\r\n          id='panel2a-header'\r\n        >\r\n          <Typography variant='h6'>Fourier Coefficients</Typography>\r\n        </AccordionSummary>\r\n        <AccordionDetails>\r\n          <CoefficientsModule\r\n            coeffTracesData={coeffTracesData}\r\n            currentSubdiv={currentSubdiv}\r\n            showPrototypes={showPrototypes}\r\n            userPcvs={userPcvs}\r\n            midiDevNotesDftCoeffs={midiDevNotesDftCoeffs}\r\n          />\r\n        </AccordionDetails>\r\n      </Accordion>\r\n\r\n      <AppBar\r\n        position='fixed'\r\n        open={open}\r\n        color='secondary'\r\n        sx={{ top: 'auto', bottom: 0 }}\r\n      >\r\n        <Toolbar>\r\n          <Player />\r\n          <Box\r\n            sx={{\r\n              display: 'flex',\r\n              alignItems: 'center',\r\n              margin: '2% 5%',\r\n              width: '30%',\r\n              justifyContent: 'space-evenly',\r\n            }}\r\n          >\r\n            <FormGroup>\r\n              <FormControlLabel\r\n                control={\r\n                  <Switch\r\n                    onChange={() => toggleShowPrototypes()}\r\n                    checked={showPrototypes}\r\n                    size='small'\r\n                  />\r\n                }\r\n                label='Show Prototypes'\r\n              />\r\n            </FormGroup>\r\n          </Box>\r\n        </Toolbar>\r\n      </AppBar>\r\n    </Box>\r\n  );\r\n}\r\n\r\nexport default Application;\r\n","import Navbar from './Navbar';\r\nimport { HashRouter, Route, Switch } from 'react-router-dom';\r\nimport CssBaseline from '@mui/material/CssBaseline';\r\nimport { useState, useEffect, useRef } from 'react';\r\n\r\nimport { setPlayerMidiData } from './Player';\r\nimport {\r\n  getComplementaryColours,\r\n  getRgbaMatrix,\r\n  getMidiFileDataObject,\r\n  getDftCoeffStatic,\r\n  getDftCoeffDynamic,\r\n} from './getDftMatrices';\r\nimport dft from './DFT';\r\nimport parse from './parser';\r\n\r\nimport ResolutionSelector from './ResolutionSelector';\r\nimport PcvChipsBox from './PcvChipsBox';\r\n\r\n//Pages\r\nimport Home from './pages/Home';\r\nimport Theory from './pages/Theory';\r\nimport Analysis from './pages/Analysis';\r\n\r\n//Test\r\nimport { styled, useTheme } from '@mui/material/styles';\r\nimport Box from '@mui/material/Box';\r\nimport Drawer from '@mui/material/Drawer';\r\nimport MuiAppBar from '@mui/material/AppBar';\r\nimport IconButton from '@mui/material/IconButton';\r\nimport ChevronLeftIcon from '@mui/icons-material/ChevronLeft';\r\nimport ChevronRightIcon from '@mui/icons-material/ChevronRight';\r\nimport TextField from '@mui/material/TextField';\r\n\r\nimport Typography from '@mui/material/Typography';\r\nimport Button from '@mui/material/Button';\r\nimport Divider from '@mui/material/Divider';\r\nimport FormLabel from '@mui/material/FormLabel';\r\n\r\nconst drawerWidth = 400;\r\n\r\n//Song variables\r\nlet currentSongBPM = 80;\r\nlet currentSongMidiData;\r\nlet fileName;\r\n\r\nconst Main = styled('main', { shouldForwardProp: (prop) => prop !== 'open' })(\r\n  ({ theme, open }) => ({\r\n    flexGrow: 1,\r\n    padding: theme.spacing(3),\r\n    transition: theme.transitions.create('margin', {\r\n      easing: theme.transitions.easing.sharp,\r\n      duration: theme.transitions.duration.leavingScreen,\r\n    }),\r\n    marginLeft: `-${drawerWidth}px`,\r\n    ...(open && {\r\n      transition: theme.transitions.create('margin', {\r\n        easing: theme.transitions.easing.easeOut,\r\n        duration: theme.transitions.duration.enteringScreen,\r\n      }),\r\n      marginLeft: 0,\r\n    }),\r\n  })\r\n);\r\n\r\nconst DrawerHeader = styled('div')(({ theme }) => ({\r\n  display: 'flex',\r\n  alignItems: 'center',\r\n  padding: theme.spacing(0, 1),\r\n  // necessary for content to be below app bar\r\n  ...theme.mixins.toolbar,\r\n  justifyContent: 'space-between',\r\n}));\r\n\r\nfunction App() {\r\n  const theme = useTheme();\r\n  const [open, setOpen] = useState(false);\r\n\r\n  const [file, setFile] = useState('');\r\n  //State: contains the color data of the wavescape of a given coeff (Array(6) one for coeff)\r\n  const [wavescapesData, setWavescapesData] = useState([]);\r\n\r\n  //State: represents the selected row on the wavescape (by default the first row) for each coeff\r\n  const [coeffTracesData, setCoeffTracesData] = useState([]);\r\n  const [currentSubdiv, setCurrentSubdiv] = useState(0);\r\n\r\n  //State: inputs\r\n  const [resolutionMode, setResolutionMode] = useState({\r\n    noteResolutionValue: 1,\r\n    seconds: 1.5,\r\n    useSeconds: false,\r\n  });\r\n  const [wavescapeResolution, setWavescapeResolution] = useState(10);\r\n  const [circleResolution, setCircleResolution] = useState(1);\r\n\r\n  const [userPcvs, setUserPcvs] = useState([]);\r\n  const pcvTextRef = useRef(null);\r\n\r\n  //State: error states in input\r\n  const [isInputPcvInvalid, setIsInputPcvInvalid] = useState(false);\r\n\r\n  function handleSubmitPitchClass(input) {\r\n    //In order not to refresh the page (default behaviuor)\r\n    let parsedInput;\r\n    let userPcvObjects = [];\r\n\r\n    try {\r\n      parsedInput = parse(input);\r\n    } catch (error) {\r\n      console.log(error.message);\r\n      setIsInputPcvInvalid(true);\r\n      return;\r\n    }\r\n\r\n    parsedInput.forEach((input) =>\r\n      userPcvObjects.push({\r\n        label: `(${input})`,\r\n        isDisabled: false,\r\n        coeffs: dft(input, true, true, false),\r\n      })\r\n    );\r\n\r\n    userPcvObjects.forEach((pcvData) => {\r\n      pcvData.colours = getComplementaryColours(pcvData.coeffs);\r\n    });\r\n\r\n    //Check if we are adding an input already inserted\r\n    let labels = userPcvs.map((pcvData) => pcvData.label);\r\n    labels.forEach((label) => {\r\n      userPcvObjects = userPcvObjects.filter(\r\n        (pcvObj) => pcvObj.label !== label\r\n      );\r\n    });\r\n\r\n    setUserPcvs([...userPcvs, ...userPcvObjects]);\r\n  }\r\n\r\n  //MIDI parsing on file change\r\n  useEffect(() => {\r\n    let input = document.getElementById('file').files[0];\r\n\r\n    input ? (fileName = input.name) : (fileName = '');\r\n\r\n    if (input) {\r\n      let fileReader = new FileReader();\r\n      fileReader.readAsArrayBuffer(input);\r\n      fileReader.onload = (loadedFile) => {\r\n        let { midiData, midiBpm } = getMidiFileDataObject(\r\n          loadedFile.target.result\r\n        );\r\n        currentSongBPM = midiBpm;\r\n        currentSongMidiData = midiData;\r\n\r\n        //Wavescapes static analysis\r\n        let subdivsNumberStatic = 50;\r\n        let staticResolution =\r\n          currentSongMidiData.duration / subdivsNumberStatic;\r\n        setWavescapeResolution(staticResolution);\r\n\r\n        setWavescapesData(\r\n          getRgbaMatrix(\r\n            getDftCoeffStatic(currentSongMidiData, staticResolution)\r\n          )\r\n        );\r\n\r\n        //Circles dynamic analysis\r\n        let { tracesData, resolution } = getDftCoeffDynamic(\r\n          midiData,\r\n          resolutionMode,\r\n          currentSongBPM\r\n        );\r\n        setCircleResolution(resolution);\r\n        setCoeffTracesData(tracesData);\r\n        setPlayerMidiData(\r\n          currentSongMidiData,\r\n          resolution,\r\n          staticResolution,\r\n          setCurrentSubdiv\r\n        );\r\n\r\n        console.log(midiData);\r\n      };\r\n    }\r\n  }, [file]);\r\n\r\n  //Init user pcv examples\r\n  useEffect(() => {\r\n    let examplePcvs = [\r\n      [1, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0], // C\r\n      [1, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0], // Cmin\r\n      [1, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0], // Cdim\r\n    ];\r\n\r\n    let exPcvObjects = examplePcvs.map((pcv) => {\r\n      return {\r\n        label: `(${pcv.toString()})`,\r\n        isDisabled: false,\r\n        coeffs: dft(pcv, true, true, false),\r\n      };\r\n    });\r\n\r\n    exPcvObjects.forEach((pcvData) => {\r\n      pcvData.colours = getComplementaryColours(pcvData.coeffs);\r\n    });\r\n\r\n    exPcvObjects[1].isDisabled = true;\r\n    exPcvObjects[2].isDisabled = true;\r\n    setUserPcvs(exPcvObjects);\r\n  }, []);\r\n\r\n  const handleDrawerClose = () => {\r\n    setOpen(false);\r\n  };\r\n\r\n  function retriggerAnalysis() {\r\n    //Only if there is midi data, retrigger analysis\r\n    if (currentSongMidiData == null) {\r\n      return;\r\n    }\r\n\r\n    //Circles dynamic analysis\r\n    let { tracesData, resolution } = getDftCoeffDynamic(\r\n      currentSongMidiData,\r\n      resolutionMode,\r\n      currentSongBPM\r\n    );\r\n    setCoeffTracesData(tracesData);\r\n    setPlayerMidiData(currentSongMidiData, resolution, setCurrentSubdiv);\r\n  }\r\n\r\n  return (\r\n    <>\r\n      <HashRouter basename={process.env.PUBLIC_URL}>\r\n        <CssBaseline />\r\n        <Navbar open={open} setOpen={setOpen} />\r\n        <Box sx={{ display: 'flex' }}>\r\n          <Drawer\r\n            sx={{\r\n              width: drawerWidth,\r\n              flexShrink: 0,\r\n              '& .MuiDrawer-paper': {\r\n                width: drawerWidth,\r\n                boxSizing: 'border-box',\r\n              },\r\n            }}\r\n            variant='persistent'\r\n            anchor='left'\r\n            open={open}\r\n          >\r\n            <DrawerHeader>\r\n              <Typography noWrap={true} sx={{ flexGrow: '2' }}>\r\n                {file ? fileName : 'Upload a midi file'}\r\n              </Typography>\r\n              <label htmlFor='file'>\r\n                <input\r\n                  style={{ display: 'none' }}\r\n                  type='file'\r\n                  id='file'\r\n                  name='file'\r\n                  value={file}\r\n                  onChange={(e) => setFile(e.target.value)}\r\n                />\r\n                <Button variant='contained' color='primary' component='span'>\r\n                  Upload\r\n                </Button>\r\n              </label>\r\n\r\n              <IconButton onClick={handleDrawerClose}>\r\n                {theme.direction === 'ltr' ? (\r\n                  <ChevronLeftIcon />\r\n                ) : (\r\n                  <ChevronRightIcon />\r\n                )}\r\n              </IconButton>\r\n            </DrawerHeader>\r\n            <Divider />\r\n            <Box\r\n              sx={{\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                margin: '2% 5%',\r\n                width: '90%',\r\n                justifyContent: 'space-evenly',\r\n              }}\r\n            >\r\n              <ResolutionSelector\r\n                setResolutionMode={setResolutionMode}\r\n                resolutionMode={resolutionMode}\r\n              />\r\n              <Button\r\n                variant='contained'\r\n                color='primary'\r\n                onClick={retriggerAnalysis}\r\n                sx={{ width: '10%' }}\r\n              >\r\n                Change\r\n              </Button>\r\n            </Box>\r\n            <Divider />\r\n            <Box\r\n              sx={{\r\n                flexDirection: 'column',\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                margin: '3% 5%',\r\n                height: '50%',\r\n                justifyContent: 'space-evenly',\r\n              }}\r\n              component='form'\r\n              noValidate\r\n              autoComplete='off'\r\n            >\r\n              <TextField\r\n                sx={{ minHeight: '5rem' }}\r\n                fullWidth\r\n                label={'margin=\"dense\"'}\r\n                error={isInputPcvInvalid}\r\n                helperText={isInputPcvInvalid && 'Invalid input'}\r\n                id='outlined-basic'\r\n                label='Pitch class vector'\r\n                variant='outlined'\r\n                onKeyPress={(event) => {\r\n                  if (event.key === 'Enter') {\r\n                    handleSubmitPitchClass(pcvTextRef.current.value);\r\n                    pcvTextRef.current.value = '';\r\n                  }\r\n                }}\r\n                onChange={() => {\r\n                  setIsInputPcvInvalid(false);\r\n                }}\r\n                inputRef={pcvTextRef}\r\n              />\r\n              <PcvChipsBox userPcvs={userPcvs} setUserPcvs={setUserPcvs} />\r\n            </Box>\r\n          </Drawer>\r\n          <Main open={open}>\r\n            <Switch>\r\n              <Route exact path='/' component={Home}></Route>\r\n              <Route exact path='/theory' component={Theory}></Route>\r\n              <Route\r\n                exact\r\n                path='/analysis'\r\n                render={() => (\r\n                  <Analysis\r\n                    open={open}\r\n                    setOpen={setOpen}\r\n                    wavescapesData={wavescapesData}\r\n                    coeffTracesData={coeffTracesData}\r\n                    currentSubdiv={currentSubdiv}\r\n                    currentWavescapeSubdiv={Math.floor(\r\n                      (currentSubdiv * circleResolution) / wavescapeResolution\r\n                    )}\r\n                    userPcvs={userPcvs}\r\n                  />\r\n                )}\r\n              ></Route>\r\n            </Switch>\r\n          </Main>\r\n        </Box>\r\n      </HashRouter>\r\n    </>\r\n  );\r\n}\r\n\r\nexport default App;\r\n","export default function parse(input) {\r\n  let pcvs = [];\r\n  //Vectorial notation, distribution -> real numbers\r\n  const openVect = '(';\r\n  const closeVect = ')';\r\n  //Set notation, integers\r\n  const openSet = '{';\r\n  const closeSet = '}';\r\n  //Number divider\r\n  const divider = ',';\r\n\r\n  let isGroup = false;\r\n  let isSet = false;\r\n\r\n  for (let i = 0; i < input.length; i++) {\r\n    if (input[i] === openSet || input[i] === openVect) {\r\n      isGroup = true;\r\n      if (input[i] === openSet) isSet = true;\r\n    }\r\n\r\n    if (isGroup) {\r\n      let stringGroup = [];\r\n      //Slice the current group\r\n      for (\r\n        let j = i + 1;\r\n        input[j] !== closeSet && input[j] !== closeVect;\r\n        j++\r\n      ) {\r\n        //Check if there is an invalid char in the group\r\n        if (input[j] !== ',' && input[j] !== '.' && isNaN(parseFloat(input[j])))\r\n          throw new Error('Found NaN');\r\n        stringGroup.push(input[j]);\r\n      }\r\n\r\n      stringGroup = stringGroup.join('');\r\n\r\n      //Check if the empty string\r\n      if (stringGroup === '') throw new Error('Empty input');\r\n\r\n      let numeralInput = [];\r\n      let count = 0;\r\n      for (let j = 0; j < stringGroup.length; j++) {\r\n        if (stringGroup[j] === divider) {\r\n          let num = stringGroup.slice(j - count, j);\r\n          //if num.length === 0 => two consecutive comas, invalid input\r\n          if (num.length === 0) throw new Error('Two consecutive comas');\r\n\r\n          numeralInput.push(+num);\r\n          count = -1;\r\n        }\r\n        count++;\r\n      }\r\n      //Last element not cover by the for cycle\r\n      let lastNum = stringGroup.slice(\r\n        stringGroup.length - count,\r\n        stringGroup.length\r\n      );\r\n      //Check if there is a last number\r\n      if (lastNum.length === 0) {\r\n        throw new Error('Missing last number');\r\n      }\r\n      numeralInput.push(+lastNum);\r\n\r\n      if (isSet) {\r\n        let bin = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];\r\n        for (let i = 0; i < numeralInput.length; i++) {\r\n          //Set notation: check if num is valid range [0,11]\r\n          if (numeralInput[i] < 0 || numeralInput[i] >= 12) {\r\n            throw new Error('Set notation: out of range');\r\n          }\r\n\r\n          bin[numeralInput[i]] += 1;\r\n        }\r\n        pcvs.push(bin);\r\n      } else {\r\n        //If is in vectorial form, check if there are 12 elements\r\n        if (numeralInput.length !== 12) {\r\n          throw new Error('Vectorial notation: missing elements');\r\n        }\r\n        pcvs.push(numeralInput);\r\n      }\r\n\r\n      isGroup = false;\r\n      isSet = false;\r\n      i += count;\r\n    }\r\n  }\r\n\r\n  if (pcvs.length === 0) throw new Error('Invalid input');\r\n\r\n  return pcvs;\r\n}\r\n","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport App from './App';\r\nimport { createTheme, ThemeProvider } from '@mui/material/styles';\r\n\r\nconst customTheme = createTheme({\r\n  palette: {\r\n    primary: {\r\n      main: '#323232',\r\n    },\r\n    secondary: {\r\n      main: '#fefefe',\r\n    },\r\n  },\r\n});\r\n\r\nReactDOM.render(\r\n  <React.StrictMode>\r\n    <ThemeProvider theme={customTheme}>\r\n      <App />\r\n    </ThemeProvider>\r\n  </React.StrictMode>,\r\n  document.getElementById('root')\r\n);\r\n"],"sourceRoot":""}