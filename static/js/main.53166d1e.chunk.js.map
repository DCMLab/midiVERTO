{"version":3,"sources":["Player.js","DFT.js","colorMapping.js","getDftMatrices.js","roses.js","Navbar.js","svgNotation/whole.svg","svgNotation/half.svg","svgNotation/quarter.svg","svgNotation/eighth.svg","svgNotation/sixteenth.svg","ResolutionSelector.js","PcvChipsBox.js","CircleSVG.js","WavescapeSVG.js","prototypesData.js","SaveDialog.js","logos/placeholder.png","Footer.js","Markdown.js","HomeMarkdown.md","pages/Home.js","TheoryMarkdown.md","pages/Theory.js","Wavescape.js","WavescapeModule.js","Circle.js","CoefficientsModule.js","pages/Analysis.js","App.js","parser.js","index.js"],"names":["part","intervalID","currentSongDuration","TinyText","styled","Typography","fontSize","opacity","fontWeight","letterSpacing","formatDuration","value","minute","Math","floor","secondLeft","setPlayerMidiData","midiData","resolution","setCurrentSubdiv","Tone","cancel","stop","duration","partNotes","tracks","forEach","track","notes","note","push","subdiv","time","sampler","triggerAttackRelease","name","velocity","start","loop","loopEnd","urls","A0","C1","A1","C2","A2","C3","A3","C4","A4","C5","A5","C6","A6","C7","A7","C8","release","baseUrl","toDestination","Player","fileName","useState","playbackSliderProgress","setPlaybackSliderProgress","play","state","console","log","resume","setInterval","progress","useEffect","document","addEventListener","e","which","preventDefault","pause","stopInterval","bind","Box","sx","display","flexDirection","alignItems","width","justifyContent","Stack","direction","flexGrow","paddingLeft","IconButton","disableFocusRipple","padding","onClick","size","children","color","noWrap","paddingRight","Slider","onChange","event","newValue","seconds","mt","clearInterval","volume","dft","pcv","normalize","round","polar","N","length","coeffs","k","temp","n","math","slice","norm","map","coeff","re","im","toPolar","sumAndNormalize","sum","i","j","contToDiscRGB","d3","domain","range","gradient","angle","r","g","b","pixelColor","x","y","distance","atan2","PI","a","getRgbaFromComplex","complex","polarComplex","phi","mod","ris","Pcv","this","C","Cs","D","Ds","E","F","Fs","G","Gs","A","As","B","targetPitch","getDftCoeffDynamic","resolutionMode","currentSongBPM","noteResolutionValue","useSeconds","isNaN","tracksSubdivision","getSubdivision","pcvSubdivision","pitch","addNoteDuration","dftCoeffsSubdivision","getPcvAsArray","traces","tracesData","subdivision","wndLen","cursor","isValidNote","noteAndDuration","getRosePoints","d","dataPoints","delta","cos","sin","AppBar","MuiAppBar","shouldForwardProp","prop","theme","open","transition","transitions","create","easing","sharp","leavingScreen","marginLeft","easeOut","enteringScreen","Navbar","setOpen","inAnalysisPage","position","Toolbar","disabled","edge","mr","variant","component","ButtonGroup","Button","Link","to","disableElevation","ResolutionSelector","setResolutionMode","retriggerAnalysis","isInputSecondsInvalid","setIsInputSecondsInvalid","resolutionTextRef","useRef","FormControl","RadioGroup","row","defaultValue","newResolutionMode","parseFloat","current","target","FormControlLabel","control","Radio","label","style","height","transform","src","sixteenthSvg","eighthSvg","marginTop","quarterSvg","halfSvg","wholeSvg","TextField","minHeight","maxWidth","error","helperText","id","inputRef","ListItem","margin","spacing","PcvChipsBox","userPcvs","setUserPcvs","rosesMat","Paper","flexWrap","listStyle","p","overflow","data","Chip","isDisabled","icon","xmlns","viewBox","fill","stroke","strokeWidth","points","rosePoints","onDelete","chipToDelete","used","chips","filter","chip","traceData","userPcv","prototypesData","coeffNumber","showNumber","circleRadius","innerWidth","theta","angles","circularSectors","cx","cy","textAnchor","innerRadius","index","inner","offset","outerRadius","startAngle","endAngle","fillOpacity","strokeOpacity","arc","pcvData","radiusScaleWidth","mark","circleMark","translateX","translateY","scale","svgRoseIcon","scaleRatio","labelName","subSup","isSub","includes","dxOffset","sign","dyOffset","dx","dy","baselineShift","protoCircleMark","verticalScale","WavescapeSVG","baseSubdivision","wsCoordinates","wsNumber","wavescapeMatrix","margins","innerSize","innerHeight","unit","mat","computeTicks","x1","x2","y1","y2","elem","SaveDialog","wavescapesData","checkNumb","setCheckNumb","checkTrace","setCheckTrace","checkProto","setCheckProto","checkPcvs","setCheckPcvs","subdivUserPcvs","setSubdivUserPcvs","handleClose","canSave","setCanSave","anchorEl","setAnchorEl","openPopover","Boolean","undefined","tempSubdivUserPcvs","saveImages","zip","JSZip","circleSVG","CircleSVG","ReactDOMServer","renderToStaticMarkup","generateCircleSVG","wavescapeSVG","generateWavescapeSVG","file","generateAsync","type","then","content","saveAs","marginBottom","Dialog","onClose","DialogTitle","DialogContent","DialogContentText","FormGroup","Checkbox","checked","DialogActions","currentTarget","autoFocus","Popover","anchorOrigin","vertical","horizontal","Footer","logoSize","textAlign","logo","marginRight","href","options","overrides","h1","props","gutterBottom","h2","h3","h4","paragraph","myRef","React","parseInt","ref","scrollIntoView","behavior","li","typography","Markdown","Home","setInAnalysisPage","setContent","fetch","HomeMarkdown","response","text","Theory","TheoryMarkdown","block","Wavescape","ticks","currentWavescapeSubdiv","wavescapeWidth","canvasRef","setWsCoordinates","ticksHeight","setTicksHeight","canvas","ctx","getContext","clearRect","beginPath","moveTo","lineTo","fillStyle","drawWavescape","coord","WavescapeModule","elemsWidth","savedImage","Circle","protoDataCoeff","fullTrace","traceDataCoeff","userPcvsCoeff","currentSubdiv","performanceCoeff","targetCircleWidth","showMagAndPhase","showFullTrace","mu","currentSubdivCoeff","setCurrentSubdivCoeff","marksRadiusRatio","cartesianToPolar","sqrt","Number","EPSILON","drawTrace","element","radius","devicePixelRatio","image","createImageData","rgba","putImageData","save","translate","restore","getImageData","zIndex","polarCoord","widthSvg","Tooltip","placement","arrow","title","highlight","opacityArray","reverse","highlightSubdiv","CoefficientsModule","fullTraces","coeffTracesData","showPrototypes","midiDevNotesDftCoeffs","selectedProtoPitchClasses","setSelectedProtoPitchClasses","coeffNum","Analysis","currentSongMidiData","setShowPrototypes","setShowMagAndPhase","setShowFullTrace","setMidiDevNotesDftCoeffs","accordionRef","accordionWidth","setAccordionWidth","elemsForEachRow","setElemsForEachRow","setElemsWidth","changeElementsSize","drawerOffset","adjustmentFractSizes","clientWidth","handleResize","window","currentNotes","handleInput","input","command","toNote","triggerAttack","triggerRelease","currentNote","playedNotes","dftCoeffs","computeDftCoeffs","updateDevices","port","manufacturer","navigator","requestMIDIAccess","midiAccess","onstatechange","inputs","onmidimessage","Accordion","defaultExpanded","AccordionSummary","expandIcon","AccordionDetails","top","bottom","maxHeight","minWidth","fullWidth","InputLabel","Select","MenuItem","Switch","min","max","valueLabelDisplay","marks","Main","backgroundColor","DrawerHeader","mixins","toolbar","App","useTheme","setFile","setWavescapesData","setCoeffTracesData","windowedCoeffTraces","setWindowedCoeffTraces","windowLen","setWindowLen","wavescapeResolution","setWavescapeResolution","circleResolution","setCircleResolution","invalidWndLen","setInvalidWndLen","textfieldWndLen","setTextfieldWndLen","pcvTextRef","isInputPcvInvalid","setIsInputPcvInvalid","setRosesMat","handleSubmitPitchClass","parsedInput","userPcvObjects","pcvs","isGroup","isSet","stringGroup","Error","join","numeralInput","count","num","lastNum","bin","parse","message","pcvObj","found","usable","trace","windowedTrace","smoothedPoint","getElementById","files","fileReader","FileReader","readAsArrayBuffer","onload","loadedFile","binMidiFile","Midi","tempos","header","tempo","bpm","midiBpm","nonPercussiveTracks","instrument","percussion","getMidiFileDataObject","result","staticResolution","dftCoeffsMatrix","rgbaMatrices","getRgbaMatrix","midiFile","matrixHeight","baseLength","wndLenUnits","windowed","getDftCoeffStatic","initMatrix","rose","exPcvObjects","toString","CssBaseline","Drawer","flexShrink","boxSizing","anchor","htmlFor","Divider","paddingTop","inputProps","heigth","noValidate","autoComplete","key","exact","path","render","customTheme","createTheme","palette","primary","main","secondary","background","default","ReactDOM","StrictMode","ThemeProvider"],"mappings":"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","file":"static/js/main.53166d1e.chunk.js","sourcesContent":["//React\r\nimport { useEffect, useState } from 'react';\r\n\r\n//Import libraries\r\nimport * as Tone from 'tone';\r\n\r\n//Import material UI components\r\nimport Box from '@mui/material/Box';\r\nimport Stack from '@mui/material/Stack';\r\nimport PlayArrowRoundedIcon from '@mui/icons-material/PlayArrowRounded';\r\nimport PauseRoundedIcon from '@mui/icons-material/PauseRounded';\r\nimport StopRoundedIcon from '@mui/icons-material/StopRounded';\r\nimport IconButton from '@mui/material/IconButton';\r\nimport Slider from '@mui/material/Slider';\r\nimport { styled } from '@mui/material/styles';\r\nimport Typography from '@mui/material/Typography';\r\n\r\n//Song's variables\r\nlet part;\r\nlet currentSongDuration = 0; // seconds\r\nlet intervalID;\r\n\r\n//Custom style for player's time information\r\nconst TinyText = styled(Typography)({\r\n  fontSize: '0.75rem',\r\n  opacity: 0.38,\r\n  fontWeight: 500,\r\n  letterSpacing: 0.2,\r\n});\r\n\r\n//Format of time information\r\nfunction formatDuration(value) {\r\n  const minute = Math.floor(value / 60);\r\n  const secondLeft = Math.floor(value - minute * 60);\r\n  return `${minute}:${secondLeft < 9 ? `0${secondLeft}` : secondLeft}`;\r\n}\r\n\r\nexport function setPlayerMidiData(midiData, resolution, setCurrentSubdiv) {\r\n  //Remove the scheduled previous song\r\n  Tone.Transport.cancel(0);\r\n  setCurrentSubdiv(0);\r\n  Tone.Transport.stop();\r\n\r\n  //Update\r\n  currentSongDuration = midiData.duration;\r\n\r\n  //partNotes represents all the events (notes) that will be scheduled\r\n  //in the Tone.part\r\n  let partNotes = [];\r\n  midiData.tracks.forEach((track) =>\r\n    track.notes.forEach((note) => {\r\n      partNotes.push(note);\r\n    })\r\n  );\r\n\r\n  //Assing each note to its subdivision\r\n  partNotes.forEach((note) => {\r\n    note.subdiv = Math.floor(note.time / resolution);\r\n  });\r\n\r\n  //Part init --> when a note is palyed, update the current suvdivision index\r\n  part = new Tone.Part(\r\n    (time, note) => {\r\n      sampler.triggerAttackRelease(\r\n        note.name,\r\n        note.duration,\r\n        time,\r\n        note.velocity\r\n      );\r\n      setCurrentSubdiv(note.subdiv);\r\n    },\r\n    [...partNotes]\r\n  ).start(0);\r\n\r\n  //Loop set to true in order to use progress attribute\r\n  part.loop = true;\r\n  part.loopEnd = currentSongDuration;\r\n}\r\n\r\n//Sampler setup --> Piano\r\nconst sampler = new Tone.Sampler({\r\n  urls: {\r\n    A0: 'A0.mp3',\r\n    C1: 'C1.mp3',\r\n    'D#1': 'Ds1.mp3',\r\n    'F#1': 'Fs1.mp3',\r\n    A1: 'A1.mp3',\r\n    C2: 'C2.mp3',\r\n    'D#2': 'Ds2.mp3',\r\n    'F#2': 'Fs2.mp3',\r\n    A2: 'A2.mp3',\r\n    C3: 'C3.mp3',\r\n    'D#3': 'Ds3.mp3',\r\n    'F#3': 'Fs3.mp3',\r\n    A3: 'A3.mp3',\r\n    C4: 'C4.mp3',\r\n    'D#4': 'Ds4.mp3',\r\n    'F#4': 'Fs4.mp3',\r\n    A4: 'A4.mp3',\r\n    C5: 'C5.mp3',\r\n    'D#5': 'Ds5.mp3',\r\n    'F#5': 'Fs5.mp3',\r\n    A5: 'A5.mp3',\r\n    C6: 'C6.mp3',\r\n    'D#6': 'Ds6.mp3',\r\n    'F#6': 'Fs6.mp3',\r\n    A6: 'A6.mp3',\r\n    C7: 'C7.mp3',\r\n    'D#7': 'Ds7.mp3',\r\n    'F#7': 'Fs7.mp3',\r\n    A7: 'A7.mp3',\r\n    C8: 'C8.mp3',\r\n  },\r\n  release: 1,\r\n  baseUrl: 'https://tonejs.github.io/audio/salamander/',\r\n}).toDestination();\r\nsampler.volume.value = -20; //Sampler volume\r\n\r\n//Player component\r\nexport default function Player({ fileName }) {\r\n  //State: number\r\n  //Represent the progress of the playback in the slider, 0 is the beginnign\r\n  //while 1 is the end.\r\n  const [playbackSliderProgress, setPlaybackSliderProgress] = useState(0);\r\n\r\n  /**\r\n   * Start playback\r\n   */\r\n  function play() {\r\n    if (Tone.context.state !== 'running') {\r\n      console.log('state running');\r\n      Tone.context.resume();\r\n    }\r\n    Tone.Transport.start();\r\n\r\n    //Init interval --> every 1 second, update the slider\r\n    if (!intervalID && part)\r\n      intervalID = setInterval(\r\n        () => setPlaybackSliderProgress(part.progress),\r\n        1000\r\n      );\r\n  }\r\n\r\n  //Key binding for spacebar stop/play functions\r\n  useEffect(() => {\r\n    function handleKeyDown(e) {\r\n      if (e.which === 32) {\r\n        e.preventDefault();\r\n        //If part is not playing\r\n        if (\r\n          Tone.Transport.state === 'paused' ||\r\n          Tone.Transport.state === 'stopped'\r\n        )\r\n          play();\r\n        //If part is playing\r\n        else if (Tone.Transport.state === 'started') {\r\n          Tone.Transport.pause();\r\n          //Stop updating the slider\r\n          stopInterval();\r\n        }\r\n      }\r\n    }\r\n\r\n    document.addEventListener('keydown', handleKeyDown.bind(this));\r\n  }, []);\r\n\r\n  return (\r\n    <Box\r\n      sx={{\r\n        display: 'flex',\r\n        flexDirection: 'column',\r\n        alignItems: 'center',\r\n        width: '60%',\r\n      }}\r\n    >\r\n      {/* ICONS AND FILE NAME*/}\r\n      <Box\r\n        sx={{\r\n          display: 'flex',\r\n          alignItems: 'center',\r\n          justifyContent: 'space-between',\r\n          width: '100%',\r\n        }}\r\n      >\r\n        <Stack direction='row' sx={{ flexGrow: 1, paddingLeft: '10%' }}>\r\n          <IconButton\r\n            disableFocusRipple\r\n            sx={{ padding: '0' }}\r\n            onClick={() => {\r\n              console.log('stop');\r\n              Tone.Transport.stop();\r\n              stopInterval();\r\n            }}\r\n            size='large'\r\n            children={<StopRoundedIcon fontSize='large' />}\r\n          />\r\n          <IconButton\r\n            disableFocusRipple\r\n            sx={{ padding: '0' }}\r\n            onClick={() => {\r\n              console.log('pause');\r\n              Tone.Transport.pause();\r\n              stopInterval();\r\n            }}\r\n            size='large'\r\n            children={<PauseRoundedIcon fontSize='large' />}\r\n          />\r\n          <IconButton\r\n            disableFocusRipple\r\n            sx={{ padding: '0' }}\r\n            onClick={() => play()}\r\n            size='large'\r\n            children={<PlayArrowRoundedIcon fontSize='large' />}\r\n          />\r\n        </Stack>\r\n        <Typography\r\n          color={fileName ? 'primary' : 'error'}\r\n          noWrap={true}\r\n          sx={{ flexGrow: '2', paddingRight: '10%' }}\r\n        >\r\n          {fileName ? fileName : 'No midi file uploaded'}\r\n        </Typography>\r\n      </Box>\r\n\r\n      {/* SLIDER */}\r\n      <Slider\r\n        aria-label='Playback'\r\n        size='small'\r\n        value={playbackSliderProgress ? playbackSliderProgress * 100 : 0}\r\n        onChange={(event, newValue) => {\r\n          setPlaybackSliderProgress(newValue / 100);\r\n          Tone.Transport.seconds = (newValue / 100) * currentSongDuration;\r\n        }}\r\n        sx={{ width: '90%' }}\r\n      />\r\n\r\n      {/* TIME INFORMATION */}\r\n      <Box\r\n        sx={{\r\n          display: 'flex',\r\n          width: '90%',\r\n          alignItems: 'center',\r\n          justifyContent: 'space-between',\r\n          mt: -1,\r\n        }}\r\n      >\r\n        <TinyText>\r\n          -\r\n          {formatDuration(\r\n            currentSongDuration - playbackSliderProgress * currentSongDuration\r\n          )}\r\n        </TinyText>\r\n        <TinyText>{formatDuration(currentSongDuration)}</TinyText>\r\n      </Box>\r\n    </Box>\r\n  );\r\n}\r\n\r\n/**\r\n * Stop updating the slider by clearing the interval ID\r\n */\r\nfunction stopInterval() {\r\n  clearInterval(intervalID);\r\n  // release our intervalID from the variable\r\n  intervalID = null;\r\n}\r\n","//Import libraries\r\nimport * as math from 'mathjs';\r\n\r\n/**\r\n * Compute the DFT of a PCV\r\n * @param {array} pcv pitch-class vector\r\n * @param {boolean} normalize true for normalizing the output value\r\n * @param {boolean} round true for rounding the output value\r\n * @param {boolean} polar true for changing coordinates to the output value\r\n * @returns {array}\r\n */\r\nexport default function dft(\r\n  pcv,\r\n  normalize = true,\r\n  round = false,\r\n  polar = false\r\n) {\r\n  let N = pcv.length;\r\n\r\n  let coeffs = [];\r\n\r\n  for (let k = 0; k < N / 2 + 1; k++) {\r\n    let temp = 0;\r\n    for (let n = 0; n < N; n++) {\r\n      temp = math.add(\r\n        math.multiply(\r\n          pcv[n],\r\n          math.exp(math.multiply(math.i, (-2 * math.pi * k * n) / N))\r\n        ),\r\n        temp\r\n      );\r\n    }\r\n    coeffs.push(temp);\r\n  }\r\n\r\n  coeffs = coeffs.slice();\r\n\r\n  if (normalize) {\r\n    const norm = coeffs[0];\r\n    //'!=' gives a warning but '!==' doesn't compute correctly the if statement\r\n    if (norm != 0) coeffs = coeffs.map((coeff) => math.divide(coeff, norm));\r\n  }\r\n\r\n  if (round) {\r\n    coeffs.forEach((coeff) => {\r\n      coeff.re = Math.round(coeff.re * 10000) / 10000;\r\n      coeff.im = Math.round(coeff.im * 10000) / 10000;\r\n    });\r\n  }\r\n\r\n  if (polar) {\r\n    coeffs = coeffs.map((coeff) => coeff.toPolar());\r\n  }\r\n\r\n  return coeffs;\r\n}\r\n\r\n/**\r\n * Sum the coefficients and normalize the result, used to compute the\r\n * rows of the wavescape by expoliting the linearity of the DFT\r\n * @param {array} coeffs Array of coefficients\r\n * @returns\r\n */\r\nexport function sumAndNormalize(coeffs) {\r\n  //Sum init\r\n  let sum = coeffs[0];\r\n\r\n  for (let i = 1; i < coeffs.length; i++) {\r\n    let temp = [];\r\n\r\n    //incremental sum for each coeff\r\n    for (let j = 0; j < coeffs[i].length; j++) {\r\n      temp.push(math.add(sum[j], coeffs[i][j]));\r\n    }\r\n    //Clone array\r\n    sum = temp.slice();\r\n  }\r\n\r\n  //Normalize\r\n  const norm = sum[0];\r\n  if (norm != 0) sum = sum.map((coeff) => math.divide(coeff, norm));\r\n\r\n  return sum;\r\n}\r\n","import * as d3 from 'd3';\r\nimport * as math from 'mathjs';\r\n\r\n//Convert rgb values from [0,1] to [0,255]\r\nconst contToDiscRGB = d3\r\n  .scaleQuantize()\r\n  .domain([0, 1])\r\n  .range(d3.range(0, 255, 1));\r\n\r\n/**\r\n * Map phase of a complex number with the correspondent Fourier space color\r\n * @param {number} angle Phase in radiants\r\n * @returns string\r\n */\r\nexport const gradient = (angle) => {\r\n  let r, g, b;\r\n\r\n  if (angle >= 0 && angle < math.pi / 3) {\r\n    r = 1;\r\n    g = (3 * angle) / math.pi;\r\n    b = 0;\r\n  } else if (angle >= math.pi / 3 && angle < (math.pi * 2) / 3) {\r\n    r = 2 - (3 * angle) / math.pi;\r\n    g = 1;\r\n    b = 0;\r\n  } else if (angle >= (math.pi * 2) / 3 && angle < math.pi) {\r\n    r = 0;\r\n    g = 1;\r\n    b = (3 * angle) / math.pi - 2;\r\n  } else if (angle >= math.pi && angle < (math.pi * 4) / 3) {\r\n    r = 0;\r\n    g = 4 - (3 * angle) / math.pi;\r\n    b = 1;\r\n  } else if (angle >= (math.pi * 4) / 3 && angle < (math.pi * 5) / 3) {\r\n    r = (3 * angle) / math.pi - 4;\r\n    g = 0;\r\n    b = 1;\r\n  } else if (angle >= (math.pi * 5) / 3 && angle < 2 * math.pi) {\r\n    r = 1;\r\n    g = 0;\r\n    b = 6 - (3 * angle) / math.pi;\r\n  }\r\n\r\n  r = contToDiscRGB(r);\r\n  g = contToDiscRGB(g);\r\n  b = contToDiscRGB(b);\r\n\r\n  return `rgb(${r}, ${g}, ${b})`;\r\n};\r\n\r\n/**\r\n * Used to generate the color wheel canvas, map a point of the Fourier space\r\n * to an RGBA value\r\n * @param {number} x x-coordinate\r\n * @param {number} y y-coordinate\r\n * @param {number} distance distance of the point from the origin\r\n * @returns object\r\n */\r\nexport const pixelColor = (x, y, distance) => {\r\n  let r, g, b, a;\r\n  //atan2 out in [-pi, pi]\r\n  let angle = Math.atan2(y, x);\r\n  angle = -angle;\r\n  //we need it in [0, 2pi]\r\n  if (angle < 0) angle += 2 * Math.PI;\r\n\r\n  if (angle >= 0 && angle < math.pi / 3) {\r\n    r = 1;\r\n    g = (3 * angle) / math.pi;\r\n    b = 0;\r\n  } else if (angle >= math.pi / 3 && angle < (math.pi * 2) / 3) {\r\n    r = 2 - (3 * angle) / math.pi;\r\n    g = 1;\r\n    b = 0;\r\n  } else if (angle >= (math.pi * 2) / 3 && angle < math.pi) {\r\n    r = 0;\r\n    g = 1;\r\n    b = (3 * angle) / math.pi - 2;\r\n  } else if (angle >= math.pi && angle < (math.pi * 4) / 3) {\r\n    r = 0;\r\n    g = 4 - (3 * angle) / math.pi;\r\n    b = 1;\r\n  } else if (angle >= (math.pi * 4) / 3 && angle < (math.pi * 5) / 3) {\r\n    r = (3 * angle) / math.pi - 4;\r\n    g = 0;\r\n    b = 1;\r\n  } else if (angle >= (math.pi * 5) / 3 && angle < 2 * math.pi) {\r\n    r = 1;\r\n    g = 0;\r\n    b = 6 - (3 * angle) / math.pi;\r\n  }\r\n\r\n  r = contToDiscRGB(r);\r\n  g = contToDiscRGB(g);\r\n  b = contToDiscRGB(b);\r\n  a = contToDiscRGB(distance);\r\n\r\n  return { r, g, b, a };\r\n};\r\n\r\n/**\r\n * Convert the complex number in polar coordinates and map it to a\r\n * RGBA value string\r\n * @param {object} complex complex number\r\n * @returns string\r\n */\r\nexport function getRgbaFromComplex(complex) {\r\n  let polarComplex = complex.toPolar();\r\n  let angle = polarComplex.phi; // phi from [-pi, pi], but color mapping defined in [0,2pi]\r\n  let mod = polarComplex.r;\r\n\r\n  //Taking into account rounding errors\r\n  if (angle < 0 && angle > -1e-5) angle = 0;\r\n\r\n  if (angle < 0)\r\n    //negative angle mapped to their positive representation\r\n    angle = angle + 2 * Math.PI;\r\n\r\n  let ris = gradient(angle).slice(3, -1);\r\n\r\n  return `rgba${ris}, ${mod})`;\r\n}\r\n","//Import functions\r\nimport { Midi } from '@tonejs/midi';\r\nimport dft, { sumAndNormalize } from './DFT';\r\nimport { getRgbaFromComplex } from './colorMapping';\r\n\r\n//Pitch-class vector class\r\nclass Pcv {\r\n  //\"s\" is sharp\r\n  constructor() {\r\n    this.C = 0;\r\n    this.Cs = 0;\r\n    this.D = 0;\r\n    this.Ds = 0;\r\n    this.E = 0;\r\n    this.F = 0;\r\n    this.Fs = 0;\r\n    this.G = 0;\r\n    this.Gs = 0;\r\n    this.A = 0;\r\n    this.As = 0;\r\n    this.B = 0;\r\n  }\r\n\r\n  /**\r\n   * Add duration in seconds to the specified pitch attribute.\r\n   * @param {string} targetPitch pitch to which add the duration\r\n   * @param {number} duration seconds\r\n   */\r\n  addNoteDuration(targetPitch, duration) {\r\n    switch (targetPitch) {\r\n      case 'C':\r\n        this.C += duration;\r\n        break;\r\n      case 'C#':\r\n        this.Cs += duration;\r\n        break;\r\n      case 'D':\r\n        this.D += duration;\r\n        break;\r\n      case 'D#':\r\n        this.Ds += duration;\r\n        break;\r\n      case 'E':\r\n        this.E += duration;\r\n        break;\r\n      case 'F':\r\n        this.F += duration;\r\n        break;\r\n      case 'F#':\r\n        this.Fs += duration;\r\n        break;\r\n      case 'G':\r\n        this.G += duration;\r\n        break;\r\n      case 'G#':\r\n        this.Gs += duration;\r\n        break;\r\n      case 'A':\r\n        this.A += duration;\r\n        break;\r\n      case 'A#':\r\n        this.As += duration;\r\n        break;\r\n      case 'B':\r\n        this.B += duration;\r\n        break;\r\n      default:\r\n        break;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Return the object's attributes as an array\r\n   * @returns array\r\n   */\r\n  getPcvAsArray() {\r\n    let temp = [\r\n      this.C,\r\n      this.Cs,\r\n      this.D,\r\n      this.Ds,\r\n      this.E,\r\n      this.F,\r\n      this.Fs,\r\n      this.G,\r\n      this.Gs,\r\n      this.A,\r\n      this.As,\r\n      this.B,\r\n    ];\r\n\r\n    return temp;\r\n  }\r\n\r\n  /**\r\n   * Class addition\r\n   * @param {object} pcv\r\n   */\r\n  add(pcv) {\r\n    this.C = pcv.C;\r\n    this.Cs = pcv.Cs;\r\n    this.D = pcv.D;\r\n    this.Ds = pcv.Ds;\r\n    this.E = pcv.E;\r\n    this.F = pcv.F;\r\n    this.Fs = pcv.Fs;\r\n    this.G = pcv.G;\r\n    this.Gs = pcv.Gs;\r\n    this.A = pcv.A;\r\n    this.As = pcv.As;\r\n    this.B = pcv.B;\r\n  }\r\n}\r\n\r\n/**\r\n * Read the MIDI file, remove percussive tracks and return it as an object\r\n * @param {binary} binMidiFile MIDI file in binary code\r\n * @returns object\r\n */\r\nexport function getMidiFileDataObject(binMidiFile) {\r\n  //Read file\r\n  let midiData = new Midi(binMidiFile);\r\n\r\n  //We assume that song's tempo is the fastest one\r\n  //(since many picies slow down in some parts)\r\n  let tempos = midiData.header.tempos.map((tempo) => Math.round(tempo.bpm));\r\n  let midiBpm = Math.max(...tempos); //BPM used for quarter-note conversion\r\n\r\n  //Check and delete percussive tracks\r\n  let nonPercussiveTracks = midiData.tracks.filter(\r\n    (track) => track.instrument.percussion === false\r\n  );\r\n\r\n  midiData.tracks = nonPercussiveTracks;\r\n\r\n  return { midiData, midiBpm };\r\n}\r\n\r\n/**\r\n * Compute the first row of the wavescapes (from 0th to 6th).\r\n * @param {object} midiFile\r\n * @param {number} resolution in seconds\r\n * @returns array\r\n */\r\nexport function getDftCoeffStatic(midiFile, resolution) {\r\n  let tracksSubdivision = [];\r\n\r\n  //Subdivide the tracks by the resolution\r\n  midiFile.tracks.forEach((track) =>\r\n    tracksSubdivision.push(\r\n      getSubdivision(track.notes, resolution, midiFile.duration)\r\n    )\r\n  );\r\n\r\n  //PCV array init\r\n  let pcvSubdivision = [];\r\n\r\n  //For each subdivision, create a PCV\r\n  for (let i = 0; i < tracksSubdivision[0].length; i++) {\r\n    pcvSubdivision.push(new Pcv());\r\n  }\r\n\r\n  //Compute the PCVs for each subdivision\r\n  //FOR LOOP:\r\n  //i --> i-th track\r\n  //j --> j-th subdivision in the i-th track\r\n  //k --> k-th note in j-th subdivision\r\n  for (let i = 0; i < tracksSubdivision.length; i++) {\r\n    for (let j = 0; j < tracksSubdivision[i].length; j++) {\r\n      for (let k = 0; k < tracksSubdivision[i][j].length; k++) {\r\n        let { pitch, duration } = tracksSubdivision[i][j][k];\r\n        //Add note duration/contribution to the PCV\r\n        pcvSubdivision[j].addNoteDuration(pitch, duration);\r\n      }\r\n    }\r\n  }\r\n\r\n  //Computing the DFT coefficients for of each subdivision\r\n  let dftCoeffsSubdivision = pcvSubdivision.map((pcv) =>\r\n    dft(pcv.getPcvAsArray())\r\n  );\r\n\r\n  //Computing the whole matrix\r\n  let dftCoeffsMatrix = [];\r\n\r\n  //Adding the first row\r\n  dftCoeffsMatrix.push(dftCoeffsSubdivision);\r\n\r\n  //Computing each row of the matrix as the normalized sum of the\r\n  //previous row by using a sliding window of incrementing length\r\n\r\n  let matrixHeight = dftCoeffsMatrix[0].length;\r\n  let baseLength = dftCoeffsMatrix[0].length;\r\n\r\n  //The second row is composed by segments of length 2, third row is...\r\n  let wndLenUnits = 2;\r\n\r\n  //For each row of the matrix, starting from second row\r\n  for (let i = 1; i < matrixHeight; i++) {\r\n    let temp = [];\r\n\r\n    //Slinding window of hop size = 1\r\n    for (let cursor = 0; cursor + wndLenUnits <= baseLength; cursor++) {\r\n      //Extract the windowed subdivisions\r\n      let windowed = dftCoeffsMatrix[0].slice(cursor, cursor + wndLenUnits);\r\n      //The new element of the i-th row is the normalized sum\r\n      //of segments extracted from the previous row\r\n      temp.push(sumAndNormalize(windowed));\r\n    }\r\n    wndLenUnits++;\r\n    dftCoeffsMatrix.push(temp);\r\n  }\r\n\r\n  return dftCoeffsMatrix;\r\n}\r\n\r\n/**\r\n * Compute the traces on the Fourier spaces for the given resolution\r\n * @param {object} midiData\r\n * @param {object} resolutionMode\r\n * @param {number} currentSongBPM\r\n * @returns traces and resolution\r\n */\r\nexport function getDftCoeffDynamic(midiData, resolutionMode, currentSongBPM) {\r\n  let { noteResolutionValue, seconds, useSeconds } = resolutionMode;\r\n\r\n  let resolution;\r\n  //Set resolution depending on which mode is selected\r\n  if (useSeconds) {\r\n    //Use seconds\r\n    isNaN(seconds) ? (resolution = 1) : (resolution = seconds);\r\n  } else {\r\n    //Use music values\r\n    resolution = noteResolutionValue * (60 / currentSongBPM);\r\n  }\r\n\r\n  let duration = midiData.duration;\r\n  let tracksSubdivision = [];\r\n\r\n  //Subdivide the tracks by the resolution\r\n  midiData.tracks.forEach((track) => {\r\n    tracksSubdivision.push(getSubdivision(track.notes, resolution, duration));\r\n  });\r\n\r\n  //PCV array init\r\n  let pcvSubdivision = [];\r\n\r\n  //For each subdivision, create a PCV\r\n  for (let i = 0; i < tracksSubdivision[0].length; i++) {\r\n    pcvSubdivision.push(new Pcv());\r\n  }\r\n\r\n  //Compute the PCVs for each subdivision\r\n  //FOR LOOP:\r\n  //i --> i-th track\r\n  //j --> j-th subdivision in the i-th track\r\n  //k --> k-th note in j-th subdivision\r\n  for (let i = 0; i < tracksSubdivision.length; i++) {\r\n    for (let j = 0; j < tracksSubdivision[i].length; j++) {\r\n      for (let k = 0; k < tracksSubdivision[i][j].length; k++) {\r\n        let { pitch, duration } = tracksSubdivision[i][j][k];\r\n        //Add note duration/contribution to the PCV\r\n        pcvSubdivision[j].addNoteDuration(pitch, duration);\r\n      }\r\n    }\r\n  }\r\n\r\n  //Computing the DFT coefficients for of each subdivision\r\n  let dftCoeffsSubdivision = pcvSubdivision.map((pcv) =>\r\n    dft(pcv.getPcvAsArray())\r\n  );\r\n\r\n  //Generating the traces by subdividing for the coefficient number\r\n  let traces = [];\r\n  //Skipping coefficient zero since it will not be plotted\r\n  for (let i = 1; i < 7; i++) {\r\n    let temp = [];\r\n    for (let j = 0; j < dftCoeffsSubdivision.length; j++) {\r\n      temp.push({\r\n        x: dftCoeffsSubdivision[j][i].re,\r\n        y: dftCoeffsSubdivision[j][i].im,\r\n      });\r\n    }\r\n    traces.push(temp);\r\n  }\r\n\r\n  return { tracesData: traces, resolution: resolution };\r\n}\r\n\r\n/**\r\n * Map the points of the wavescape to RGBA value and subdivide by\r\n * coefficient number\r\n * @param {matrix} dftCoeffsMatrix\r\n * @returns\r\n */\r\nexport function getRgbaMatrix(dftCoeffsMatrix) {\r\n  let rgbaMatrices = [];\r\n\r\n  //Subdividing by coefficient number\r\n  for (let i = 0; i < 6; i++) {\r\n    let temp = [];\r\n    for (let j = 0; j < dftCoeffsMatrix.length; j++) {\r\n      let subdiv = [];\r\n      for (let k = 0; k < dftCoeffsMatrix[j].length; k++) {\r\n        subdiv.push('');\r\n      }\r\n      temp.push(subdiv);\r\n    }\r\n    rgbaMatrices.push(temp);\r\n  }\r\n\r\n  //Mapping to the color space\r\n  for (let i = 0; i < dftCoeffsMatrix.length; i++) {\r\n    for (let j = 0; j < dftCoeffsMatrix[i].length; j++) {\r\n      for (let k = 1; k < dftCoeffsMatrix[i][j].length; k++) {\r\n        rgbaMatrices[k - 1][i][j] = getRgbaFromComplex(\r\n          dftCoeffsMatrix[i][j][k]\r\n        );\r\n      }\r\n    }\r\n  }\r\n\r\n  return rgbaMatrices;\r\n}\r\n\r\n/**\r\n * Subdivide pitches in each time window defined by the reslution\r\n * @param {array} notes all the notes of a track\r\n * @param {number} resolution in seconds\r\n * @param {number} duration MIDI file duration in seconds\r\n * @returns\r\n */\r\nfunction getSubdivision(notes, resolution, duration) {\r\n  //Song's general subdivision\r\n  let subdivision = [];\r\n  let wndLen = resolution;\r\n\r\n  //Traverse the song moving with a step of size wndLen (=resolution)\r\n  //Cursor is the beginning of the current window\r\n  for (let cursor = 0; cursor < duration; cursor += resolution) {\r\n    let temp = [];\r\n\r\n    //Assing each note to a window/subdivision\r\n    notes.forEach((note) => {\r\n      //Extract note's starting time duration\r\n      let { time, duration } = note;\r\n\r\n      //Check if a note contribute to the current window\r\n      if (isValidNote(time, duration, cursor, wndLen)) {\r\n        //Compute the contribution of the note to the current window\r\n        let noteAndDuration = { pitch: note.pitch };\r\n\r\n        //If note starts before the current window\r\n        if (time < cursor) {\r\n          //If note finishes before the end of the window\r\n          if (time + duration < cursor + wndLen)\r\n            //Add only the duration that overlap with the current window\r\n            noteAndDuration.duration = time + duration - cursor;\r\n          //Else, the note continues for the whole duration of the window\r\n          //Add the window length as duration, since note duration overlap the whole window\r\n          else noteAndDuration.duration = wndLen;\r\n        }\r\n\r\n        //If note start in the current window\r\n        else {\r\n          //If note finishes before the end of the window\r\n          if (time + duration <= cursor + wndLen)\r\n            //Add only the note duration\r\n            noteAndDuration.duration = duration;\r\n          //Else, the note continues to the next window\r\n          //Add only the part that overlap with the  current window\r\n          else noteAndDuration.duration = cursor + wndLen - time;\r\n        }\r\n\r\n        temp.push(noteAndDuration);\r\n      }\r\n    });\r\n\r\n    subdivision.push(temp);\r\n  }\r\n\r\n  return subdivision;\r\n}\r\n\r\n/**\r\n * True if a note contribute to the PCV of the current window\r\n * @param {number} time starting time of a note\r\n * @param {number} duration duration of a note\r\n * @param {number} cursor starting time of the current window\r\n * @param {number} wndLen size of the current window\r\n * @returns boolean\r\n */\r\nfunction isValidNote(time, duration, cursor, wndLen) {\r\n  //A note contribute to the current window if:\r\n  //1. starting time is in the current window\r\n  //2. starts before the beginning of the window but\r\n  //   finishes before the end of the window\r\n  //3. starts before the beginning of the window\r\n  //   and continues for the whole duration of the window\r\n  if (\r\n    (time > cursor && time < cursor + wndLen) ||\r\n    (time + duration > cursor && time + duration < cursor + wndLen) ||\r\n    (time <= cursor && time + duration >= cursor + wndLen)\r\n  ) {\r\n    return true;\r\n  }\r\n  return false;\r\n}\r\n","/**\r\n * Compute the points of the rose's shape\r\n * see https://en.wikipedia.org/wiki/Rose_(mathematics)\r\n * @param {number} n numerator\r\n * @param {number} d denominator\r\n * @returns array\r\n */\r\nexport function getRosePoints(n, d) {\r\n  let dataPoints = [];\r\n\r\n  //Increase delta step to have less points\r\n  for (let delta = 0; delta < 2 * Math.PI * d; delta += 0.01) {\r\n    let r = 10 * Math.cos((n / d) * delta);\r\n    let x = r * Math.cos(delta);\r\n    let y = r * Math.sin(delta);\r\n\r\n    dataPoints.push([x, y]);\r\n  }\r\n\r\n  return dataPoints;\r\n}\r\n","//React\r\nimport React from 'react';\r\nimport { Link } from 'react-router-dom';\r\n\r\n//Import material UI components\r\nimport MuiAppBar from '@mui/material/AppBar';\r\nimport Box from '@mui/material/Box';\r\nimport Toolbar from '@mui/material/Toolbar';\r\nimport Typography from '@mui/material/Typography';\r\nimport Button from '@mui/material/Button';\r\nimport ButtonGroup from '@mui/material/ButtonGroup';\r\nimport { styled } from '@mui/material/styles';\r\nimport ChevronRightIcon from '@mui/icons-material/ChevronRight';\r\nimport IconButton from '@mui/material/IconButton';\r\n\r\nconst drawerWidth = 400;\r\n\r\n//AppBar animation\r\nconst AppBar = styled(MuiAppBar, {\r\n  shouldForwardProp: (prop) => prop !== 'open',\r\n})(({ theme, open }) => ({\r\n  transition: theme.transitions.create(['margin', 'width'], {\r\n    easing: theme.transitions.easing.sharp,\r\n    duration: theme.transitions.duration.leavingScreen,\r\n  }),\r\n  ...(open && {\r\n    width: `calc(100% - ${drawerWidth}px)`,\r\n    marginLeft: `${drawerWidth}px`,\r\n    transition: theme.transitions.create(['margin', 'width'], {\r\n      easing: theme.transitions.easing.easeOut,\r\n      duration: theme.transitions.duration.enteringScreen,\r\n    }),\r\n  }),\r\n}));\r\n\r\n//Navbar component\r\nexport default function Navbar({ open, setOpen, inAnalysisPage }) {\r\n  //Open Drawer on ChevronRightIcon click\r\n  const handleDrawerOpen = () => {\r\n    setOpen(true);\r\n  };\r\n\r\n  return (\r\n    <Box sx={{ flexGrow: 1 }}>\r\n      <AppBar position='static' open={open}>\r\n        <Toolbar>\r\n          {/* Open Drawer button */}\r\n          <IconButton\r\n            disabled={!inAnalysisPage}\r\n            color='inherit'\r\n            aria-label='open drawer'\r\n            onClick={handleDrawerOpen}\r\n            edge='start'\r\n            sx={{ mr: 2, ...(open && { display: 'none' }) }}\r\n          >\r\n            <ChevronRightIcon />\r\n          </IconButton>\r\n\r\n          {/* App name */}\r\n          <Typography variant='h3' component='div' sx={{ flexGrow: 1 }}>\r\n            Mi_DFT\r\n          </Typography>\r\n\r\n          {/* Navigation buttons */}\r\n          <ButtonGroup aria-label='outlined button group'>\r\n            <Button\r\n              component={Link}\r\n              to='/'\r\n              variant='contained'\r\n              disableElevation={true}\r\n            >\r\n              Home\r\n            </Button>\r\n            <Button\r\n              component={Link}\r\n              to='/theory'\r\n              variant='contained'\r\n              disableElevation={true}\r\n            >\r\n              Theory\r\n            </Button>\r\n            <Button\r\n              component={Link}\r\n              to='/analysis'\r\n              variant='contained'\r\n              disableElevation={true}\r\n            >\r\n              Analysis\r\n            </Button>\r\n          </ButtonGroup>\r\n        </Toolbar>\r\n      </AppBar>\r\n    </Box>\r\n  );\r\n}\r\n","export default __webpack_public_path__ + \"static/media/whole.69e31bd8.svg\";","export default __webpack_public_path__ + \"static/media/half.7d756528.svg\";","export default __webpack_public_path__ + \"static/media/quarter.a35808dc.svg\";","export default __webpack_public_path__ + \"static/media/eighth.347a1769.svg\";","export default __webpack_public_path__ + \"static/media/sixteenth.91907e68.svg\";","//React\r\nimport { useRef, useState } from 'react';\r\n\r\n//Import material UI components\r\nimport Radio from '@mui/material/Radio';\r\nimport RadioGroup from '@mui/material/RadioGroup';\r\nimport FormControl from '@mui/material/FormControl';\r\nimport FormControlLabel from '@mui/material/FormControlLabel';\r\nimport TextField from '@mui/material/TextField';\r\nimport Box from '@mui/material/Box';\r\nimport Button from '@mui/material/Button';\r\n\r\n//Import notes' symbols\r\nimport wholeSvg from './svgNotation/whole.svg';\r\nimport halfSvg from './svgNotation/half.svg';\r\nimport quarterSvg from './svgNotation/quarter.svg';\r\nimport eighthSvg from './svgNotation/eighth.svg';\r\nimport sixteenthSvg from './svgNotation/sixteenth.svg';\r\n\r\n//Component resolution selector\r\nfunction ResolutionSelector({\r\n  resolutionMode,\r\n  setResolutionMode,\r\n  retriggerAnalysis,\r\n}) {\r\n  //State: boolean\r\n  //If true, notify the user that seconds' input is invalid\r\n  const [isInputSecondsInvalid, setIsInputSecondsInvalid] = useState(false);\r\n  const resolutionTextRef = useRef(null);\r\n\r\n  /**\r\n   * On form change, update the new resolution mode\r\n   */\r\n  function onChangeResolutionSelection(event) {\r\n    let newResolutionMode = { ...resolutionMode };\r\n    newResolutionMode.seconds = parseFloat(resolutionTextRef.current.value);\r\n\r\n    switch (event.target.value) {\r\n      case 'sixteenth':\r\n        newResolutionMode.noteResolutionValue = 0.25;\r\n        newResolutionMode.useSeconds = false;\r\n        break;\r\n      case 'eighth':\r\n        newResolutionMode.noteResolutionValue = 0.5;\r\n        newResolutionMode.useSeconds = false;\r\n        break;\r\n      case 'quarter':\r\n        newResolutionMode.noteResolutionValue = 1;\r\n        newResolutionMode.useSeconds = false;\r\n        break;\r\n      case 'half':\r\n        newResolutionMode.noteResolutionValue = 2;\r\n        newResolutionMode.useSeconds = false;\r\n        break;\r\n      case 'whole':\r\n        newResolutionMode.noteResolutionValue = 4;\r\n        newResolutionMode.useSeconds = false;\r\n        break;\r\n      case 'seconds':\r\n        newResolutionMode.useSeconds = true;\r\n        break;\r\n      default:\r\n        break;\r\n    }\r\n\r\n    setResolutionMode(newResolutionMode);\r\n  }\r\n\r\n  return (\r\n    <Box>\r\n      <FormControl component='fieldset'>\r\n        <RadioGroup\r\n          row\r\n          defaultValue='quarter'\r\n          onChange={onChangeResolutionSelection}\r\n          aria-label='resolution'\r\n          name='row-radio-buttons-group'\r\n          sx={{ display: 'flex', justifyContent: 'space-between' }}\r\n        >\r\n          <FormControlLabel\r\n            value='sixteenth'\r\n            control={<Radio size='small' />}\r\n            label={\r\n              <img\r\n                style={{\r\n                  width: 10,\r\n                  height: 10,\r\n                  transform: 'scale(3, 3)',\r\n                }}\r\n                src={sixteenthSvg}\r\n              />\r\n            }\r\n          />\r\n          <FormControlLabel\r\n            value='eighth'\r\n            control={<Radio size='small' />}\r\n            label={\r\n              <img\r\n                style={{\r\n                  width: 10,\r\n                  height: 10,\r\n                  transform: 'scale(3, 3) translate(0, 0)',\r\n                }}\r\n                src={eighthSvg}\r\n              />\r\n            }\r\n          />\r\n          <FormControlLabel\r\n            value='quarter'\r\n            control={<Radio size='small' />}\r\n            label={\r\n              <img\r\n                style={{\r\n                  width: 10,\r\n                  height: 10,\r\n                  marginTop: 8,\r\n                  transform: 'scale(1, 3)',\r\n                }}\r\n                src={quarterSvg}\r\n              />\r\n            }\r\n          />\r\n          <FormControlLabel\r\n            value='half'\r\n            control={<Radio size='small' />}\r\n            label={\r\n              <img\r\n                style={{\r\n                  width: 10,\r\n                  height: 10,\r\n                  marginTop: 8,\r\n                  transform: 'scale(3.7, 3.2) ',\r\n                }}\r\n                src={halfSvg}\r\n              />\r\n            }\r\n          />\r\n          <FormControlLabel\r\n            value='whole'\r\n            control={<Radio size='small' />}\r\n            label={\r\n              <img\r\n                style={{\r\n                  width: 10,\r\n                  height: 10,\r\n                  marginTop: 0,\r\n                  transform: 'scale(1.5, 1)',\r\n                }}\r\n                src={wholeSvg}\r\n              />\r\n            }\r\n          />\r\n\r\n          <FormControlLabel\r\n            value='seconds'\r\n            control={<Radio size='small' />}\r\n            label={\r\n              <TextField\r\n                sx={{ minHeight: '4.4rem', maxWidth: '5rem' }}\r\n                error={isInputSecondsInvalid}\r\n                helperText={isInputSecondsInvalid && 'Invalid input'}\r\n                label='in seconds'\r\n                id='standard-size-small'\r\n                defaultValue='1.5'\r\n                size='small'\r\n                variant='standard'\r\n                onChange={() => {\r\n                  let newResolutionMode = { ...resolutionMode };\r\n                  newResolutionMode.seconds = parseFloat(\r\n                    resolutionTextRef.current.value\r\n                  );\r\n                  if (isNaN(newResolutionMode.seconds))\r\n                    setIsInputSecondsInvalid(true);\r\n                  else {\r\n                    setResolutionMode(newResolutionMode);\r\n                    setIsInputSecondsInvalid(false);\r\n                  }\r\n                }}\r\n                inputRef={resolutionTextRef}\r\n              />\r\n            }\r\n          />\r\n          <Button\r\n            variant='contained'\r\n            onClick={retriggerAnalysis}\r\n            sx={{ width: '22%', height: '15%', marginTop: 2 }}\r\n          >\r\n            Change\r\n          </Button>\r\n        </RadioGroup>\r\n      </FormControl>\r\n    </Box>\r\n  );\r\n}\r\n\r\nexport default ResolutionSelector;\r\n","//Import material UI components\r\nimport { styled } from '@mui/material/styles';\r\nimport Chip from '@mui/material/Chip';\r\nimport Paper from '@mui/material/Paper';\r\n\r\n//Stiled chips\r\nconst ListItem = styled('li')(({ theme }) => ({\r\n  margin: theme.spacing(0.5),\r\n}));\r\n\r\n//Chips box component\r\nexport default function PcvChipsBox({ userPcvs, setUserPcvs, rosesMat }) {\r\n  const handleDelete = (chipToDelete) => () => {\r\n    //On detele, set the rose icon to unused\r\n    //matrix coeffs are i = d-1, j=d-1\r\n    rosesMat[chipToDelete.d - 1][chipToDelete.n - 1].used = false;\r\n\r\n    //Update\r\n    setUserPcvs((chips) =>\r\n      chips.filter((chip) => chip.label !== chipToDelete.label)\r\n    );\r\n  };\r\n\r\n  return (\r\n    <Paper\r\n      sx={{\r\n        display: 'flex',\r\n        justifyContent: 'center',\r\n        flexWrap: 'wrap',\r\n        listStyle: 'none',\r\n        p: '3px',\r\n        overflow: 'auto',\r\n        height: '100%',\r\n        width: '100%',\r\n      }}\r\n      component='ul'\r\n    >\r\n      {userPcvs.map((data, i) => {\r\n        return (\r\n          <ListItem key={`${i}`}>\r\n            <Chip\r\n              variant={data.isDisabled ? 'outlined' : 'filled'}\r\n              icon={\r\n                <svg\r\n                  xmlns='http://www.w3.org/2000/svg'\r\n                  width='24'\r\n                  height='24'\r\n                  viewBox='0 0 24 24'\r\n                >\r\n                  <g>\r\n                    <polyline\r\n                      transform={`translate(${12},${12})`}\r\n                      fill='none'\r\n                      stroke='black'\r\n                      strokeWidth='1px'\r\n                      points={data.rosePoints}\r\n                    />\r\n                  </g>\r\n                </svg>\r\n              }\r\n              label={data.label}\r\n              onDelete={handleDelete(data)}\r\n              onClick={() => {\r\n                data.isDisabled = !data.isDisabled;\r\n                setUserPcvs([...userPcvs]);\r\n              }}\r\n            />\r\n          </ListItem>\r\n        );\r\n      })}\r\n    </Paper>\r\n  );\r\n}\r\n","import * as d3 from 'd3';\r\nimport * as math from 'mathjs';\r\nimport { gradient } from './colorMapping';\r\n\r\n//Generates SVGs of the Fourier spaces for the exporting,\r\n//see Circle.js\r\nexport default ({\r\n  traceData,\r\n  userPcv,\r\n  prototypesData,\r\n  coeffNumber,\r\n  showNumber,\r\n}) => {\r\n  //Size and N number of subdivisions of the arches\r\n  const width = 450;\r\n  const height = width;\r\n  const innerWidth = 0.8 * width;\r\n  //const innerHeight = innerWidth;\r\n  const N = 50;\r\n  const K = 20;\r\n\r\n  let marksRadiusRatio = 0.01;\r\n  let circleRadius = innerWidth / 2;\r\n\r\n  const theta = (2 * math.pi) / N;\r\n  const angles = d3.range(0, 2 * math.pi, theta);\r\n  const circularSectors = d3.range(0, 1, 1 / K);\r\n\r\n  //Generates all the arches that compose the circle\r\n  const arc = (angle, id, index, inner) => {\r\n    const offset = -math.pi / 2;\r\n\r\n    const d = d3\r\n      .arc()\r\n      .innerRadius((inner * innerWidth) / 2)\r\n      .outerRadius(((inner + 1 / K) * innerWidth) / 2)\r\n      .startAngle(-(angle + offset))\r\n      .endAngle(-(angle + theta + offset));\r\n\r\n    return (\r\n      <path\r\n        key={`${index}.${id}`}\r\n        fill={gradient(angle)}\r\n        fillOpacity={inner}\r\n        stroke={gradient(angle)}\r\n        strokeOpacity={inner / 10}\r\n        d={d()}\r\n        /* shapeRendering={'geometricPrecision'} */\r\n      ></path>\r\n    );\r\n  };\r\n\r\n  const circleMark = (pcvData, radiusScaleWidth, color, id, opacity = 1) => {\r\n    const mark = d3\r\n      .arc()\r\n      .innerRadius(0)\r\n      .outerRadius((radiusScaleWidth * width) / 2)\r\n      .startAngle(0)\r\n      .endAngle(2 * Math.PI);\r\n\r\n    return (\r\n      <path\r\n        transform={`translate(${pcvData.x * circleRadius},${\r\n          -pcvData.y * circleRadius\r\n        })`}\r\n        fill={color}\r\n        fillOpacity={opacity}\r\n        key={id}\r\n        d={mark()}\r\n      ></path>\r\n    );\r\n  };\r\n\r\n  const protoCircleMark = (pcvData, id) => {\r\n    let scaleRatio = 0.02;\r\n    const mark = d3\r\n      .arc()\r\n      .innerRadius((scaleRatio * width) / 2)\r\n      .outerRadius(((scaleRatio + 0.01) * width) / 2)\r\n      .startAngle(0)\r\n      .endAngle(2 * Math.PI);\r\n\r\n    //Check for sub/superscript\r\n    let labelName = '';\r\n    let subSup = '';\r\n    let isSub = false;\r\n    if (pcvData.label.includes('_') || pcvData.label.includes('^')) {\r\n      for (let i = 0; i < pcvData.label.length; i++) {\r\n        if (pcvData.label[i] === '_') {\r\n          labelName = pcvData.label.slice(0, i);\r\n          subSup = pcvData.label.slice(i + 1, pcvData.label.length);\r\n          isSub = true;\r\n        }\r\n        if (pcvData.label[i] === '^') {\r\n          labelName = pcvData.label.slice(0, i);\r\n          subSup = pcvData.label.slice(i + 1, pcvData.label.length);\r\n        }\r\n      }\r\n    } else {\r\n      labelName = pcvData.label;\r\n    }\r\n\r\n    //Computation of label offset\r\n    //Good for most of the labels\r\n    let dxOffset = Math.sign(pcvData.x) * 18,\r\n      dyOffset = -Math.sign(pcvData.y) * 18 + 7;\r\n\r\n    //Custom rules for labels\r\n    if (labelName === '') dyOffset -= 3;\r\n    if (labelName === 'WT' && subSup === '1') dxOffset *= 1.2;\r\n    if (labelName === 'WT' && subSup === '0') dxOffset *= 1.4;\r\n    if (labelName === 'C' && subSup === 'o7') dxOffset *= 1.2;\r\n    if (labelName === 'O' && subSup === '1,2') dyOffset *= 1.1;\r\n    if (labelName === 'C' && subSup === 'o7') {\r\n      dxOffset *= 1.1;\r\n      dyOffset *= 1.1;\r\n    }\r\n    if (labelName === 'D' && subSup === 'o7') {\r\n      dxOffset *= 0.7;\r\n      dyOffset *= 0.7;\r\n    }\r\n    if (labelName === 'H' && subSup === '2,3') {\r\n      dxOffset *= 1.2;\r\n      dyOffset *= 1.2;\r\n    }\r\n    if (labelName === 'H' && subSup === '1,2') {\r\n      dxOffset *= 0.7;\r\n      dyOffset *= 0.7;\r\n    }\r\n    if (labelName === '') {\r\n      dxOffset = 15;\r\n      dyOffset = 5;\r\n    }\r\n\r\n    return (\r\n      <g\r\n        transform={`translate(${pcvData.x * circleRadius},${\r\n          -pcvData.y * circleRadius\r\n        })`}\r\n        key={`p.${id}`}\r\n      >\r\n        <path fill={'grey'} key={id} d={mark()}></path>\r\n        <text textAnchor='middle' dx={dxOffset} dy={dyOffset} fontSize='20px'>\r\n          {labelName}\r\n          {isSub ? (\r\n            <tspan fontSize={15} baselineShift='sub'>\r\n              {subSup}\r\n            </tspan>\r\n          ) : (\r\n            <tspan fontSize={15} baselineShift='super'>\r\n              {subSup}\r\n            </tspan>\r\n          )}\r\n        </text>\r\n      </g>\r\n    );\r\n  };\r\n\r\n  function svgRoseIcon(rosePoints, translateX, translateY, scale, i) {\r\n    return (\r\n      <g key={`rose${i}`}>\r\n        <polyline\r\n          transform={`translate(${translateX},${translateY}) scale(${scale})`}\r\n          fill='none'\r\n          stroke='black'\r\n          strokeWidth='1px'\r\n          points={rosePoints}\r\n        />\r\n      </g>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <svg\r\n      xmlns='http://www.w3.org/2000/svg'\r\n      key={`circle${coeffNumber}`}\r\n      width={width}\r\n      height={height}\r\n    >\r\n      {showNumber ? (\r\n        <g transform={`translate(32,20)`}>\r\n          <circle cx='12' cy='12' r='13' fill='black' />\r\n          <text fontSize='24' textAnchor='middle' x='12' y='20' fill='white'>\r\n            {coeffNumber}\r\n          </text>\r\n        </g>\r\n      ) : null}\r\n\r\n      <g transform={`translate(${width / 2},${height / 2})`}>\r\n        {circularSectors.map((innerRadius) =>\r\n          angles.map((angle, id) => arc(angle, id, coeffNumber, innerRadius))\r\n        )}\r\n        {traceData.map((pcv, i) =>\r\n          circleMark(pcv, marksRadiusRatio, 'black', i, 0.2)\r\n        )}\r\n        {userPcv\r\n          ? userPcv.map((pcv, i) => {\r\n              if (!pcv.isDisabled)\r\n                return svgRoseIcon(\r\n                  pcv.rosePoints,\r\n                  pcv.x * circleRadius,\r\n                  -pcv.y * circleRadius,\r\n                  0.7,\r\n                  i\r\n                );\r\n            })\r\n          : null}\r\n        {prototypesData.map((pcv, i) => protoCircleMark(pcv, i))}\r\n      </g>\r\n    </svg>\r\n  );\r\n};\r\n","import React from 'react';\r\n\r\nconst verticalScale = Math.sin(Math.PI / 3);\r\n\r\n//Generates SVGs of the wavescapes for the exporting,\r\n//see Wavescape.js \r\nfunction WavescapeSVG({ wsNumber, wavescapeMatrix, showNumber }) {\r\n  const margin = 10;\r\n  const width = 400;\r\n  const height = width;\r\n  /* const [wsCoordinates, setWsCoordinates] = useState([]); */\r\n\r\n  let margins = [margin, margin];\r\n  let innerSize = [width - margins[0], width - margins[1]];\r\n  let baseSubdivision;\r\n  let wsCoordinates;\r\n\r\n  baseSubdivision = wavescapeMatrix[0].length;\r\n  wsCoordinates = computeTicks(\r\n    innerSize[0],\r\n    innerSize[1],\r\n    baseSubdivision,\r\n    margins[0],\r\n    margins[1]\r\n  );\r\n\r\n  return (\r\n    <svg\r\n      id={`wavescape${wsNumber}`}\r\n      width={width + margin}\r\n      height={height}\r\n      xmlns='http://www.w3.org/2000/svg'\r\n    >\r\n      {showNumber ? (\r\n        <g transform={`translate(32,20)`}>\r\n          <circle cx='12' cy='12' r='13' fill='black' />\r\n          <text fontSize='24' textAnchor='middle' x='12' y='20' fill='white'>\r\n            {wsNumber}\r\n          </text>\r\n        </g>\r\n      ) : null}\r\n\r\n      <g\r\n        transform={`scale(${1}, ${-verticalScale}) translate(${0},${\r\n          -height - 2 * margin\r\n        })`}\r\n      >\r\n        {/* Contour line */}\r\n        {wsCoordinates.length > 0 ? (\r\n          <>\r\n            <line\r\n              x1={wsCoordinates[0][0].x}\r\n              x2={wsCoordinates[0][wsCoordinates[0].length - 1].x}\r\n              y1={wsCoordinates[0][0].y}\r\n              y2={wsCoordinates[0][wsCoordinates[0].length - 1].y}\r\n              stroke='grey'\r\n              strokeWidth='1px'\r\n            />\r\n            <line\r\n              x1={wsCoordinates[0][wsCoordinates[0].length - 1].x}\r\n              x2={wsCoordinates[wsCoordinates.length - 1][0].x}\r\n              y1={wsCoordinates[0][wsCoordinates[0].length - 1].y}\r\n              y2={wsCoordinates[wsCoordinates.length - 1][0].y}\r\n              stroke='grey'\r\n              strokeWidth='1px'\r\n            />\r\n            <line\r\n              x1={wsCoordinates[0][0].x}\r\n              x2={wsCoordinates[wsCoordinates.length - 1][0].x}\r\n              y1={wsCoordinates[0][0].y}\r\n              y2={wsCoordinates[wsCoordinates.length - 1][0].y}\r\n              stroke='grey'\r\n              strokeWidth='1px'\r\n            />\r\n          </>\r\n        ) : null}\r\n        {wavescapeMatrix.map((row, i) => {\r\n          return row.map((elem, j) => {\r\n            if (i === 0) {\r\n              return (\r\n                <polygon\r\n                  points={`${wsCoordinates[i][j].x},${wsCoordinates[i][j].y}\r\n                 ${wsCoordinates[i][j + 1].x},${wsCoordinates[i][j + 1].y} \r\n                 ${wsCoordinates[i + 1][j].x},${wsCoordinates[i + 1][j].y}`}\r\n                  fill={elem}\r\n                />\r\n              );\r\n            } else {\r\n              return (\r\n                <polygon\r\n                  points={`\r\n                 ${wsCoordinates[i][j].x},${wsCoordinates[i][j].y}\r\n                 ${wsCoordinates[i - 1][j + 1].x},${\r\n                    wsCoordinates[i - 1][j + 1].y\r\n                  }\r\n                 ${wsCoordinates[i][j + 1].x},${wsCoordinates[i][j + 1].y} \r\n                 ${wsCoordinates[i + 1][j].x},${wsCoordinates[i + 1][j].y}\r\n                 `}\r\n                  fill={elem}\r\n                />\r\n              );\r\n            }\r\n          });\r\n        })}\r\n      </g>\r\n    </svg>\r\n  );\r\n}\r\n\r\nexport default WavescapeSVG;\r\n\r\nfunction computeTicks(\r\n  innerWidth,\r\n  innerHeight,\r\n  baseSubdivision,\r\n  marginLeft,\r\n  marginTop\r\n) {\r\n  //Actually, it is a square matrix\r\n  let unit = innerWidth / baseSubdivision;\r\n  let mat = [];\r\n\r\n  for (let i = 0; i < baseSubdivision + 1; i++) {\r\n    let temp = [];\r\n    for (let j = 0; j < baseSubdivision + 1; j++) {\r\n      if (i <= j)\r\n        temp.push({\r\n          x: (j - i) * unit + (i * unit) / 2 + marginLeft,\r\n          y: i * unit + marginTop,\r\n        });\r\n    }\r\n    mat.push(temp);\r\n  }\r\n\r\n  return mat;\r\n}","export const prototypesData = [\r\n  [\r\n    { label: '', x: 0, y: 0 },\r\n    { label: 'C', x: 1, y: 0 },\r\n    { label: 'C', x: 0.866, y: -0.5 },\r\n    { label: 'D', x: 0.5, y: -0.866 },\r\n    { label: 'E', x: 0, y: -1 },\r\n    { label: 'E', x: -0.5, y: -0.866 },\r\n    { label: 'F', x: -0.866, y: -0.5 },\r\n    { label: 'F', x: -1, y: 0 },\r\n    { label: 'G', x: -0.866, y: 0.5 },\r\n    { label: 'A', x: -0.5, y: 0.866 },\r\n    { label: 'A', x: 0, y: 1 },\r\n    { label: 'B', x: 0.5, y: 0.866 },\r\n    { label: 'B', x: 0.866, y: 0.5 },\r\n  ],\r\n  [\r\n    { label: '', x: 0, y: 0 },\r\n    { label: 'T_0', x: 1, y: 0 },\r\n    { label: 'T_1', x: 0.5, y: -0.866 },\r\n    { label: 'T_2', x: -0.5, y: -0.866 },\r\n    { label: 'T_3', x: -1, y: 0 },\r\n    { label: 'T_4', x: -0.5, y: 0.866 },\r\n    { label: 'T_5', x: 0.5, y: 0.866 },\r\n  ],\r\n  [\r\n    { label: '', x: 0, y: 0 },\r\n    { label: 'C+', x: 1, y: 0 },\r\n    { label: 'C+', x: 0, y: -1 },\r\n    { label: 'D+', x: -1, y: 0 },\r\n    { label: 'D+', x: 0, y: 1 },\r\n    { label: 'H_0,3', x: 0.5, y: 0.5 },\r\n    { label: 'H_0,1', x: 0.5, y: -0.5 },\r\n    { label: 'H_1,2', x: -0.5, y: -0.5 },\r\n    { label: 'H_2,3', x: -0.5, y: 0.5 },\r\n  ],\r\n  [\r\n    { label: '', x: 0, y: 0 },\r\n    { label: 'C^o7', x: 1, y: 0 },\r\n    { label: 'C^o7', x: -0.5, y: -0.866 },\r\n    { label: 'D^o7', x: -0.5, y: 0.866 },\r\n    { label: 'O_0,2', x: 0.25, y: 0.433 },\r\n    { label: 'O_0,1', x: 0.25, y: -0.433 },\r\n    { label: 'O_1,2', x: -0.5, y: 0 },\r\n  ],\r\n  [\r\n    { label: '', x: 0, y: 0 },\r\n    { label: 'C', x: 1, y: 0 },\r\n    { label: 'F', x: 0.866, y: -0.5 },\r\n    { label: 'B', x: 0.5, y: -0.866 },\r\n    { label: 'E', x: 0, y: -1 },\r\n    { label: 'A', x: -0.5, y: -0.866 },\r\n    { label: 'C', x: -0.866, y: -0.5 },\r\n    { label: 'F', x: -1, y: 0 },\r\n    { label: 'B', x: -0.866, y: 0.5 },\r\n    { label: 'E', x: -0.5, y: 0.866 },\r\n    { label: 'A', x: 0, y: 1 },\r\n    { label: 'D', x: 0.5, y: 0.866 },\r\n    { label: 'G', x: 0.866, y: 0.5 },\r\n    { label: '', x: 0.267, y: 0.462 },\r\n    { label: '5', x: 0, y: -0.533 },\r\n    { label: '2', x: -0.267, y: 0.462 },\r\n    { label: '3', x: 0.462, y: -0.267 },\r\n    { label: '4', x: -0.533, y: 0 },\r\n    { label: '', x: 0.462, y: 0.267 },\r\n    { label: '6', x: -0.267, y: -0.462 },\r\n    { label: '', x: 0, y: 0.533 },\r\n    { label: '4', x: 0.267, y: -0.462 },\r\n    { label: '3', x: -0.462, y: 0.267 },\r\n    { label: '2', x: 0.533, y: 0 },\r\n    { label: '5', x: -0.462, y: -0.267 },\r\n  ],\r\n  [\r\n    { label: '', x: 0, y: 0 },\r\n    { label: 'WT_0', x: 1, y: 0 },\r\n    { label: 'WT_1', x: -1, y: 0 },\r\n  ],\r\n];\r\n","//React\r\nimport { useEffect, useState } from 'react';\r\nimport ReactDOMServer from 'react-dom/server';\r\n\r\n//Import libraries\r\nimport JSZip from 'jszip';\r\nimport { saveAs } from 'file-saver';\r\n\r\n//Import components\r\nimport CircleSVG from './CircleSVG';\r\nimport WavescapeSVG from './WavescapeSVG';\r\nimport { prototypesData } from './prototypesData';\r\n\r\n//Import material UI components\r\nimport Button from '@mui/material/Button';\r\nimport Dialog from '@mui/material/Dialog';\r\nimport DialogActions from '@mui/material/DialogActions';\r\nimport DialogContent from '@mui/material/DialogContent';\r\nimport DialogContentText from '@mui/material/DialogContentText';\r\nimport DialogTitle from '@mui/material/DialogTitle';\r\nimport FormGroup from '@mui/material/FormGroup';\r\nimport FormControlLabel from '@mui/material/FormControlLabel';\r\nimport Checkbox from '@mui/material/Checkbox';\r\nimport Typography from '@mui/material/Typography';\r\nimport Box from '@mui/system/Box';\r\nimport Popover from '@mui/material/Popover';\r\n\r\n//Save dialog component\r\nfunction SaveDialog({ traces, userPcvs, wavescapesData }) {\r\n  // ----- DIALOG WINDOW ----- //\r\n  //State: boolean\r\n  //True if the dialog window is opened\r\n  const [open, setOpen] = useState(false);\r\n\r\n  //States: boolean\r\n  //True to include the correspondent elements in the exported images\r\n  const [checkNumb, setCheckNumb] = useState(true);\r\n  const [checkTrace, setCheckTrace] = useState(true);\r\n  const [checkProto, setCheckProto] = useState(true);\r\n  const [checkPcvs, setCheckPcvs] = useState(true);\r\n\r\n  //State: array\r\n  //PCVs to be include in the exported images\r\n  const [subdivUserPcvs, setSubdivUserPcvs] = useState([]);\r\n\r\n  const handleClickOpen = () => {\r\n    setOpen(true);\r\n  };\r\n\r\n  const handleClose = () => {\r\n    setOpen(false);\r\n  };\r\n\r\n  // ----- POPOVER ----- //\r\n  //State: boolean\r\n  //If true images can be exported, else there is no MIDI data\r\n  const [canSave, setCanSave] = useState(false);\r\n  const [anchorEl, setAnchorEl] = useState(null);\r\n\r\n  const handleClickPopover = (event) => {\r\n    if (canSave) saveImages();\r\n    else setAnchorEl(event.currentTarget);\r\n  };\r\n\r\n  const handleClosePopover = () => {\r\n    setAnchorEl(null);\r\n  };\r\n\r\n  const openPopover = Boolean(anchorEl);\r\n  const id = open ? 'simple-popover' : undefined;\r\n\r\n  //Effect: update canSave if there is data in wavescapes\r\n  useEffect(() => {\r\n    wavescapesData.length > 0 ? setCanSave(true) : setCanSave(false);\r\n  }, [wavescapesData]);\r\n\r\n  //Effect: on user PCVs update, subdivide by coefficient number\r\n  useEffect(() => {\r\n    //Subdividing the coeffs for each circle\r\n    let tempSubdivUserPcvs = [];\r\n    for (let i = 1; i < 7; i++) {\r\n      let temp = [];\r\n      for (let j = 0; j < userPcvs.length; j++) {\r\n        temp.push({\r\n          x: userPcvs[j].coeffs[i].re,\r\n          y: userPcvs[j].coeffs[i].im,\r\n          rosePoints: userPcvs[j].rosePoints,\r\n          isDisabled: userPcvs[j].isDisabled,\r\n          label: userPcvs[j].label,\r\n        });\r\n      }\r\n      tempSubdivUserPcvs.push(temp);\r\n    }\r\n\r\n    setSubdivUserPcvs(tempSubdivUserPcvs);\r\n  }, [userPcvs]);\r\n\r\n  /**\r\n   * Generate the static markup for the exported wavescapes\r\n   * @param {number} k coefficient number\r\n   * @returns string\r\n   */\r\n  function generateWavescapeSVG(k) {\r\n    let data = (\r\n      <WavescapeSVG\r\n        wavescapeMatrix={wavescapesData.length > 0 ? wavescapesData[k - 1] : []}\r\n        wsNumber={k}\r\n        showNumber={checkNumb}\r\n      />\r\n    );\r\n\r\n    return ReactDOMServer.renderToStaticMarkup(data);\r\n  }\r\n\r\n  /**\r\n   * Generate the static markup for the exported Fourier spaces\r\n   * @param {number} k coefficient number\r\n   * @returns string\r\n   */\r\n  function generateCircleSVG(k) {\r\n    let data = (\r\n      <CircleSVG\r\n        traceData={traces.length > 0 && checkTrace ? traces[k - 1] : []}\r\n        prototypesData={checkProto ? prototypesData[k - 1] : []}\r\n        userPcv={checkPcvs ? subdivUserPcvs[k - 1] : []}\r\n        coeffNumber={k}\r\n        showNumber={checkNumb}\r\n      />\r\n    );\r\n\r\n    return ReactDOMServer.renderToStaticMarkup(data);\r\n  }\r\n\r\n  /**\r\n   * Export the generated images\r\n   */\r\n  const saveImages = () => {\r\n    let zip = new JSZip();\r\n\r\n    //For each coefficient number\r\n    [1, 2, 3, 4, 5, 6].forEach((i) => {\r\n      //Generate SVGs\r\n      let circleSVG = generateCircleSVG(i);\r\n      let wavescapeSVG = generateWavescapeSVG(i);\r\n\r\n      //Adding files to zip\r\n      zip.file(`wavescapes/wavescape${i}.svg`, wavescapeSVG);\r\n      zip.file(`fourier/space${i}.svg`, circleSVG);\r\n    });\r\n\r\n    //Generate zip and save it\r\n    zip.generateAsync({ type: 'blob' }).then(function (content) {\r\n      saveAs(content, 'images.zip');\r\n    });\r\n\r\n    //Close the dialog window\r\n    setOpen(false);\r\n  };\r\n\r\n  return (\r\n    <>\r\n      {/* EXPORT BUTTON */}\r\n      <Button\r\n        variant='contained'\r\n        size='small'\r\n        color='primary'\r\n        sx={{\r\n          width: '35%',\r\n          margin: 'auto',\r\n          marginTop: 1,\r\n          marginBottom: 1,\r\n        }}\r\n        onClick={handleClickOpen}\r\n      >\r\n        Export images\r\n      </Button>\r\n\r\n      {/* DIALOG WINDOW */}\r\n      <Dialog open={open} onClose={handleClose}>\r\n        <DialogTitle>{'Saving options'}</DialogTitle>\r\n        <DialogContent>\r\n          <DialogContentText>\r\n            <Typography sx={{ color: 'black' }}>\r\n              Check the box in order to include the correspondent element in the\r\n              exported images:\r\n            </Typography>\r\n\r\n            {/* CHECKS */}\r\n            <Box sx={{ marginLeft: 2, marginTop: 1 }}>\r\n              <FormGroup sx={{ color: 'black' }}>\r\n                <FormControlLabel\r\n                  control={\r\n                    <Checkbox\r\n                      size='small'\r\n                      checked={checkNumb}\r\n                      onChange={() => {\r\n                        setCheckNumb(!checkNumb);\r\n                      }}\r\n                    />\r\n                  }\r\n                  label='Coefficients numbers'\r\n                />\r\n                <FormControlLabel\r\n                  control={\r\n                    <Checkbox\r\n                      size='small'\r\n                      checked={checkTrace}\r\n                      onChange={() => {\r\n                        setCheckTrace(!checkTrace);\r\n                      }}\r\n                    />\r\n                  }\r\n                  label='Full trace'\r\n                />\r\n                <FormControlLabel\r\n                  control={\r\n                    <Checkbox\r\n                      size='small'\r\n                      checked={checkProto}\r\n                      onChange={() => {\r\n                        setCheckProto(!checkProto);\r\n                      }}\r\n                    />\r\n                  }\r\n                  label='Prototypes'\r\n                />\r\n                <FormControlLabel\r\n                  control={\r\n                    <Checkbox\r\n                      size='small'\r\n                      checked={checkPcvs}\r\n                      onChange={() => {\r\n                        setCheckPcvs(!checkPcvs);\r\n                      }}\r\n                    />\r\n                  }\r\n                  label='Custom pitch-class vectors'\r\n                />\r\n              </FormGroup>\r\n            </Box>\r\n          </DialogContentText>\r\n        </DialogContent>\r\n        <DialogActions>\r\n          <Button onClick={handleClose}>Close</Button>\r\n          <Button onClick={handleClickPopover} autoFocus>\r\n            Save\r\n          </Button>\r\n\r\n          {/* POPOVER */}\r\n          <Popover\r\n            id={id}\r\n            open={openPopover}\r\n            anchorEl={anchorEl}\r\n            onClose={handleClosePopover}\r\n            anchorOrigin={{\r\n              vertical: 'center',\r\n              horizontal: 'left',\r\n            }}\r\n          >\r\n            <Typography color='error' sx={{ p: 2 }}>\r\n              Upload a MIDI file\r\n            </Typography>\r\n          </Popover>\r\n        </DialogActions>\r\n      </Dialog>\r\n    </>\r\n  );\r\n}\r\n\r\nexport default SaveDialog;\r\n","export default \"data:image/png;base64,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\"","//React\r\nimport React from 'react';\r\n\r\n//Import images\r\nimport logo from './logos/placeholder.png';\r\n\r\n//Import material UI components\r\nimport Stack from '@mui/material/Stack';\r\nimport Box from '@mui/material/Box';\r\nimport Typography from '@mui/material/Typography';\r\nimport Link from '@mui/material/Link';\r\n\r\n//Footer component\r\nfunction Footer() {\r\n  let logoSize = 100;\r\n  return (\r\n    <Box sx={{ marginTop: 1, textAlign: 'center' }}>\r\n      {/* LOGOS */}\r\n      <Stack sx={{ justifyContent: 'center' }} direction='row'>\r\n        <img width={logoSize} height={logoSize} src={logo} />\r\n        <img width={logoSize} height={logoSize} src={logo} />\r\n        <img width={logoSize} height={logoSize} src={logo} />\r\n      </Stack>\r\n\r\n      {/* TEXT */}\r\n      <Typography>\r\n        Project Enabling interactive music visualization for a wider community\r\n      </Typography>\r\n\r\n      {/* PEOPLE */}\r\n      <Stack sx={{ justifyContent: 'center' }} direction='row'>\r\n        <Typography sx={{ marginRight: 1 }}>\r\n          Project lead: Fabian C. Moss; Daniel Harasim\r\n        </Typography>\r\n        <span>{`\\u2013`}</span>\r\n        <Typography sx={{ marginLeft: 1 }}>\r\n          Developer: Giovanni Affatato\r\n        </Typography>\r\n      </Stack>\r\n\r\n      {/* LINKS */}\r\n      <Stack sx={{ justifyContent: 'center' }} direction='row'>\r\n        <Link sx={{ marginRight: 1 }} href='https://github.com/DCMLab/MIDFT'>\r\n          GitHub repo\r\n        </Link>\r\n        <span>{`\\u2022`}</span>\r\n        <Link\r\n          sx={{ marginLeft: 1, marginRight: 1 }}\r\n          href='https://www.epfl.ch/labs/dcml/'\r\n        >\r\n          DCML page\r\n        </Link>\r\n        <span>{`\\u2022`}</span>\r\n        <Typography sx={{ marginLeft: 1 }} href=''>\r\n          Copyright\r\n        </Typography>\r\n      </Stack>\r\n    </Box>\r\n  );\r\n}\r\n\r\nexport default Footer;\r\n","import * as React from 'react';\r\nimport ReactMarkdown from 'markdown-to-jsx';\r\nimport Typography from '@mui/material/Typography';\r\n/* import { Link } from 'react-router-dom'; */\r\nimport Link from '@mui/material/Link';\r\nimport Box from '@mui/material/Box';\r\n\r\nfunction MarkdownListItem(props) {\r\n  return <Box component='li' sx={{ mt: 1, typography: 'body1' }} {...props} />;\r\n}\r\n\r\nfunction LinkReference({ to, ...props }) {\r\n  const myRef = React.useRef(null);\r\n\r\n  //Check for reference links, prevent default to not reload the page\r\n  //and scrollIntoView to focus on the footer when clicked\r\n  if (!isNaN(parseInt(props.href[1]))) {\r\n    return (\r\n      <Link\r\n        ref={myRef}\r\n        onClick={(event) => {\r\n          event.preventDefault();\r\n          myRef.current.scrollIntoView({\r\n            behavior: 'smooth',\r\n          });\r\n        }}\r\n        {...props}\r\n        id={`reference${props.href[1]}`}\r\n        href={`/#${props.href[1]}`}\r\n      />\r\n    );\r\n  } else return <Link {...props} />; //Else it is a normal external link\r\n}\r\n\r\nconst options = {\r\n  overrides: {\r\n    h1: {\r\n      component: Typography,\r\n      props: {\r\n        gutterBottom: true,\r\n        variant: 'h4',\r\n        component: 'h1',\r\n      },\r\n    },\r\n    h2: {\r\n      component: Typography,\r\n      props: { gutterBottom: true, variant: 'h6', component: 'h2' },\r\n    },\r\n    h3: {\r\n      component: Typography,\r\n      props: { gutterBottom: true, variant: 'subtitle1' },\r\n    },\r\n    h4: {\r\n      component: Typography,\r\n      props: {\r\n        gutterBottom: true,\r\n        variant: 'caption',\r\n        paragraph: true,\r\n      },\r\n    },\r\n    p: {\r\n      component: Typography,\r\n      props: { paragraph: true },\r\n    },\r\n    a: {\r\n      component: LinkReference,\r\n    },\r\n    li: {\r\n      component: MarkdownListItem,\r\n    },\r\n  },\r\n};\r\n\r\nexport default function Markdown(props) {\r\n  return <ReactMarkdown options={options} {...props} />;\r\n}\r\n","export default __webpack_public_path__ + \"static/media/HomeMarkdown.4682608b.md\";","//React\r\nimport { useEffect, useState } from 'react';\r\n\r\n//Import material UI components\r\nimport Paper from '@mui/material/Paper';\r\nimport Box from '@mui/material/Box';\r\nimport Footer from '../Footer';\r\n\r\n//Markdown tests\r\nimport Markdown from '../Markdown';\r\nimport HomeMarkdown from '../HomeMarkdown.md';\r\n/* import Markdown from '../Markdown'; */\r\n\r\n//Home component\r\nexport default function Home({ setOpen, setInAnalysisPage }) {\r\n  const [content, setContent] = useState(``);\r\n\r\n  useEffect(() => {\r\n    setInAnalysisPage(false);\r\n    setOpen(false);\r\n\r\n    //Fetch the text of the markdown file as a string\r\n    fetch(HomeMarkdown)\r\n      .then((response) => response.text())\r\n      .then((text) => {\r\n        setContent(text);\r\n      });\r\n  }, []);\r\n\r\n  return (\r\n    <>\r\n      <Paper sx={{ margin: 'auto', maxWidth: '1200px' }}>\r\n        <Box sx={{ padding: 3 }}>\r\n          <Markdown>{content}</Markdown>\r\n        </Box>\r\n      </Paper>\r\n      <Footer />\r\n    </>\r\n  );\r\n}\r\n","export default __webpack_public_path__ + \"static/media/TheoryMarkdown.26c0a4ee.md\";","//React\r\nimport { useEffect, useState } from 'react';\r\n\r\n//Import material UI components\r\nimport Paper from '@mui/material/Paper';\r\nimport Box from '@mui/material/Box';\r\nimport Footer from '../Footer';\r\n\r\n//Markdown tests\r\nimport TheoryMarkdown from '../TheoryMarkdown.md';\r\nimport Markdown from '../Markdown';\r\nimport Tex from '@matejmazur/react-katex';\r\nimport 'katex/dist/katex.min.css';\r\n\r\nconst testContent = `\r\nGiven a **formula** below\r\n$$\r\ns = ut + \\\\frac{1}{2}at^{2}\r\n$$\r\nCalculate the value of $s$ when $u = 10\\\\frac{m}{s}$ and $a = 2\\\\frac{m}{s^{2}}$ at $t = 1s$\r\n`;\r\n\r\nconst testRemark = `**Below me will be displayed as a block:**\r\n$$ \r\nBlock Math \r\n$$\r\n**Next to me will be displayed as inline ->** $Inline Math$`;\r\n\r\nexport default function Theory({ setOpen, setInAnalysisPage }) {\r\n  const [content, setContent] = useState(``);\r\n\r\n  useEffect(() => {\r\n    setInAnalysisPage(false);\r\n    setOpen(false);\r\n\r\n    //Fetch the text of the markdown file as a string\r\n    fetch(TheoryMarkdown)\r\n      .then((response) => response.text())\r\n      .then((text) => {\r\n        setContent(text);\r\n      });\r\n  }, []);\r\n\r\n  return (\r\n    <>\r\n      <Paper sx={{ margin: 'auto', maxWidth: '1200px' }}>\r\n        <Box sx={{ padding: 3 }}>\r\n          <Markdown>{content}</Markdown>\r\n          <Markdown>{`TEST Given a **formula** below`}</Markdown>\r\n          <Tex math='s = ut + \\frac{1}{2}at^{2}' block />\r\n          <Markdown>{`TEST Given this **inline formula** `}</Markdown>\r\n          <Tex math=' s = ut + \\frac{1}{2}at^{2}' />\r\n          <Markdown>{` I can continue writing on the same line`}</Markdown>\r\n        </Box>\r\n      </Paper>\r\n      <Footer />\r\n    </>\r\n  );\r\n}\r\n","import { useRef, useEffect, useState } from 'react';\r\n\r\nconst verticalScale = Math.sin(Math.PI / 3);\r\n\r\nexport const Wavescape = ({\r\n  wsNumber,\r\n  wavescapeMatrix,\r\n  currentWavescapeSubdiv,\r\n  wavescapeWidth,\r\n}) => {\r\n  const canvasRef = useRef(null);\r\n  const [wsCoordinates, setWsCoordinates] = useState([]);\r\n  const margin = 10;\r\n  let width = wavescapeWidth - margin;\r\n  let height = wavescapeWidth;\r\n  let ticks;\r\n  const [ticksHeight, setTicksHeight] = useState(3);\r\n\r\n  useEffect(() => {\r\n    width = wavescapeWidth;\r\n    height = wavescapeWidth;\r\n    ticksHeight < 1\r\n      ? setTicksHeight(1)\r\n      : setTicksHeight(Math.floor(0.01 * wavescapeWidth));\r\n  }, [wavescapeWidth]);\r\n\r\n  useEffect(() => {\r\n    const canvas = canvasRef.current;\r\n    const ctx = canvas.getContext('2d');\r\n\r\n    // increase the actual size of our canvas\r\n    //canvas.width = width * devicePixelRatio;\r\n    //canvas.height = height * devicePixelRatio;\r\n\r\n    // ensure all drawing operations are scaled\r\n    //ctx.scale(devicePixelRatio, devicePixelRatio);\r\n\r\n    // scale everything down using CSS\r\n    //canvas.style.width = width + 'px';\r\n    //canvas.style.height = height + 'px';\r\n\r\n    let margins = [margin, margin];\r\n    let innerSize = [canvas.width - margins[0], canvas.height - margins[1]];\r\n    let baseSubdivision;\r\n\r\n    if (wavescapeMatrix) {\r\n      baseSubdivision = wavescapeMatrix[0].length;\r\n      ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);\r\n      //ctx.setTransform(1, 0, 0, -1, 0, ctx.canvas.height);\r\n      ticks = computeTicks(\r\n        innerSize[0],\r\n        innerSize[1],\r\n        baseSubdivision,\r\n        margins[0],\r\n        margins[1]\r\n      );\r\n\r\n      setWsCoordinates(ticks);\r\n\r\n      //Vertical scaling to make the triangle equilateral\r\n      //ctx.scale(1, verticalScale);\r\n      drawWavescape(ticks, ctx, wavescapeMatrix);\r\n    }\r\n  }, [wavescapeMatrix, width, height]);\r\n\r\n  return (\r\n    <svg\r\n      id={`wavescape${wsNumber}`}\r\n      width={width + margin}\r\n      height={height}\r\n      xmlns='http://www.w3.org/2000/svg'\r\n    >\r\n      <g transform={`translate(${width * 0.06},${width * 0.1})`}>\r\n        <circle cx='5%' cy='1%' r={`${(width / 100) * 2.8}px`} fill='black' />\r\n        <text\r\n          fontSize={`${(width / 100) * 5.2}px`}\r\n          textAnchor='middle'\r\n          x='5%'\r\n          y='2.8%'\r\n          fill='white'\r\n        >\r\n          {wsNumber}\r\n        </text>\r\n      </g>\r\n      <g\r\n        transform={`scale(${1}, ${-verticalScale}) translate(${0},${-height})`}\r\n      >\r\n        <foreignObject x={0} y={0} width={width} height={height}>\r\n          <canvas width={width} height={height} ref={canvasRef}></canvas>\r\n        </foreignObject>\r\n\r\n        {/* //Line ticks */}\r\n        {wsCoordinates.length > 0\r\n          ? wsCoordinates[0].map((coord, i) => (\r\n              <line\r\n                key={`tick${i}`}\r\n                x1={coord.x}\r\n                x2={coord.x}\r\n                y1={coord.y - ticksHeight}\r\n                y2={coord.y + ticksHeight}\r\n                stroke='grey'\r\n                strokeWidth='1px'\r\n              />\r\n            ))\r\n          : null}\r\n        {/* Contour line */}\r\n        {wsCoordinates.length > 0 && wsCoordinates[0].length > 0 ? (\r\n          <>\r\n            <line\r\n              x1={wsCoordinates[0][0].x}\r\n              x2={wsCoordinates[0][wsCoordinates[0].length - 1].x}\r\n              y1={wsCoordinates[0][0].y}\r\n              y2={wsCoordinates[0][wsCoordinates[0].length - 1].y}\r\n              stroke='grey'\r\n              strokeWidth='2px'\r\n            />\r\n            <line\r\n              x1={wsCoordinates[0][wsCoordinates[0].length - 1].x}\r\n              x2={wsCoordinates[wsCoordinates.length - 1][0].x}\r\n              y1={wsCoordinates[0][wsCoordinates[0].length - 1].y}\r\n              y2={wsCoordinates[wsCoordinates.length - 1][0].y}\r\n              stroke='grey'\r\n              strokeWidth='1px'\r\n            />\r\n            <line\r\n              x1={wsCoordinates[0][0].x}\r\n              x2={wsCoordinates[wsCoordinates.length - 1][0].x}\r\n              y1={wsCoordinates[0][0].y}\r\n              y2={wsCoordinates[wsCoordinates.length - 1][0].y}\r\n              stroke='grey'\r\n              strokeWidth='1px'\r\n            />\r\n            <circle\r\n              cx={\r\n                (wsCoordinates[0][currentWavescapeSubdiv].x +\r\n                  wsCoordinates[0][currentWavescapeSubdiv + 1].x) /\r\n                2\r\n              }\r\n              cy={\r\n                (wsCoordinates[0][currentWavescapeSubdiv].y +\r\n                  wsCoordinates[0][currentWavescapeSubdiv + 1].y) /\r\n                2\r\n              }\r\n              r={0.01 * width}\r\n              fill='white'\r\n            />\r\n            <circle\r\n              cx={\r\n                (wsCoordinates[0][currentWavescapeSubdiv].x +\r\n                  wsCoordinates[0][currentWavescapeSubdiv + 1].x) /\r\n                2\r\n              }\r\n              cy={\r\n                (wsCoordinates[0][currentWavescapeSubdiv].y +\r\n                  wsCoordinates[0][currentWavescapeSubdiv + 1].y) /\r\n                2\r\n              }\r\n              r={0.01 * width}\r\n              stroke='black'\r\n              strokeWidth={1}\r\n              fill='transparent'\r\n            />\r\n          </>\r\n        ) : null}\r\n      </g>\r\n    </svg>\r\n  );\r\n};\r\n\r\nfunction computeTicks(\r\n  innerWidth,\r\n  innerHeight,\r\n  baseSubdivision,\r\n  marginLeft,\r\n  marginTop\r\n) {\r\n  //Actually, it is a square matrix\r\n  let unit = innerWidth / baseSubdivision;\r\n  let mat = [];\r\n\r\n  for (let i = 0; i < baseSubdivision + 1; i++) {\r\n    let temp = [];\r\n    for (let j = 0; j < baseSubdivision + 1; j++) {\r\n      if (i <= j)\r\n        temp.push({\r\n          x: (j - i) * unit + (i * unit) / 2 + marginLeft,\r\n          y: i * unit + marginTop,\r\n        });\r\n    }\r\n    mat.push(temp);\r\n  }\r\n\r\n  return mat;\r\n}\r\n\r\nfunction drawWavescape(ticks, ctx, wavescapeMatrix) {\r\n  for (let i = 0; i < ticks.length - 1; i++) {\r\n    for (let j = 0; j < ticks[i].length - 1; j++) {\r\n      if (i === 0) {\r\n        //first row composed by triangles\r\n        ctx.beginPath();\r\n        ctx.moveTo(ticks[i][j].x, ticks[i][j].y);\r\n        ctx.lineTo(ticks[i][j + 1].x, ticks[i][j + 1].y);\r\n        ctx.lineTo(ticks[i + 1][j].x, ticks[i + 1][j].y);\r\n        ctx.fillStyle = wavescapeMatrix[i][j];\r\n        ctx.fill();\r\n      } else {\r\n        //other rows composed by diamonds\r\n        ctx.beginPath();\r\n        ctx.moveTo(ticks[i][j].x, ticks[i][j].y);\r\n        ctx.lineTo(ticks[i - 1][j + 1].x, ticks[i - 1][j + 1].y);\r\n        ctx.lineTo(ticks[i][j + 1].x, ticks[i][j + 1].y);\r\n        ctx.lineTo(ticks[i + 1][j].x, ticks[i + 1][j].y);\r\n        ctx.fillStyle = wavescapeMatrix[i][j];\r\n        ctx.fill();\r\n      }\r\n    }\r\n  }\r\n}\r\n","//Import components\r\nimport { Wavescape } from './Wavescape';\r\n\r\n//Import material UI components\r\nimport Box from '@mui/material/Box';\r\nimport { Typography } from '@mui/material';\r\n\r\n//Wavescape module component\r\nfunction WavescapeModule({\r\n  wavescapesData,\r\n  currentWavescapeSubdiv,\r\n  elemsWidth,\r\n}) {\r\n  return (\r\n    <Box\r\n      sx={{\r\n        display: 'flex',\r\n        flexWrap: 'wrap',\r\n        justifyContent: 'space-around',\r\n      }}\r\n    >\r\n      {/* If wavescapes' data is present plot the wavescapes, else \r\n      notify the user to upload a MIDI file */}\r\n      {wavescapesData.length > 0 ? (\r\n        wavescapesData.map((data, i) => (\r\n          <Wavescape\r\n            wsNumber={i + 1}\r\n            key={`w.${i}`}\r\n            wavescapeMatrix={data}\r\n            currentWavescapeSubdiv={currentWavescapeSubdiv}\r\n            wavescapeWidth={elemsWidth}\r\n          />\r\n        ))\r\n      ) : (\r\n        <Typography color='error'>No midi file uploaded</Typography>\r\n      )}\r\n    </Box>\r\n  );\r\n}\r\n\r\nexport default WavescapeModule;\r\n","//React and D3\r\nimport * as d3 from 'd3';\r\nimport { useRef, useEffect, useState } from 'react';\r\n\r\n//Import functions\r\nimport { pixelColor } from './colorMapping';\r\n\r\n//Import material UI components\r\nimport Tooltip from '@mui/material/Tooltip';\r\nimport Typography from '@mui/material/Typography';\r\nimport Stack from '@mui/material/Stack';\r\nimport Box from '@mui/material/Box';\r\n\r\nlet savedImage = null;\r\n\r\n//REMINDER\r\n//Minus before every y coordinate due to the fact that images have\r\n//positive y downward, meanwhile cartesian plane has positive y upward.\r\n\r\n//Circle component\r\nfunction Circle({\r\n  coeffNumber,\r\n  protoDataCoeff,\r\n  fullTrace,\r\n  traceDataCoeff,\r\n  userPcvsCoeff,\r\n  currentSubdiv,\r\n  performanceCoeff,\r\n  targetCircleWidth,\r\n  showMagAndPhase,\r\n  showFullTrace,\r\n}) {\r\n  //Color wheel canvas\r\n  const canvasRef = useRef(null);\r\n\r\n  //Displayed magnitude and phase\r\n  const [currentSubdivCoeff, setCurrentSubdivCoeff] = useState({\r\n    mu: 0,\r\n    phi: 0,\r\n  });\r\n\r\n  //Image parameters\r\n  let width = 445;\r\n  let height = width;\r\n  const margin = 45;\r\n  const headerOffset = 15;\r\n  const circleRadius = width / 2 - margin;\r\n\r\n  //Relative size of icons in the image\r\n  let marksRadiusRatio = 0.01;\r\n\r\n  //Image rendering\r\n  useEffect(() => {\r\n    const canvas = canvasRef.current;\r\n    const ctx = canvas.getContext('2d');\r\n    let radius = Math.floor(circleRadius * devicePixelRatio);\r\n    let image = ctx.createImageData(2 * radius, 2 * radius);\r\n    let data = image.data;\r\n\r\n    //Increase the actual size of our canvas\r\n    canvas.width = width * devicePixelRatio;\r\n    canvas.height = height * devicePixelRatio;\r\n\r\n    //Ensure all drawing operations are scaled\r\n    ctx.scale(devicePixelRatio, devicePixelRatio);\r\n\r\n    //Scale everything down using CSS\r\n    canvas.style.width = width + 'px';\r\n    canvas.style.height = height + 'px';\r\n\r\n    //Render the color wheel only at page initialization,\r\n    //skip if already initialized\r\n    if (!savedImage) {\r\n      for (let x = -radius; x < radius; x++) {\r\n        for (let y = -radius; y < radius; y++) {\r\n          let distance = Math.sqrt(x * x + y * y);\r\n\r\n          if (distance > radius) {\r\n            // skip all (x,y) coordinates that are outside of the circle\r\n            continue;\r\n          }\r\n          // Figure out the starting index of this pixel in the image data array.\r\n          let rowLength = 2 * radius;\r\n          let adjustedX = x + radius; // convert x from [-50, 50] to [0, 100] (the coordinates of the image data array)\r\n          let adjustedY = y + radius; // convert y from [-50, 50] to [0, 100] (the coordinates of the image data array)\r\n          let pixelWidth = 4; // each pixel requires 4 slots in the data array\r\n          let index = (adjustedX + adjustedY * rowLength) * pixelWidth;\r\n          let rgba = pixelColor(x, y, distance / radius);\r\n          data[index] = rgba.r;\r\n          data[index + 1] = rgba.g;\r\n          data[index + 2] = rgba.b;\r\n          data[index + 3] = rgba.a;\r\n        }\r\n      }\r\n      savedImage = image;\r\n    }\r\n    ctx.putImageData(savedImage, 0, 0);\r\n\r\n    //Render the trace\r\n    if (showFullTrace && traceDataCoeff) {\r\n      ctx.save();\r\n      ctx.translate((400 - margin) / 2, (400 - margin) / 2);\r\n      drawTrace();\r\n      ctx.restore();\r\n    }\r\n  }, [width, height, circleRadius, traceDataCoeff, showFullTrace]);\r\n\r\n  //Change displayed magnitude and phase when current subdivision changes\r\n  useEffect(() => {\r\n    if (traceDataCoeff && traceDataCoeff[currentSubdiv]) {\r\n      //Rounding to second decimal and converting to polar coordinate\r\n      let x = traceDataCoeff[currentSubdiv].x;\r\n      let y = traceDataCoeff[currentSubdiv].y;\r\n\r\n      setCurrentSubdivCoeff(cartesianToPolar(x, y));\r\n    }\r\n  }, [currentSubdiv, traceDataCoeff]);\r\n\r\n  //Workaround for chrome bug on canvas overlay in foreignObj SVG\r\n  useEffect(() => {\r\n    canvasRef.current.getContext('2d').getImageData(0, 0, 1, 1);\r\n  }, []);\r\n\r\n  //Re-render trace when trace data changes (a new file is uploaded)\r\n  useEffect(() => {\r\n    if (traceDataCoeff) {\r\n      const canvas = canvasRef.current;\r\n      const ctx = canvas.getContext('2d');\r\n      ctx.save();\r\n      ctx.translate((400 - margin) / 2, (400 - margin) / 2);\r\n      drawTrace();\r\n      ctx.restore();\r\n    }\r\n  }, [fullTrace]);\r\n\r\n  //Change of coordinates\r\n  function cartesianToPolar(x, y, norm = false) {\r\n    let phi = (Math.atan2(y, x) * 180) / Math.PI;\r\n    let mu = Math.sqrt(x * x + y * y);\r\n\r\n    if (norm) mu = mu / circleRadius;\r\n\r\n    phi = Math.round(phi + Number.EPSILON);\r\n    mu = Math.round((mu + Number.EPSILON) * 100) / 100;\r\n\r\n    return { mu, phi };\r\n  }\r\n\r\n  //Render the trace in Fourier space\r\n  function drawTrace() {\r\n    const canvas = canvasRef.current;\r\n    const ctx = canvas.getContext('2d');\r\n\r\n    ctx.fillStyle = 'rgba(0, 0, 0, 0.1)';\r\n\r\n    //traceDataCoeff to visualze the windowed version, fullTrace otherwise\r\n    traceDataCoeff.forEach((element) => {\r\n      ctx.beginPath();\r\n      ctx.arc(\r\n        element.x * circleRadius,\r\n        -element.y * circleRadius,\r\n        (marksRadiusRatio * width) / 2,\r\n        0,\r\n        Math.PI * 2,\r\n        true\r\n      );\r\n      ctx.fill();\r\n    });\r\n  }\r\n\r\n  //Render cross icon for the points generated by the MIDI devices\r\n  const crossMark = (pcvData, radiusScaleWidth) => {\r\n    return (\r\n      <g\r\n        transform={`translate(${pcvData.x * circleRadius},${\r\n          -pcvData.y * circleRadius\r\n        })`}\r\n      >\r\n        <line\r\n          x1='0'\r\n          x2='0'\r\n          y1='7'\r\n          y2='-7'\r\n          stroke='black'\r\n          strokeWidth='1.5'\r\n        ></line>\r\n        <line\r\n          x1='7'\r\n          x2='-7'\r\n          y1='0'\r\n          y2='0'\r\n          stroke='black'\r\n          strokeWidth='1.5'\r\n        ></line>\r\n      </g>\r\n    );\r\n  };\r\n\r\n  //Render the rose icon for the PCVs insterd by the user\r\n  function svgRoseIcon(label, rosePoints, translateX, translateY, scale, i) {\r\n    let polarCoord = cartesianToPolar(translateX, translateY, true);\r\n    let widthSvg = 40;\r\n    return (\r\n      <Tooltip\r\n        key={`rtt.${i}`}\r\n        placement='top'\r\n        arrow\r\n        title={\r\n          <Stack\r\n            direction='row'\r\n            justifyContent='center'\r\n            alignItems='center'\r\n            spacing={2}\r\n          >\r\n            <svg\r\n              width={widthSvg}\r\n              height={widthSvg}\r\n              viewBox={`0 0 ${widthSvg} ${widthSvg}`}\r\n            >\r\n              <circle\r\n                cx={widthSvg / 2}\r\n                cy={widthSvg / 2}\r\n                r={widthSvg / 2}\r\n                strokeWidth='1'\r\n                fill='#FFF'\r\n                fillOpacity={1}\r\n              ></circle>\r\n\r\n              <polyline\r\n                transform={`translate(${widthSvg / 2},${\r\n                  widthSvg / 2\r\n                }) scale(${1.8})`}\r\n                fill='none'\r\n                stroke='black'\r\n                strokeWidth='1px'\r\n                points={rosePoints}\r\n              />\r\n            </svg>\r\n            <Stack>\r\n              <Typography>{label}</Typography>\r\n              <Typography>{`\\u{3BC}: ${\r\n                polarCoord.mu\r\n              } \\u{3C6}: ${-polarCoord.phi}\\u{b0}`}</Typography>\r\n            </Stack>\r\n          </Stack>\r\n        }\r\n      >\r\n        <g>\r\n          <polyline\r\n            transform={`translate(${translateX},${translateY}) scale(${scale})`}\r\n            fill='none'\r\n            stroke='black'\r\n            strokeWidth='1px'\r\n            fill='#FFF'\r\n            fillOpacity={0}\r\n            points={rosePoints}\r\n          />\r\n\r\n          <polyline\r\n            transform={`translate(${translateX},${translateY}) scale(${scale})`}\r\n            fill='none'\r\n            stroke='black'\r\n            strokeWidth='1px'\r\n            points={rosePoints}\r\n          />\r\n        </g>\r\n      </Tooltip>\r\n    );\r\n  }\r\n\r\n  //Render icon of the prototypes\r\n  const protoCircleMark = (pcvData, id) => {\r\n    let scaleRatio = 0.02;\r\n    const mark = d3\r\n      .arc()\r\n      .innerRadius((scaleRatio * width) / 2)\r\n      .outerRadius(((scaleRatio + 0.01) * width) / 2)\r\n      .startAngle(0)\r\n      .endAngle(2 * Math.PI);\r\n\r\n    //Check for sub/superscript\r\n    let labelName = '';\r\n    let subSup = '';\r\n    let isSub = false;\r\n    if (pcvData.label.includes('_') || pcvData.label.includes('^')) {\r\n      for (let i = 0; i < pcvData.label.length; i++) {\r\n        if (pcvData.label[i] === '_') {\r\n          labelName = pcvData.label.slice(0, i);\r\n          subSup = pcvData.label.slice(i + 1, pcvData.label.length);\r\n          isSub = true;\r\n        }\r\n        if (pcvData.label[i] === '^') {\r\n          labelName = pcvData.label.slice(0, i);\r\n          subSup = pcvData.label.slice(i + 1, pcvData.label.length);\r\n        }\r\n      }\r\n    } else {\r\n      labelName = pcvData.label;\r\n    }\r\n\r\n    //Computation of label offset\r\n    //Good for most of the labels\r\n    let dxOffset = Math.sign(pcvData.x) * 18,\r\n      dyOffset = -Math.sign(pcvData.y) * 18 + 7;\r\n\r\n    //Custom rules for labels\r\n    if (labelName === '') dyOffset -= 3;\r\n    if (labelName === 'WT' && subSup === '1') dxOffset *= 1.2;\r\n    if (labelName === 'WT' && subSup === '0') dxOffset *= 1.4;\r\n    if (labelName === 'C' && subSup === 'o7') dxOffset *= 1.2;\r\n    if (labelName === 'O' && subSup === '1,2') dyOffset *= 1.1;\r\n    if (labelName === 'C' && subSup === 'o7') {\r\n      dxOffset *= 1.1;\r\n      dyOffset *= 1.1;\r\n    }\r\n    if (labelName === 'D' && subSup === 'o7') {\r\n      dxOffset *= 0.7;\r\n      dyOffset *= 0.7;\r\n    }\r\n    if (labelName === 'H' && subSup === '2,3') {\r\n      dxOffset *= 1.2;\r\n      dyOffset *= 1.2;\r\n    }\r\n    if (labelName === 'H' && subSup === '1,2') {\r\n      dxOffset *= 0.7;\r\n      dyOffset *= 0.7;\r\n    }\r\n    if (labelName === '') {\r\n      dxOffset = 15;\r\n      dyOffset = 5;\r\n    }\r\n\r\n    return (\r\n      <g\r\n        transform={`translate(${pcvData.x * circleRadius},${\r\n          -pcvData.y * circleRadius\r\n        })`}\r\n        key={`p.${id}`}\r\n      >\r\n        <path fill={'grey'} key={id} d={mark()}></path>\r\n        <text textAnchor='middle' dx={dxOffset} dy={dyOffset} fontSize='20px'>\r\n          {labelName}\r\n          {isSub ? (\r\n            <tspan fontSize={15} baselineShift='sub'>\r\n              {subSup}\r\n            </tspan>\r\n          ) : (\r\n            <tspan fontSize={15} baselineShift='super'>\r\n              {subSup}\r\n            </tspan>\r\n          )}\r\n        </text>\r\n      </g>\r\n    );\r\n  };\r\n\r\n  //Render border of the circle (used to smooth the color wheel canvas)\r\n  const drawBorder = () => {\r\n    return (\r\n      <path\r\n        fill={'azure'}\r\n        d={d3\r\n          .arc()\r\n          .innerRadius(circleRadius - 1)\r\n          .outerRadius(circleRadius + 3)\r\n          .startAngle(0)\r\n          .endAngle(2 * Math.PI)()}\r\n      ></path>\r\n    );\r\n  };\r\n\r\n  //Plot circles related to the MIDI playback (N points before the current subdiv)\r\n  const highlightSubdiv = (radiusScaleWidth) => {\r\n    const mark = d3\r\n      .arc()\r\n      .innerRadius(0)\r\n      .outerRadius((radiusScaleWidth * width) / 2)\r\n      .startAngle(0)\r\n      .endAngle(2 * Math.PI);\r\n\r\n    const highlight = d3\r\n      .arc()\r\n      .innerRadius((radiusScaleWidth * width) / 2)\r\n      .outerRadius(((radiusScaleWidth + 0.005) * width) / 2)\r\n      .startAngle(0)\r\n      .endAngle(2 * Math.PI);\r\n\r\n    let highlightedTrace = [];\r\n    let length = 7;\r\n    let opacityArray = [];\r\n\r\n    opacityArray.push(1);\r\n    opacityArray.push(0.5);\r\n    for (let i = 2; i < length; i++) {\r\n      opacityArray.push(\r\n        Math.round((opacityArray[i - 1] - 0.5 / (length - 2)) * 100) / 100\r\n      );\r\n    }\r\n\r\n    if (currentSubdiv < length)\r\n      highlightedTrace = traceDataCoeff.slice(0, currentSubdiv + 1);\r\n    else\r\n      highlightedTrace = traceDataCoeff.slice(\r\n        currentSubdiv - length + 1,\r\n        currentSubdiv + 1\r\n      );\r\n\r\n    highlightedTrace = highlightedTrace.reverse();\r\n\r\n    return highlightedTrace.map((coeff, i) => {\r\n      return (\r\n        <g key={`g.${i}`}>\r\n          <path\r\n            transform={`translate(${coeff.x * circleRadius},${\r\n              -coeff.y * circleRadius\r\n            })`}\r\n            fill={'white'}\r\n            key={i}\r\n            fillOpacity={opacityArray[i]}\r\n            d={mark()}\r\n          ></path>\r\n          <path\r\n            transform={`translate(${coeff.x * circleRadius},${\r\n              -coeff.y * circleRadius\r\n            })`}\r\n            fill={'black'}\r\n            fillOpacity={opacityArray[i]}\r\n            key={`t.${i}`}\r\n            d={highlight()}\r\n          ></path>\r\n        </g>\r\n      );\r\n    });\r\n  };\r\n\r\n  return (\r\n    <Box sx={{ marginBottom: 2 }}>\r\n      <svg\r\n        width={targetCircleWidth}\r\n        height={targetCircleWidth}\r\n        viewBox={`0 0 ${width} ${height}`}\r\n        xmlns='http://www.w3.org/2000/svg'\r\n      >\r\n        {/* COEFFICIENT NUMBER */}\r\n        <g transform={`translate(32,8)`}>\r\n          <circle cx='12' cy='12' r='13' fill='black' />\r\n          <text fontSize='24' textAnchor='middle' x='12' y='20' fill='white'>\r\n            {coeffNumber}\r\n          </text>\r\n        </g>\r\n\r\n        {/* MAGNITUDE AND PHASE */}\r\n        <g transform={`translate(${125},0)`}>\r\n          {showMagAndPhase ? (\r\n            <>\r\n              <text\r\n                x='120'\r\n                y='23'\r\n                style={{ fontSize: '24px' }}\r\n              >{`\\u{3C6}: ${currentSubdivCoeff.phi}\\u{b0}`}</text>\r\n              <text\r\n                x='34'\r\n                y='24'\r\n                style={{ fontSize: '24px' }}\r\n              >{`\\u{3BC}: ${currentSubdivCoeff.mu}`}</text>\r\n            </>\r\n          ) : null}\r\n        </g>\r\n\r\n        {/* FOURIER SPACE */}\r\n        <g transform={`translate(0,${headerOffset})`}>\r\n          {/* COLOR WHEEL AND TRACE (canvas) */}\r\n          <foreignObject x={margin} y={margin} width={width} height={height}>\r\n            <canvas\r\n              id={`circle${coeffNumber}`}\r\n              style={{ zIndex: '-1' }}\r\n              width={width}\r\n              height={height}\r\n              ref={canvasRef}\r\n            ></canvas>\r\n          </foreignObject>\r\n\r\n          {/* POINTS AND BORDER */}\r\n          <g transform={`translate(${width / 2},${width / 2})`}>\r\n            {/* BORDER */}\r\n            {drawBorder()}\r\n            {protoDataCoeff\r\n              ? protoDataCoeff.map((pcv, i) => protoCircleMark(pcv, i))\r\n              : null}\r\n\r\n            {/* MIDI device coeff */}\r\n            {performanceCoeff.x === 0 && performanceCoeff.y === 0\r\n              ? null\r\n              : crossMark(performanceCoeff, marksRadiusRatio * 2, 'teal')}\r\n\r\n            {/* ROSES */}\r\n            {userPcvsCoeff\r\n              ? userPcvsCoeff.map((pcv, i) => {\r\n                  if (!pcv.isDisabled)\r\n                    return svgRoseIcon(\r\n                      pcv.label,\r\n                      pcv.rosePoints,\r\n                      pcv.x * circleRadius,\r\n                      -pcv.y * circleRadius,\r\n                      0.7,\r\n                      i\r\n                    );\r\n                })\r\n              : null}\r\n\r\n            {/* MIDI PLAYBACK */}\r\n            {traceDataCoeff ? highlightSubdiv(marksRadiusRatio) : null}\r\n          </g>\r\n        </g>\r\n      </svg>\r\n    </Box>\r\n  );\r\n}\r\n\r\nexport default Circle;\r\n","//React\r\nimport { useEffect, useState } from 'react';\r\n\r\n//Import components\r\nimport Circle from './Circle';\r\nimport { prototypesData } from './prototypesData';\r\n\r\n//Import material UI components\r\nimport Box from '@mui/material/Box';\r\n\r\n//Fourier spaces module component\r\nfunction CoefficientsModule({\r\n  fullTraces,\r\n  coeffTracesData,\r\n  showPrototypes,\r\n  showMagAndPhase,\r\n  userPcvs,\r\n  currentSubdiv,\r\n  midiDevNotesDftCoeffs,\r\n  elemsWidth,\r\n  showFullTrace,\r\n}) {\r\n  //State: array\r\n  //Array that contains all the prototypes if showPrototypes is true,\r\n  //empty array if false.\r\n  const [selectedProtoPitchClasses, setSelectedProtoPitchClasses] =\r\n    useState(prototypesData);\r\n\r\n  //State: array\r\n  //Array that contains points of the PCVs inserted by the user\r\n  //divided for each Fourier space (from 1st to 6th).\r\n  const [subdivUserPcvs, setSubdivUserPcvs] = useState([]);\r\n\r\n  //Effect: show/unshow prototypes when showPrototypes is toggled.\r\n  useEffect(() => {\r\n    if (showPrototypes) {\r\n      setSelectedProtoPitchClasses(prototypesData);\r\n    } else setSelectedProtoPitchClasses([]);\r\n  }, [showPrototypes]);\r\n\r\n  //Effect: when user add or remove PCVs, update subdivUserPcvs\r\n  //by subdividing for the coefficient number\r\n  useEffect(() => {\r\n    //Subdividing the coeffs for each Fourier space\r\n    let tempSubdivUserPcvs = [];\r\n    for (let i = 1; i < 7; i++) {\r\n      let temp = [];\r\n      for (let j = 0; j < userPcvs.length; j++) {\r\n        temp.push({\r\n          x: userPcvs[j].coeffs[i].re,\r\n          y: userPcvs[j].coeffs[i].im,\r\n          rosePoints: userPcvs[j].rosePoints,\r\n          isDisabled: userPcvs[j].isDisabled,\r\n          label: userPcvs[j].label,\r\n        });\r\n      }\r\n      tempSubdivUserPcvs.push(temp);\r\n    }\r\n\r\n    setSubdivUserPcvs(tempSubdivUserPcvs);\r\n  }, [userPcvs]);\r\n\r\n  return (\r\n    <Box\r\n      sx={{\r\n        display: 'flex',\r\n        flexWrap: 'wrap',\r\n        justifyContent: 'space-around',\r\n      }}\r\n    >\r\n      {/* PLOT THE SPACES FROM 1st TO 6th */}\r\n      {[1, 2, 3, 4, 5, 6].map((coeffNum) => (\r\n        <Circle\r\n          coeffNumber={coeffNum}\r\n          key={`w.${coeffNum}`}\r\n          protoDataCoeff={selectedProtoPitchClasses[coeffNum - 1]}\r\n          fullTrace={fullTraces[coeffNum - 1]}\r\n          traceDataCoeff={coeffTracesData[coeffNum - 1]}\r\n          userPcvsCoeff={subdivUserPcvs[coeffNum - 1]}\r\n          currentSubdiv={currentSubdiv}\r\n          performanceCoeff={midiDevNotesDftCoeffs[coeffNum]}\r\n          targetCircleWidth={elemsWidth}\r\n          showMagAndPhase={showMagAndPhase}\r\n          showFullTrace={showFullTrace}\r\n        />\r\n      ))}\r\n    </Box>\r\n  );\r\n}\r\n\r\nexport default CoefficientsModule;\r\n","//React\r\nimport { useState, useEffect, useRef } from 'react';\r\n\r\n//Import libraries\r\nimport * as Tone from 'tone';\r\n\r\n//Import componentss\r\nimport WavescapeModule from '../WavescapeModule';\r\nimport CoefficientsModule from '../CoefficientsModule';\r\n\r\nimport Player from '../Player';\r\n\r\nimport dft from '../DFT';\r\n\r\n//Import material UI components\r\nimport Box from '@mui/material/Box';\r\nimport FormGroup from '@mui/material/FormGroup';\r\nimport FormControlLabel from '@mui/material/FormControlLabel';\r\nimport Switch from '@mui/material/Switch';\r\nimport InputLabel from '@mui/material/InputLabel';\r\nimport MenuItem from '@mui/material/MenuItem';\r\nimport FormControl from '@mui/material/FormControl';\r\nimport Select from '@mui/material/Select';\r\nimport Slider from '@mui/material/Slider';\r\nimport { styled } from '@mui/material/styles';\r\nimport Typography from '@mui/material/Typography';\r\nimport Accordion from '@mui/material/Accordion';\r\nimport AccordionSummary from '@mui/material/AccordionSummary';\r\nimport AccordionDetails from '@mui/material/AccordionDetails';\r\nimport ExpandMoreIcon from '@mui/icons-material/ExpandMore';\r\nimport MuiAppBar from '@mui/material/AppBar';\r\nimport Toolbar from '@mui/material/Toolbar';\r\n\r\nconst drawerWidth = 400;\r\n\r\n//Appbar animation\r\nconst AppBar = styled(MuiAppBar, {\r\n  shouldForwardProp: (prop) => prop !== 'open',\r\n})(({ theme, open }) => ({\r\n  transition: theme.transitions.create(['margin', 'width'], {\r\n    easing: theme.transitions.easing.sharp,\r\n    duration: theme.transitions.duration.leavingScreen,\r\n  }),\r\n  ...(open && {\r\n    width: `calc(100% - ${drawerWidth}px)`,\r\n    marginLeft: `${drawerWidth}px`,\r\n    transition: theme.transitions.create(['margin', 'width'], {\r\n      easing: theme.transitions.easing.easeOut,\r\n      duration: theme.transitions.duration.enteringScreen,\r\n    }),\r\n  }),\r\n}));\r\n\r\n//\r\nfunction Analysis({\r\n  fileName,\r\n  setInAnalysisPage,\r\n  open,\r\n  setOpen,\r\n  wavescapesData,\r\n  fullTraces,\r\n  coeffTracesData,\r\n  currentSubdiv,\r\n  currentWavescapeSubdiv,\r\n  userPcvs,\r\n}) {\r\n  //State: represents the selected row on the wavescape (by default the first row) for each coeff\r\n  const [showPrototypes, setShowPrototypes] = useState(true);\r\n  const [showMagAndPhase, setShowMagAndPhase] = useState(true);\r\n  const [showFullTrace, setShowFullTrace] = useState(true);\r\n\r\n  //MIDI inputs\r\n  const [midiDevNotesDftCoeffs, setMidiDevNotesDftCoeffs] = useState(\r\n    dft([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]).map((coeff) => {\r\n      return { x: coeff.re, y: coeff.im };\r\n    })\r\n  );\r\n\r\n  //Ref to get the width of the accordion used to computed layout sizes\r\n  const accordionRef = useRef(null);\r\n  const [accordionWidth, setAccordionWidth] = useState(100);\r\n  const [elemsForEachRow, setElemsForEachRow] = useState(3);\r\n  const [elemsWidth, setElemsWidth] = useState(440);\r\n\r\n  function changeElementsSize(drawerOffset = 0) {\r\n    let adjustmentFractSizes = 10;\r\n    if (accordionRef.current) {\r\n      setElemsWidth(\r\n        (accordionRef.current.clientWidth + drawerOffset) / elemsForEachRow -\r\n          adjustmentFractSizes\r\n      );\r\n    }\r\n  }\r\n\r\n  function handleResize() {\r\n    let drawerOffset = 0;\r\n    changeElementsSize(drawerOffset);\r\n  }\r\n\r\n  useEffect(() => {\r\n    setInAnalysisPage(true);\r\n\r\n    //Open drawer when page loads\r\n    setOpen(true);\r\n\r\n    //Minus some pixel for robustness: sometimes width with fractional pixels\r\n    changeElementsSize();\r\n\r\n    window.addEventListener('resize', handleResize);\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    //When analysis data changes, show by default the full trace\r\n    setShowFullTrace(true);\r\n  }, [fullTraces]);\r\n\r\n  useEffect(() => {\r\n    changeElementsSize();\r\n    window.addEventListener('resize', handleResize);\r\n  }, [elemsForEachRow]);\r\n\r\n  useEffect(() => {\r\n    let drawerOffset = 0;\r\n    open ? (drawerOffset = -400) : (drawerOffset = +400);\r\n    changeElementsSize(drawerOffset);\r\n  }, [open]);\r\n\r\n  useEffect(() => {\r\n    changeElementsSize();\r\n  }, [accordionWidth]);\r\n\r\n  //MIDI devices init\r\n  useEffect(() => {\r\n    //INIT\r\n    let currentNotes = [];\r\n    const sampler = new Tone.Sampler({\r\n      urls: {\r\n        A0: 'A0.mp3',\r\n        C1: 'C1.mp3',\r\n        'D#1': 'Ds1.mp3',\r\n        'F#1': 'Fs1.mp3',\r\n        A1: 'A1.mp3',\r\n        C2: 'C2.mp3',\r\n        'D#2': 'Ds2.mp3',\r\n        'F#2': 'Fs2.mp3',\r\n        A2: 'A2.mp3',\r\n        C3: 'C3.mp3',\r\n        'D#3': 'Ds3.mp3',\r\n        'F#3': 'Fs3.mp3',\r\n        A3: 'A3.mp3',\r\n        C4: 'C4.mp3',\r\n        'D#4': 'Ds4.mp3',\r\n        'F#4': 'Fs4.mp3',\r\n        A4: 'A4.mp3',\r\n        C5: 'C5.mp3',\r\n        'D#5': 'Ds5.mp3',\r\n        'F#5': 'Fs5.mp3',\r\n        A5: 'A5.mp3',\r\n        C6: 'C6.mp3',\r\n        'D#6': 'Ds6.mp3',\r\n        'F#6': 'Fs6.mp3',\r\n        A6: 'A6.mp3',\r\n        C7: 'C7.mp3',\r\n        'D#7': 'Ds7.mp3',\r\n        'F#7': 'Fs7.mp3',\r\n        A7: 'A7.mp3',\r\n        C8: 'C8.mp3',\r\n      },\r\n      release: 1,\r\n      baseUrl: 'https://tonejs.github.io/audio/salamander/',\r\n    }).toDestination();\r\n    sampler.volume.value = -30;\r\n\r\n    if (navigator.requestMIDIAccess) {\r\n      navigator.requestMIDIAccess().then(success, failure);\r\n    }\r\n\r\n    function computeDftCoeffs(playedNotes) {\r\n      let pcv = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];\r\n\r\n      playedNotes.forEach((note) => {\r\n        let pitch;\r\n        if (note.includes('#')) {\r\n          pitch = note.slice(0, 2);\r\n        } else pitch = pitch = note.slice(0, 1);\r\n\r\n        switch (pitch) {\r\n          case 'C':\r\n            pcv[0] += 1;\r\n            break;\r\n          case 'C#':\r\n            pcv[1] += 1;\r\n            break;\r\n          case 'D':\r\n            pcv[2] += 1;\r\n            break;\r\n          case 'D#':\r\n            pcv[3] += 1;\r\n            break;\r\n          case 'E':\r\n            pcv[4] += 1;\r\n            break;\r\n          case 'F':\r\n            pcv[5] += 1;\r\n            break;\r\n          case 'F#':\r\n            pcv[6] += 1;\r\n            break;\r\n          case 'G':\r\n            pcv[7] += 1;\r\n            break;\r\n          case 'G#':\r\n            pcv[8] += 1;\r\n            break;\r\n          case 'A':\r\n            pcv[9] += 1;\r\n            break;\r\n          case 'A#':\r\n            pcv[10] += 1;\r\n            break;\r\n          case 'B':\r\n            pcv[11] += 1;\r\n            break;\r\n          default:\r\n            break;\r\n        }\r\n      });\r\n\r\n      let dftCoeffs = dft(pcv);\r\n      dftCoeffs = dftCoeffs.map((coeff) => {\r\n        return { x: coeff.re, y: coeff.im };\r\n      });\r\n      //console.log(dftCoeffs);\r\n      setMidiDevNotesDftCoeffs(dftCoeffs);\r\n    }\r\n\r\n    function handleInput(input) {\r\n      const command = input.data[0];\r\n\r\n      //Discard messages different from note on and note off\r\n      if (command !== 144 && command !== 128) return;\r\n\r\n      const note = Tone.Frequency(input.data[1], 'midi').toNote();\r\n\r\n      //Discard note off messages for unplayed notes\r\n      if (command === 128 && !currentNotes.includes(note)) return;\r\n\r\n      //Decrease velocity to avoid clipping\r\n      const velocity = Math.round(input.data[2] * 0.05);\r\n      //const velocity = input.data[2];\r\n\r\n      //console.log(`command ${command}: note ${note}, vel ${velocity}`);\r\n\r\n      switch (command) {\r\n        case 144: //noteOn\r\n          if (velocity > 0) {\r\n            //Note is on\r\n            sampler.triggerAttack(note, Tone.immediate(), velocity);\r\n            currentNotes.push(note);\r\n          } else {\r\n            //Note on + vel 0 = Note off\r\n            sampler.triggerRelease(note, Tone.immediate());\r\n            currentNotes = currentNotes.filter(\r\n              (currentNote) => currentNote !== note\r\n            );\r\n          }\r\n          break;\r\n        case 128: //noteOff\r\n          sampler.triggerRelease(note, Tone.immediate());\r\n          currentNotes = currentNotes.filter(\r\n            (currentNote) => currentNote !== note\r\n          );\r\n          break;\r\n        default:\r\n          break;\r\n      }\r\n\r\n      computeDftCoeffs(currentNotes);\r\n    }\r\n\r\n    function success(midiAccess) {\r\n      midiAccess.onstatechange = updateDevices;\r\n\r\n      const inputs = midiAccess.inputs;\r\n\r\n      inputs.forEach((input) => {\r\n        input.onmidimessage = handleInput;\r\n      });\r\n    }\r\n\r\n    function failure() {\r\n      console.log('Could not connect MIDI');\r\n    }\r\n\r\n    function updateDevices(event) {\r\n      console.log(\r\n        `Name: ${event.port.name}, Brand: ${event.port.manufacturer}, State: ${event.port.state}, Type: ${event.port.type}`\r\n      );\r\n    }\r\n  }, []);\r\n\r\n  function toggleShowPrototypes() {\r\n    setShowPrototypes(!showPrototypes);\r\n  }\r\n\r\n  function toggleShowMagAndPhase() {\r\n    setShowMagAndPhase(!showMagAndPhase);\r\n  }\r\n\r\n  function toggleShowFullTrace() {\r\n    setShowFullTrace(!showFullTrace);\r\n  }\r\n\r\n  return (\r\n    <Box>\r\n      <Box\r\n        sx={{\r\n          padding: 0,\r\n          margin: 'auto',\r\n          marginBottom: '70px',\r\n          width: `${accordionWidth}%`,\r\n        }}\r\n      >\r\n        <Accordion defaultExpanded={true}>\r\n          <AccordionSummary\r\n            expandIcon={<ExpandMoreIcon />}\r\n            aria-controls='panel1a-content'\r\n            id='panel1a-header'\r\n          >\r\n            <Typography variant='h6'>Wavescapes</Typography>\r\n          </AccordionSummary>\r\n          <AccordionDetails ref={accordionRef} sx={{ padding: 0 }}>\r\n            <WavescapeModule\r\n              wavescapesData={wavescapesData}\r\n              currentWavescapeSubdiv={currentWavescapeSubdiv}\r\n              elemsWidth={elemsWidth}\r\n            />\r\n          </AccordionDetails>\r\n        </Accordion>\r\n        <Accordion defaultExpanded={true}>\r\n          <AccordionSummary\r\n            expandIcon={<ExpandMoreIcon />}\r\n            aria-controls='panel2a-content'\r\n            id='panel2a-header'\r\n          >\r\n            <Typography variant='h6'>Fourier Coefficient Spaces</Typography>\r\n          </AccordionSummary>\r\n          <AccordionDetails sx={{ padding: 0 }}>\r\n            <CoefficientsModule\r\n              fullTraces={fullTraces}\r\n              coeffTracesData={coeffTracesData}\r\n              currentSubdiv={currentSubdiv}\r\n              showPrototypes={showPrototypes}\r\n              showMagAndPhase={showMagAndPhase}\r\n              showFullTrace={showFullTrace}\r\n              userPcvs={userPcvs}\r\n              midiDevNotesDftCoeffs={midiDevNotesDftCoeffs}\r\n              elemsWidth={elemsWidth}\r\n            />\r\n          </AccordionDetails>\r\n        </Accordion>\r\n      </Box>\r\n\r\n      <AppBar\r\n        position='fixed'\r\n        open={open}\r\n        color='secondary'\r\n        sx={{ top: 'auto', bottom: 0, maxHeight: '74px' }}\r\n      >\r\n        <Toolbar>\r\n          <Box sx={{ minWidth: 120 }}>\r\n            <FormControl size='small' variant='standard' fullWidth>\r\n              <InputLabel>Layout</InputLabel>\r\n              <Select\r\n                value={elemsForEachRow}\r\n                label='Layout'\r\n                onChange={(event) => {\r\n                  setAccordionWidth(100);\r\n                  setElemsForEachRow(event.target.value);\r\n                }}\r\n              >\r\n                <MenuItem value={6}>1x6</MenuItem>\r\n                <MenuItem value={3}>2x3</MenuItem>\r\n                <MenuItem value={2}>3x2</MenuItem>\r\n                <MenuItem value={1}>6x1</MenuItem>\r\n              </Select>\r\n            </FormControl>\r\n          </Box>\r\n          <Player\r\n            fileName={fileName}\r\n            currentWavescapeSubdiv={currentWavescapeSubdiv}\r\n          />\r\n          <Box\r\n            sx={{\r\n              display: 'flex',\r\n              alignItems: 'center',\r\n              margin: '2% 5%',\r\n              maxWidth: '100px',\r\n              justifyContent: 'space-evenly',\r\n            }}\r\n          >\r\n            <FormGroup>\r\n              <FormControlLabel\r\n                control={\r\n                  <Switch\r\n                    onChange={() => toggleShowFullTrace()}\r\n                    checked={showFullTrace}\r\n                    size='small'\r\n                  />\r\n                }\r\n                label={<Typography noWrap={true}>Show full trace</Typography>}\r\n              />\r\n              <FormControlLabel\r\n                control={\r\n                  <Switch\r\n                    onChange={() => toggleShowPrototypes()}\r\n                    checked={showPrototypes}\r\n                    size='small'\r\n                  />\r\n                }\r\n                label={<Typography noWrap={true}>Show Prototypes</Typography>}\r\n              />\r\n              <FormControlLabel\r\n                control={\r\n                  <Switch\r\n                    onChange={() => toggleShowMagAndPhase()}\r\n                    checked={showMagAndPhase}\r\n                    size='small'\r\n                  />\r\n                }\r\n                label={\r\n                  <Typography noWrap={true}>Show &mu; and &phi;</Typography>\r\n                }\r\n              />\r\n            </FormGroup>\r\n          </Box>\r\n          <Box sx={{ minWidth: '20%', padding: '1% 3% 1% 2%', marginTop: 1 }}>\r\n            <Typography>Plots size</Typography>\r\n            <Slider\r\n              min={20}\r\n              max={100}\r\n              value={accordionWidth}\r\n              defaultValue={100}\r\n              aria-label='Plots size'\r\n              valueLabelDisplay='auto'\r\n              onChange={(event, value) => {\r\n                setAccordionWidth(value);\r\n              }}\r\n              marks={[\r\n                { value: 20, label: '20%' },\r\n                { value: 50, label: '50%' },\r\n                { value: 100, label: '100%' },\r\n              ]}\r\n            />\r\n          </Box>\r\n        </Toolbar>\r\n      </AppBar>\r\n    </Box>\r\n  );\r\n}\r\n\r\nexport default Analysis;\r\n","//React\r\nimport { HashRouter, Route, Switch } from 'react-router-dom';\r\nimport { useState, useEffect, useRef } from 'react';\r\n\r\n//Import functions\r\nimport { setPlayerMidiData } from './Player';\r\nimport {\r\n  getRgbaMatrix,\r\n  getMidiFileDataObject,\r\n  getDftCoeffStatic,\r\n  getDftCoeffDynamic,\r\n} from './getDftMatrices';\r\nimport dft from './DFT';\r\nimport parse from './parser';\r\nimport { getRosePoints } from './roses';\r\n\r\n//Import components\r\nimport Navbar from './Navbar';\r\nimport ResolutionSelector from './ResolutionSelector';\r\nimport PcvChipsBox from './PcvChipsBox';\r\nimport SaveDialog from './SaveDialog';\r\n\r\n//Import pages\r\nimport Home from './pages/Home';\r\nimport Theory from './pages/Theory';\r\nimport Analysis from './pages/Analysis';\r\n\r\n//Import material UI components\r\nimport { styled, useTheme } from '@mui/material/styles';\r\nimport CssBaseline from '@mui/material/CssBaseline';\r\nimport Box from '@mui/material/Box';\r\nimport Drawer from '@mui/material/Drawer';\r\nimport IconButton from '@mui/material/IconButton';\r\nimport ChevronLeftIcon from '@mui/icons-material/ChevronLeft';\r\nimport ChevronRightIcon from '@mui/icons-material/ChevronRight';\r\nimport TextField from '@mui/material/TextField';\r\nimport Stack from '@mui/material/Stack';\r\nimport Paper from '@mui/material/Paper';\r\nimport Slider from '@mui/material/Slider';\r\nimport Typography from '@mui/material/Typography';\r\nimport Button from '@mui/material/Button';\r\nimport Divider from '@mui/material/Divider';\r\n\r\n//Change this varible to change the size\r\n//of the Drawer component on the left\r\nconst drawerWidth = 400;\r\n\r\n//Song variables\r\nlet currentSongBPM = 80;\r\nlet currentSongMidiData;\r\nlet fileName;\r\n\r\n//Drawer animation\r\nconst Main = styled('main', { shouldForwardProp: (prop) => prop !== 'open' })(\r\n  ({ theme, open }) => ({\r\n    flexGrow: 1,\r\n    padding: theme.spacing(3),\r\n    backgroundColor: '#e0e0e0',\r\n    transition: theme.transitions.create('margin', {\r\n      easing: theme.transitions.easing.sharp,\r\n      duration: theme.transitions.duration.leavingScreen,\r\n    }),\r\n    marginLeft: `-${drawerWidth}px`,\r\n    ...(open && {\r\n      transition: theme.transitions.create('margin', {\r\n        easing: theme.transitions.easing.easeOut,\r\n        duration: theme.transitions.duration.enteringScreen,\r\n      }),\r\n      marginLeft: 0,\r\n      backgroundColor: '#e0e0e0',\r\n    }),\r\n  })\r\n);\r\n\r\n//Custom style for Drawer header\r\nconst DrawerHeader = styled('div')(({ theme }) => ({\r\n  display: 'flex',\r\n  alignItems: 'center',\r\n  padding: theme.spacing(0, 1),\r\n  // necessary for content to be below app bar\r\n  ...theme.mixins.toolbar,\r\n  justifyContent: 'space-between',\r\n}));\r\n\r\n//Main component\r\nfunction App() {\r\n  const theme = useTheme();\r\n\r\n  // ----- STATES ----- //\r\n\r\n  //GENERAL STATES\r\n\r\n  //State: boolean\r\n  //If true the Drawer is opened.\r\n  const [open, setOpen] = useState(false);\r\n  //State: string\r\n  //File path MIDI.\r\n  const [file, setFile] = useState('');\r\n  //State: boolean\r\n  //Close or open the Drawer whenever the user move to another page.\r\n  const [inAnalysisPage, setInAnalysisPage] = useState(false);\r\n\r\n  //ANALYSIS STATES\r\n\r\n  //State: string[6][50]\r\n  //RGBA data of the wavescapes, from 1st to 6th coefficient.\r\n  const [wavescapesData, setWavescapesData] = useState([]);\r\n  //State: points[6][N]\r\n  //Points in the Fourier spaces (from 1st to 6th) related\r\n  //to pcvs extraced from subdivisions with the selected resolution.\r\n  const [coeffTracesData, setCoeffTracesData] = useState([]);\r\n  //State: points[6][N]\r\n  //Windowed version of coeffTracesData.\r\n  const [windowedCoeffTraces, setWindowedCoeffTraces] = useState([]);\r\n  //State: integer\r\n  //Current subdivision being played by the MIDI player,\r\n  //second index of coeffTracesData[1:6][currentSubdiv].\r\n  const [currentSubdiv, setCurrentSubdiv] = useState(0);\r\n  //State: integer\r\n  //Multiplicative factor of base time resolution.\r\n  const [windowLen, setWindowLen] = useState(1);\r\n  //State: object\r\n  //Changed only by ResolutionSelector component.\r\n  //noteResolutionValue: number, 1 is quarter note, 0.5 is eighth note...\r\n  //seconds: custom resolution in seconds\r\n  //useSeconds: use seconds attribute when true\r\n  const [resolutionMode, setResolutionMode] = useState({\r\n    noteResolutionValue: 1,\r\n    seconds: 1.5,\r\n    useSeconds: false,\r\n  });\r\n  //State: number\r\n  //Computed in order to have always 50 subdivisions for the wavescape,\r\n  //trade-off between MIDI file duration and minimum resolution since\r\n  //computing wavescapes presents high time complexity.\r\n  const [wavescapeResolution, setWavescapeResolution] = useState(10);\r\n  //State: number\r\n  //Can be controlled by the user. Resolution used to compute the\r\n  //coefficients in the Fourier spaces without computing the whole wavescape.\r\n  const [circleResolution, setCircleResolution] = useState(1);\r\n\r\n  //INPUT STATES\r\n\r\n  //State: boolean\r\n  //True if the text field input of the window length is an invalid string.\r\n  const [invalidWndLen, setInvalidWndLen] = useState(false);\r\n  //State: string\r\n  //Current string in the text field input of the window length.\r\n  const [textfieldWndLen, setTextfieldWndLen] = useState('1');\r\n  //State: array\r\n  //Contains all the pcvs inserted by the user.\r\n  //label: string representing the pcv\r\n  //coeffs: points in the 6 Fourier spaces\r\n  //n,d: num and den, indexes of the rose matrix\r\n  //rosePoints: points that form the rose's shape\r\n  const [userPcvs, setUserPcvs] = useState([]);\r\n  const pcvTextRef = useRef(null);\r\n  //State: boolean\r\n  //If pcv input parser throw an error, this state is true --> show error\r\n  const [isInputPcvInvalid, setIsInputPcvInvalid] = useState(false);\r\n  //State: matrix\r\n  //Matrix that tracks if with a given index can be used or\r\n  //it is already in use.\r\n  const [rosesMat, setRosesMat] = useState([]);\r\n\r\n  //Effect: when window length is changed,\r\n  //recompute the trace to be visualized\r\n  useEffect(() => {\r\n    let temp = [];\r\n\r\n    if (windowLen === 1) setWindowedCoeffTraces(coeffTracesData);\r\n    else {\r\n      coeffTracesData.forEach((trace) => {\r\n        let windowedTrace = [];\r\n\r\n        for (let i = 0; i <= trace.length - windowLen; i++) {\r\n          let smoothedPoint = { x: 0, y: 0 };\r\n          for (let j = 0; j < windowLen; j++) {\r\n            smoothedPoint.x += trace[i + j].x;\r\n            smoothedPoint.y += trace[i + j].y;\r\n          }\r\n          windowedTrace.push(smoothedPoint);\r\n        }\r\n\r\n        //Normalization\r\n        windowedTrace.forEach((smoothedPoint) => {\r\n          smoothedPoint.x = smoothedPoint.x / windowLen;\r\n          smoothedPoint.y = smoothedPoint.y / windowLen;\r\n        });\r\n\r\n        temp.push(windowedTrace);\r\n      });\r\n\r\n      setWindowedCoeffTraces(temp);\r\n    }\r\n  }, [windowLen, coeffTracesData]);\r\n\r\n  //Pitch class vector submit function handler\r\n  function handleSubmitPitchClass(input) {\r\n    //Parse the input\r\n    let parsedInput;\r\n    let userPcvObjects = [];\r\n\r\n    try {\r\n      parsedInput = parse(input);\r\n    } catch (error) {\r\n      console.log(error.message);\r\n      setIsInputPcvInvalid(true);\r\n      return;\r\n    }\r\n\r\n    //Create new pcv object\r\n    parsedInput.forEach((input) =>\r\n      userPcvObjects.push({\r\n        label: `(${input})`,\r\n        isDisabled: false,\r\n        coeffs: dft(input, true, true, false),\r\n        rosePoints: [],\r\n        n: -1,\r\n        d: -1,\r\n      })\r\n    );\r\n\r\n    //Check if we are adding an input already inserted\r\n    let labels = userPcvs.map((pcvData) => pcvData.label);\r\n    labels.forEach((label) => {\r\n      userPcvObjects = userPcvObjects.filter(\r\n        (pcvObj) => pcvObj.label !== label\r\n      );\r\n    });\r\n\r\n    //Assing an unused rose to each pcv\r\n    userPcvObjects.forEach((pcvData) => {\r\n      let found = false;\r\n\r\n      for (let i = 0; i < rosesMat.length && !found; i++) {\r\n        for (let j = 0; j < rosesMat[i].length && !found; j++) {\r\n          if (rosesMat[i][j].usable && !rosesMat[i][j].used) {\r\n            found = true;\r\n            pcvData.rosePoints = rosesMat[i][j].points;\r\n            rosesMat[i][j].used = true;\r\n            pcvData.n = rosesMat[i][j].n;\r\n            pcvData.d = rosesMat[i][j].d;\r\n          }\r\n        }\r\n      }\r\n\r\n      //If the are no available roses, return without changing anything\r\n      if (!found) return;\r\n    });\r\n\r\n    //Update the state with the new pcvs\r\n    setUserPcvs([...userPcvs, ...userPcvObjects]);\r\n  }\r\n\r\n  //Effect: MIDI analysis on file change\r\n  useEffect(() => {\r\n    //Get the uploaded file\r\n    let input = document.getElementById('file').files[0];\r\n\r\n    //Parse the MIDI file\r\n    if (input) {\r\n      let fileReader = new FileReader();\r\n      fileReader.readAsArrayBuffer(input);\r\n      fileReader.onload = (loadedFile) => {\r\n        try {\r\n          let { midiData, midiBpm } = getMidiFileDataObject(\r\n            loadedFile.target.result\r\n          );\r\n\r\n          //Set song variables\r\n          currentSongBPM = midiBpm;\r\n          currentSongMidiData = midiData;\r\n          fileName = input.name;\r\n\r\n          //Wavescapes \"static\" analysis --> 50 subdivs\r\n          let subdivsNumberStatic = 50;\r\n          let staticResolution =\r\n            currentSongMidiData.duration / subdivsNumberStatic;\r\n          setWavescapeResolution(staticResolution);\r\n\r\n          setWavescapesData(\r\n            getRgbaMatrix(getDftCoeffStatic(midiData, staticResolution))\r\n          );\r\n\r\n          //Circles \"dynamic\" analysis --> single traces in the Fourier spaces\r\n          let { tracesData, resolution } = getDftCoeffDynamic(\r\n            midiData,\r\n            resolutionMode,\r\n            currentSongBPM\r\n          );\r\n          setCircleResolution(resolution);\r\n          setCoeffTracesData(tracesData);\r\n          setPlayerMidiData(currentSongMidiData, resolution, setCurrentSubdiv);\r\n          setWindowLen(1);\r\n          setTextfieldWndLen('1');\r\n\r\n          //console.log(midiData);\r\n        } catch (error) {\r\n          console.log(error);\r\n          return;\r\n        }\r\n      };\r\n    }\r\n  }, [file]);\r\n\r\n  //Effect: init roseMatrix and user pcv examples\r\n  useEffect(() => {\r\n    //7x7 matrix\r\n    let initMatrix = [];\r\n    for (let i = 1; i <= 7; i++) {\r\n      let temp = [];\r\n      for (let j = 1; j <= 7; j++) {\r\n        let rose = { n: j, d: i, used: false, usable: true, points: [] };\r\n        if (j % i === 0 && i !== 1) rose.usable = false;\r\n\r\n        if (rose.usable === true) rose.points = getRosePoints(j, i);\r\n\r\n        temp.push(rose);\r\n      }\r\n      initMatrix.push(temp);\r\n    }\r\n\r\n    //(0,0) or n=1, d=1 can't be used since it is a simple circle\r\n    initMatrix[0][0].usable = false;\r\n\r\n    setRosesMat(initMatrix);\r\n\r\n    //Examples\r\n    let examplePcvs = [\r\n      [1, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0], // C\r\n      [1, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0], // Cmin\r\n      [1, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0], // Cdim\r\n    ];\r\n\r\n    let exPcvObjects = examplePcvs.map((pcv) => {\r\n      return {\r\n        label: `(${pcv.toString()})`,\r\n        isDisabled: false,\r\n        coeffs: dft(pcv, true, true, false),\r\n        rosePoints: [],\r\n        n: -1,\r\n        d: -1,\r\n      };\r\n    });\r\n\r\n    //Assing an unused rose to each pcv\r\n    exPcvObjects.forEach((pcvData) => {\r\n      let found = false;\r\n\r\n      for (let i = 0; i < initMatrix.length && !found; i++) {\r\n        for (let j = 0; j < initMatrix[i].length && !found; j++) {\r\n          if (initMatrix[i][j].usable && !initMatrix[i][j].used) {\r\n            found = true;\r\n            pcvData.rosePoints = initMatrix[i][j].points;\r\n            initMatrix[i][j].used = true;\r\n            pcvData.n = initMatrix[i][j].n;\r\n            pcvData.d = initMatrix[i][j].d;\r\n          }\r\n        }\r\n      }\r\n    });\r\n\r\n    //2 disabled pcvs to show that there is the possibility to disable them\r\n    exPcvObjects[1].isDisabled = true;\r\n    exPcvObjects[2].isDisabled = true;\r\n\r\n    setUserPcvs(exPcvObjects);\r\n  }, []);\r\n\r\n  //Close Drawer function handler\r\n  const handleDrawerClose = () => {\r\n    setOpen(false);\r\n  };\r\n\r\n  //Re-compute the analysis when clicking on \"Change\" button in the Drawer\r\n  function retriggerAnalysis() {\r\n    //Only if there is midi data, retrigger analysis\r\n    if (currentSongMidiData == null) {\r\n      return;\r\n    }\r\n\r\n    //Circles dynamic analysis\r\n    let { tracesData, resolution } = getDftCoeffDynamic(\r\n      currentSongMidiData,\r\n      resolutionMode,\r\n      currentSongBPM\r\n    );\r\n    setCircleResolution(resolution);\r\n    setCoeffTracesData(tracesData);\r\n    setWindowLen(1);\r\n    setTextfieldWndLen('1');\r\n    setPlayerMidiData(currentSongMidiData, resolution, setCurrentSubdiv);\r\n  }\r\n\r\n  return (\r\n    <HashRouter>\r\n      <CssBaseline />\r\n\r\n      <Navbar\r\n        open={open}\r\n        setOpen={setOpen}\r\n        setInAnalysisPage={setInAnalysisPage}\r\n        inAnalysisPage={inAnalysisPage}\r\n      />\r\n\r\n      <Box sx={{ display: 'flex' }}>\r\n        {/* DRAWER */}\r\n        <Drawer\r\n          sx={{\r\n            width: drawerWidth,\r\n            flexShrink: 0,\r\n            '& .MuiDrawer-paper': {\r\n              width: drawerWidth,\r\n              boxSizing: 'border-box',\r\n            },\r\n          }}\r\n          variant='persistent'\r\n          anchor='left'\r\n          open={open}\r\n        >\r\n          {/* DRAWER HEADER  */}\r\n          <DrawerHeader>\r\n            <Stack sx={{ flexGrow: '2', maxWidth: '85%', marginBottom: 1 }}>\r\n              <Typography sx={{ fontWeight: 'bold' }}>\r\n                Upload a midi file\r\n              </Typography>\r\n              <Stack spacing={2} direction='row' sx={{ alignItems: 'center' }}>\r\n                <label htmlFor='file'>\r\n                  <input\r\n                    style={{ display: 'none' }}\r\n                    type='file'\r\n                    id='file'\r\n                    name='file'\r\n                    value={file}\r\n                    onChange={(e) => setFile(e.target.value)}\r\n                  />\r\n                  <Button\r\n                    variant='contained'\r\n                    size='small'\r\n                    color='primary'\r\n                    component='span'\r\n                  >\r\n                    Upload\r\n                  </Button>\r\n                </label>\r\n                <Typography\r\n                  noWrap={true}\r\n                  color={fileName ? 'primary' : 'error'}\r\n                >\r\n                  {wavescapesData.length > 0\r\n                    ? fileName\r\n                    : 'No midi file uploaded'}\r\n                </Typography>\r\n              </Stack>\r\n            </Stack>\r\n            <IconButton onClick={handleDrawerClose}>\r\n              {theme.direction === 'ltr' ? (\r\n                <ChevronLeftIcon />\r\n              ) : (\r\n                <ChevronRightIcon />\r\n              )}\r\n            </IconButton>\r\n          </DrawerHeader>\r\n          <Divider />\r\n\r\n          {/* TIME RESOLUTION MODULE */}\r\n          <Typography sx={{ marginLeft: 1, marginTop: 1, fontWeight: 'bold' }}>\r\n            Time resolution\r\n          </Typography>\r\n          <Box\r\n            sx={{\r\n              display: 'flex',\r\n              alignItems: 'center',\r\n              margin: '2% 5% 0 2%',\r\n              width: '90%',\r\n              justifyContent: 'space-evenly',\r\n            }}\r\n          >\r\n            <ResolutionSelector\r\n              setResolutionMode={setResolutionMode}\r\n              resolutionMode={resolutionMode}\r\n              retriggerAnalysis={retriggerAnalysis}\r\n            />\r\n          </Box>\r\n          <Divider />\r\n\r\n          {/* WINDOW LENGTH MODULE */}\r\n          <Typography\r\n            sx={{\r\n              marginLeft: 1,\r\n              marginTop: 1,\r\n              fontWeight: 'bold',\r\n            }}\r\n          >\r\n            Window Length\r\n          </Typography>\r\n          <Stack\r\n            sx={{ margin: 'auto', marginBottom: 1, marginTop: 1 }}\r\n            direction='row'\r\n          >\r\n            <Typography\r\n              sx={{\r\n                marginLeft: 1,\r\n                paddingTop: '5px',\r\n                marginRight: '5px',\r\n                fontSize: '18px',\r\n              }}\r\n              variant='h5'\r\n              gutterBottom\r\n            >{`=`}</Typography>\r\n            <TextField\r\n              inputProps={{ style: { textAlign: 'center' } }}\r\n              sx={{ width: '15%' }}\r\n              error={invalidWndLen}\r\n              onChange={(event) => {\r\n                setTextfieldWndLen(event.target.value);\r\n                let input = parseInt(event.target.value);\r\n                if (isNaN(input)) {\r\n                  setInvalidWndLen(true);\r\n                } else {\r\n                  setInvalidWndLen(false);\r\n                  if (coeffTracesData.length > 0) {\r\n                    if (input < 1) {\r\n                      setInvalidWndLen(true);\r\n                      setWindowLen(1);\r\n                    } else if (input > coeffTracesData[0].length) {\r\n                      setInvalidWndLen(true);\r\n                      setWindowLen(coeffTracesData[0].length);\r\n                    } else setWindowLen(input);\r\n                  } else {\r\n                    setWindowLen(input);\r\n                  }\r\n                }\r\n              }}\r\n              value={textfieldWndLen}\r\n              variant='standard'\r\n            />\r\n            <Typography\r\n              sx={{\r\n                marginLeft: 1,\r\n                paddingTop: '5px',\r\n                fontSize: '18px',\r\n              }}\r\n              variant='h5'\r\n              gutterBottom\r\n            >\r\n              {'\\u00D7 time resolution'}\r\n            </Typography>\r\n          </Stack>\r\n          <Slider\r\n            sx={{\r\n              margin: 'auto',\r\n              width: '80%',\r\n              marginBottom: 3,\r\n              marginTop: 1,\r\n              heigth: '10%',\r\n            }}\r\n            value={windowLen}\r\n            onChange={(event, value) => {\r\n              setWindowLen(value);\r\n              setTextfieldWndLen(value);\r\n            }}\r\n            aria-label='Window Length'\r\n            defaultValue={1}\r\n            valueLabelDisplay='auto'\r\n            min={1}\r\n            max={coeffTracesData.length > 0 ? coeffTracesData[0].length : 100}\r\n            marks={\r\n              coeffTracesData.length > 0\r\n                ? [\r\n                    { value: 1, label: '1' },\r\n                    {\r\n                      value: coeffTracesData[0].length,\r\n                      label: `${coeffTracesData[0].length}`,\r\n                    },\r\n                  ]\r\n                : [\r\n                    { value: 1, label: '1' },\r\n                    { value: 100, label: '100' },\r\n                  ]\r\n            }\r\n          />\r\n          <Divider />\r\n\r\n          {/* PCV USER INPUT MODULE */}\r\n          <Typography sx={{ marginLeft: 1, marginTop: 1, fontWeight: 'bold' }}>\r\n            Custom pitch-class vectors\r\n          </Typography>\r\n          <Box\r\n            sx={{\r\n              flexDirection: 'column',\r\n              display: 'flex',\r\n              alignItems: 'center',\r\n              margin: '3% 5%',\r\n              height: '40%',\r\n              maxHeight: '350px',\r\n              justifyContent: 'flex-start',\r\n            }}\r\n            component='form'\r\n            noValidate\r\n            autoComplete='off'\r\n          >\r\n            <TextField\r\n              /* sx={{ minHeight: '5rem' }} */\r\n              fullWidth\r\n              label={'margin=\"dense\"'}\r\n              error={isInputPcvInvalid}\r\n              helperText={isInputPcvInvalid && 'Invalid input'}\r\n              id='outlined-basic'\r\n              label='e.g. {0,0,4,7,10} (2,0,0,0,1,0,0,1,0,0,1,0)'\r\n              variant='outlined'\r\n              onKeyPress={(event) => {\r\n                if (event.key === 'Enter') {\r\n                  event.preventDefault();\r\n                  handleSubmitPitchClass(pcvTextRef.current.value);\r\n                  pcvTextRef.current.value = '';\r\n                }\r\n              }}\r\n              onChange={() => {\r\n                setIsInputPcvInvalid(false);\r\n              }}\r\n              inputRef={pcvTextRef}\r\n            />\r\n            <PcvChipsBox\r\n              userPcvs={userPcvs}\r\n              setUserPcvs={setUserPcvs}\r\n              rosesMat={rosesMat}\r\n            />\r\n          </Box>\r\n          <Divider />\r\n\r\n          {/* LEGEND OF COEFFICIENTS */}\r\n          <Typography sx={{ marginLeft: 1, marginTop: 1, fontWeight: 'bold' }}>\r\n            Legend of coefficients\r\n          </Typography>\r\n          <Box sx={{ margin: '5px 10px' }}>\r\n            <Paper>\r\n              <Stack>\r\n                <Stack direction='row'>\r\n                  <svg width='24' height='24' viewBox='0 0 24 24'>\r\n                    <circle cx='12' cy='12' r='8' fill='black' />\r\n                    <text\r\n                      fontSize='15'\r\n                      textAnchor='middle'\r\n                      x='12'\r\n                      y='17'\r\n                      fill='white'\r\n                    >\r\n                      k\r\n                    </text>\r\n                  </svg>\r\n                  Fourier coefficient number\r\n                </Stack>\r\n                <Stack direction='row'>\r\n                  <svg width='24' height='24' viewBox='0 0 24 24'>\r\n                    <circle cx='12' cy='12' r='6' fill='black' />\r\n                  </svg>\r\n                  MIDI file segments\r\n                </Stack>\r\n                <Stack direction='row'>\r\n                  <svg width='24' height='24' viewBox='0 0 24 24'>\r\n                    <circle cx='12' cy='12' r='5' fill='white' />\r\n                    <circle\r\n                      cx='12'\r\n                      cy='12'\r\n                      r='5'\r\n                      fill='none'\r\n                      stroke='black'\r\n                      strokeWidth='3px'\r\n                    />\r\n                  </svg>\r\n                  MIDI playback\r\n                </Stack>\r\n                <Stack direction='row'>\r\n                  <svg width='24' height='24' viewBox='0 0 24 24'>\r\n                    <g transform='translate(12,12)'>\r\n                      <line\r\n                        x1='0'\r\n                        x2='0'\r\n                        y1='7'\r\n                        y2='-7'\r\n                        stroke='black'\r\n                        strokeWidth='1.5'\r\n                      ></line>\r\n                      <line\r\n                        x1='7'\r\n                        x2='-7'\r\n                        y1='0'\r\n                        y2='0'\r\n                        stroke='black'\r\n                        strokeWidth='1.5'\r\n                      ></line>\r\n                    </g>\r\n                  </svg>\r\n                  MIDI controller input\r\n                </Stack>\r\n                <Stack direction='row'>\r\n                  <svg width='24' height='24' viewBox='0 0 24 24'>\r\n                    <circle\r\n                      cx='12'\r\n                      cy='12'\r\n                      r='7'\r\n                      fill='none'\r\n                      stroke='grey'\r\n                      strokeWidth='2px'\r\n                    />\r\n                  </svg>\r\n                  Prototypes\r\n                </Stack>\r\n                <Stack direction='row'>\r\n                  <svg width='24' height='24' viewBox='0 0 24 24'>\r\n                    {rosesMat.length > 0 ? (\r\n                      <polyline\r\n                        transform={`translate(${12},${12})`}\r\n                        fill='none'\r\n                        stroke='black'\r\n                        strokeWidth='1px'\r\n                        points={rosesMat[3][0].points}\r\n                      />\r\n                    ) : null}\r\n                  </svg>\r\n                  Custom pitch-class vectors\r\n                </Stack>\r\n              </Stack>\r\n            </Paper>\r\n          </Box>\r\n\r\n          {/* EXPORT MODULE */}\r\n          <SaveDialog\r\n            traces={windowedCoeffTraces}\r\n            userPcvs={userPcvs}\r\n            wavescapesData={wavescapesData}\r\n          />\r\n        </Drawer>\r\n\r\n        {/* MAIN */}\r\n        <Main open={open}>\r\n          <Switch>\r\n            <Route\r\n              exact\r\n              path='/'\r\n              render={() => (\r\n                <Home\r\n                  setOpen={setOpen}\r\n                  setInAnalysisPage={setInAnalysisPage}\r\n                ></Home>\r\n              )}\r\n            ></Route>\r\n            <Route\r\n              exact\r\n              path='/theory'\r\n              render={() => (\r\n                <Theory\r\n                  setOpen={setOpen}\r\n                  setInAnalysisPage={setInAnalysisPage}\r\n                ></Theory>\r\n              )}\r\n            ></Route>\r\n            <Route\r\n              exact\r\n              path='/analysis'\r\n              render={() => (\r\n                <Analysis\r\n                  fileName={fileName}\r\n                  setInAnalysisPage={setInAnalysisPage}\r\n                  open={open}\r\n                  setOpen={setOpen}\r\n                  wavescapesData={wavescapesData}\r\n                  fullTraces={coeffTracesData}\r\n                  coeffTracesData={windowedCoeffTraces}\r\n                  currentSubdiv={\r\n                    //Mapping between coeffTracesData's subdivs\r\n                    //and windowedCoeffTraces' subdivs --> centerd window\r\n                    windowedCoeffTraces.length > 0 &&\r\n                    Math.floor(windowLen / 2) + currentSubdiv >=\r\n                      windowedCoeffTraces[0].length\r\n                      ? windowedCoeffTraces[0].length - 1\r\n                      : Math.floor(windowLen / 2) + currentSubdiv\r\n                  }\r\n                  currentWavescapeSubdiv={Math.floor(\r\n                    (currentSubdiv * circleResolution) / wavescapeResolution\r\n                  )}\r\n                  userPcvs={userPcvs}\r\n                />\r\n              )}\r\n            ></Route>\r\n          </Switch>\r\n        </Main>\r\n      </Box>\r\n    </HashRouter>\r\n  );\r\n}\r\n\r\nexport default App;\r\n","export default function parse(input) {\r\n  let pcvs = [];\r\n  //Vectorial notation, distribution -> real numbers\r\n  const openVect = '(';\r\n  const closeVect = ')';\r\n  //Set notation, integers\r\n  const openSet = '{';\r\n  const closeSet = '}';\r\n  //Number divider\r\n  const divider = ',';\r\n\r\n  let isGroup = false; //True if we are in between valid brackets\r\n  let isSet = false; //True if set notation detected, false otherwise\r\n\r\n  for (let i = 0; i < input.length; i++) {\r\n    if (input[i] === openSet || input[i] === openVect) {\r\n      isGroup = true;\r\n      if (input[i] === openSet) isSet = true;\r\n    }\r\n\r\n    if (isGroup) {\r\n      let stringGroup = [];\r\n      //Slice the current group\r\n      for (\r\n        let j = i + 1;\r\n        input[j] !== closeSet && input[j] !== closeVect;\r\n        j++\r\n      ) {\r\n        //Check if there is an invalid char in the group\r\n        if (\r\n          input[j] !== ',' &&\r\n          input[j] !== '.' &&\r\n          input[j] !== ' ' &&\r\n          isNaN(parseFloat(input[j]))\r\n        )\r\n          throw new Error('Found NaN');\r\n        if (input[j] !== ' ') stringGroup.push(input[j]);\r\n      }\r\n\r\n      stringGroup = stringGroup.join('');\r\n\r\n      //Check if the empty string\r\n      if (stringGroup === '') throw new Error('Empty input');\r\n\r\n      let numeralInput = [];\r\n      let count = 0;\r\n      for (let j = 0; j < stringGroup.length; j++) {\r\n        if (stringGroup[j] === divider) {\r\n          let num = stringGroup.slice(j - count, j);\r\n          //if num.length === 0 => two consecutive comas, invalid input\r\n          if (num.length === 0) throw new Error('Two consecutive comas');\r\n\r\n          numeralInput.push(+num);\r\n          count = -1;\r\n        }\r\n        count++;\r\n      }\r\n      //Last element not cover by the for cycle\r\n      let lastNum = stringGroup.slice(\r\n        stringGroup.length - count,\r\n        stringGroup.length\r\n      );\r\n      //Check if there is a last number\r\n      if (lastNum.length === 0) {\r\n        throw new Error('Missing last number');\r\n      }\r\n      numeralInput.push(+lastNum);\r\n\r\n      if (isSet) {\r\n        let bin = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];\r\n        for (let i = 0; i < numeralInput.length; i++) {\r\n          //Set notation: check if num is valid range [0,11]\r\n          if (numeralInput[i] < 0 || numeralInput[i] >= 12) {\r\n            throw new Error('Set notation: out of range');\r\n          }\r\n\r\n          bin[numeralInput[i]] += 1;\r\n        }\r\n        pcvs.push(bin);\r\n      } else {\r\n        //If is in vectorial form, check if there are 12 elements\r\n        if (numeralInput.length !== 12) {\r\n          throw new Error('Vectorial notation: missing elements');\r\n        }\r\n        pcvs.push(numeralInput);\r\n      }\r\n\r\n      isGroup = false;\r\n      isSet = false;\r\n      i += count;\r\n    }\r\n  }\r\n\r\n  if (pcvs.length === 0) throw new Error('Invalid input');\r\n\r\n  return pcvs;\r\n}\r\n","//React\r\nimport React from 'react';\r\nimport ReactDOM from 'react-dom';\r\n\r\n//Import components\r\nimport App from './App';\r\n\r\n//Import material UI components\r\nimport { createTheme, ThemeProvider } from '@mui/material/styles';\r\n\r\n//Custom theme\r\nconst customTheme = createTheme({\r\n  palette: {\r\n    primary: {\r\n      main: '#323232',\r\n    },\r\n    secondary: {\r\n      main: '#fefefe',\r\n    },\r\n    background: {\r\n      default: '#e0e0e0',\r\n    },\r\n  },\r\n});\r\n\r\nReactDOM.render(\r\n  <React.StrictMode>\r\n    <ThemeProvider theme={customTheme}>\r\n      <App />\r\n    </ThemeProvider>\r\n  </React.StrictMode>,\r\n  document.getElementById('root')\r\n);\r\n"],"sourceRoot":""}